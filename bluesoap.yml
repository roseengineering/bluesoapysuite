---
  - set_fact:
      fs_path: "{{ fs_path | default('/srv') }}"

  # output directory

  - become: yes
    file: path={{ fs_path }} state=directory owner={{ user }} group={{ user }}

  # bluezero / mqtt

  - become: yes
    apt:
      name:
      - python3-dbus

  - become: yes
    pip:
      name:
      - bluezero
      - paho-mqtt

  - become: yes
    copy:
      dest: /etc/dbus-1/system.d/ukBaz.bluezero.conf 
      content: |
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE busconfig PUBLIC 
         "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
         "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
        <busconfig>
          <policy context="default">
            <allow own="ukBaz.bluezero"/>
            <allow send_destination="ukBaz.bluezero"
                   send_interface="org.freedesktop.DBus.Introspectable"/>
            <allow send_type="method_call" log="true"/>
          </policy>
        </busconfig>

  # bluesoapy

  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqproxy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCmZyb20gYmx1ZXplcm8gaW1wb3J0IHBlcmlw
        aGVyYWwKClVBUlRfU0VSSVZDRSA9ICc2RTQwMDAwMS1CNUEzLUYzOTMtRTBB
        OS1FNTBFMjREQ0NBOUUnClJYX0NIQVJBQ1RFUklTVElDID0gJzZFNDAwMDAy
        LUI1QTMtRjM5My1FMEE5LUU1MEUyNERDQ0E5RScKVFhfQ0hBUkFDVEVSSVNU
        SUMgPSAnNkU0MDAwMDMtQjVBMy1GMzkzLUUwQTktRTUwRTI0RENDQTlFJwoK
        Y2xhc3MgVWFydFNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgb25y
        ZWFkLCBhbGlhcz0nUlBpX1VBUlQnKToKICAgICAgICBzZWxmLm9ucmVhZCA9
        IG9ucmVhZAogICAgICAgIHNlbGYuYXBwID0gcGVyaXBoZXJhbC5BcHBsaWNh
        dGlvbigpCiAgICAgICAgc2VsZi5ibGVfdWFydCA9IHBlcmlwaGVyYWwuU2Vy
        dmljZShVQVJUX1NFUklWQ0UsIFRydWUpCiAgICAgICAgc2VsZi5yeF91YXJ0
        ID0gcGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhSWF9DSEFSQUNURVJJU1RJ
        QywKICAgICAgICAgICAgWyd3cml0ZScsICd3cml0ZS13aXRob3V0LXJlc3Bv
        bnNlJ10sIHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi50eF91YXJ0ID0g
        cGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhUWF9DSEFSQUNURVJJU1RJQywK
        ICAgICAgICAgICAgWydub3RpZnknXSwgc2VsZi5ibGVfdWFydCkKICAgICAg
        ICBzZWxmLnJ4X3VhcnQuYWRkX3dyaXRlX2V2ZW50KHNlbGYudWFydF9wcmlu
        dCkKICAgICAgICBzZWxmLmJsZV91YXJ0LmFkZF9jaGFyYWN0ZXJpc3RpYyhz
        ZWxmLnJ4X3VhcnQpCiAgICAgICAgc2VsZi5ibGVfdWFydC5hZGRfY2hhcmFj
        dGVyaXN0aWMoc2VsZi50eF91YXJ0KQogICAgICAgIHNlbGYuYXBwLmFkZF9z
        ZXJ2aWNlKHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi5hcHAuZG9uZ2xl
        LmFsaWFzID0gYWxpYXMKICAgIGRlZiB1YXJ0X3ByaW50KHNlbGYsIGRhdGEp
        OgogICAgICAgIHZhbHVlID0gJycuam9pbihjaHIobGV0dGVyKSBmb3IgbGV0
        dGVyIGluIGRhdGEpCiAgICAgICAgc2VsZi5vbnJlYWQodmFsdWUpCiAgICBk
        ZWYgc3RhcnQoc2VsZik6CiAgICAgICAgc2VsZi5hcHAuc3RhcnQoKQoKIyMj
        IyMjIyMjIyMjIyMjIyMjIyMjIwoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBw
        YWhvLm1xdHQuY2xpZW50IGFzIG1xdHQKZnJvbSBkYXRldGltZSBpbXBvcnQg
        ZGF0ZXRpbWUKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKAog
        ICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVmYXVsdHNI
        ZWxwRm9ybWF0dGVyKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWJyb2tlciIs
        IGRlZmF1bHQ9IjEyNy4wLjAuMSIsIGhlbHA9J2Jyb2tlciBob3N0JykKcGFy
        c2VyLmFkZF9hcmd1bWVudCgiLS1wb3J0IiwgZGVmYXVsdD0xODgzLCBoZWxw
        PSdicm9rZXIgcG9ydCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0ta2VlcGFs
        aXZlIiwgZGVmYXVsdD02MCwgaGVscD0nYnJva2VyIGtlZXAgYWxpdmUnKQpw
        YXJzZXIuYWRkX2FyZ3VtZW50KCItLXRvcGljIiwgZGVmYXVsdD0iZi90eCIs
        IGhlbHA9J2NvbW1hbmQgdG9waWMnKQoKZGVmIG1haW4oKToKICAgIGRlZiBv
        bmNvbm5lY3QoY2xpZW50LCB1c2VyZGF0YSwgZmxhZ3MsIHJjKToKICAgICAg
        ICBjbGllbnQuc3Vic2NyaWJlKCcjJykKICAgIGRlZiBvbndyaXRlKHZhbHVl
        KToKICAgICAgICBjbGllbnQucHVibGlzaChhcmdzLnRvcGljLCB2YWx1ZSkK
        ICAgIGRlZiBvbm1lc3NhZ2UoY2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAg
        ICAgICBwYXlsb2FkID0gbXNnLnBheWxvYWQuZGVjb2RlKCdsYXRpbicpCiAg
        ICAgICAgdHMgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMn
        KQogICAgICAgIHVhcnQudHhfdWFydC5zZW5kX25vdGlmeV9ldmVudChmJ3t0
        c30ge21zZy50b3BpY30ge3BheWxvYWR9JykKICAgIHVhcnQgPSBVYXJ0U2Vy
        dmljZShvbndyaXRlKQogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAg
        Y2xpZW50Lm9uX2Nvbm5lY3QgPSBvbmNvbm5lY3QKICAgIGNsaWVudC5vbl9t
        ZXNzYWdlID0gb25tZXNzYWdlCiAgICBjbGllbnQuY29ubmVjdChhcmdzLmJy
        b2tlciwgYXJncy5wb3J0LCBhcmdzLmtlZXBhbGl2ZSkKICAgIGNsaWVudC5s
        b29wX3N0YXJ0KCkKICAgIHVhcnQuc3RhcnQoKQoKaWYgX19uYW1lX18gPT0g
        J19fbWFpbl9fJzoKICAgICMgcHJveHkgYmxlIHVhcnQgdG8gbXF0dCBicm9r
        ZXIKICAgICMgdGhpcyBuZWVkcyB0byBydW4gYXMgcm9vdAogICAgYXJncyA9
        IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqsoapy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgb3MsIHN5cywgdGltZQppbXBv
        cnQgc3RydWN0CmltcG9ydCBhcmdwYXJzZQppbXBvcnQgbnVtcHkgYXMgbnAK
        aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgU29hcHlT
        RFIKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBTb2FweVNE
        UiBpbXBvcnQgU09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMgoKcmVzdGFy
        dF9zZWNvbmRzID0gMTAKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFy
        c2VyKAogICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVm
        YXVsdHNIZWxwRm9ybWF0dGVyKQoKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1i
        cm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxwPSdicm9rZXIgaG9z
        dCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIGRlZmF1bHQ9MTg4
        MywgdHlwZT1pbnQsIGhlbHA9J2Jyb2tlciBwb3J0JykKcGFyc2VyLmFkZF9h
        cmd1bWVudCgiLS1rZWVwYWxpdmUiLCBkZWZhdWx0PTYwLCB0eXBlPWludCwg
        aGVscD0nYnJva2VyIGtlZXBhbGl2ZSBpbiBzZWNvbmRzJykKcGFyc2VyLmFk
        ZF9hcmd1bWVudCgiLS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdt
        cXR0IHRvcGljIGZvciBjb21tYW5kJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS1wcHMtdG9waWMiLCBkZWZhdWx0PSJwcHMiLCBoZWxwPSdtcXR0IHRvcGlj
        IGZvciBncHMgcHBzIHRpbWUnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWRy
        aXZlciIsIGhlbHA9J25hbWUgb2YgZHJpdmVyJykKcGFyc2VyLmFkZF9hcmd1
        bWVudCgiLS1wYWNrZXQtc2l6ZSIsIGRlZmF1bHQ9MTAyNCwgdHlwZT1pbnQs
        IGhlbHA9J3BhY2tldCBzaXplJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1m
        cmVxIiwgdHlwZT1ucC5mbG9hdCwgaGVscD0iY2VudGVyIGZyZXF1ZW5jeSBp
        biBoZXJ0eiIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcmF0ZSIsIHR5cGU9
        bnAuZmxvYXQsIGhlbHA9InNhbXBsZSByYXRlIGluIGhlcnR6IikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1nYWluIiwgdHlwZT1ucC5mbG9hdCwgaGVscD0i
        ZnJvbnQgZW5kIGdhaW4gaW4gZEIiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LWFnYyIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBBR0Mi
        KQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW5vYnJva2VyIiwgYWN0aW9uPSJz
        dG9yZV90cnVlIiwgaGVscD0iZGlzYWJsZSBtcXR0IGJyb2tlciIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tZHVtYiIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIs
        IGhlbHA9ImR1bWIgdGVybWluYWwiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LW91dHB1dCIsIGRlZmF1bHQ9Im91dCIsIGhlbHA9IndyaXRlIENGMzIgc2Ft
        cGxlcyB0byBmaWxlIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1ub3dhdmUi
        LCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJkaXNhYmxlIFdBViBoZWFk
        ZXIiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW1ldGVyIiwgYWN0aW9uPSJz
        dG9yZV90cnVlIiwgaGVscD0iZW5hYmxlIGNvbnNvbGUgcGVhayBtZXRlciIp
        CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcGF1c2UiLCBhY3Rpb249InN0b3Jl
        X3RydWUiLCBoZWxwPSJwYXVzZSBvdXRwdXQiKQpwYXJzZXIuYWRkX2FyZ3Vt
        ZW50KCItLXJlZnJlc2giLCBkZWZhdWx0PTUsIHR5cGU9aW50LCBoZWxwPSJw
        ZWFrIG1ldGVyIHJlZnJlc2ggaW4gc2Vjb25kcyIpCnBhcnNlci5hZGRfYXJn
        dW1lbnQoIi0tcmVmcmVzaC1wcHMiLCBkZWZhdWx0PTEwLCB0eXBlPWludCwg
        aGVscD0ncHBzIHJlZnJlc2ggaW4gc2Vjb25kcycpCiAKIyBhcmdTdHJpbmcK
        cGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kaXJlY3Qtc2FtcCIsIGhlbHA9IjA9
        b2ZmLCAxPUksIDI9USBjaGFubmVsIikKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS1pcS1zd2FwIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0ic3dhcCBJ
        USBzaWduYWxzIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1iaWFzdGVlIiwg
        YWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZW5hYmxlIGJpYXMgdGVlIikK
        cGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kaWdpdGFsLWFnYyIsIGFjdGlvbj0i
        c3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBkaWdpdGFsIEFHQyIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tb2Zmc2V0LXR1bmUiLCBhY3Rpb249InN0b3Jl
        X3RydWUiLCBoZWxwPSJlbmFibGUgb2Zmc2V0IHR1bmUiKQoKCmRlZiBnZW5f
        dG9waWMobmFtZT1Ob25lKToKICAgIGQgPSBhcmdzLnRvcGljLnNwbGl0KCcv
        JylbOi0xXQogICAgaWYgbmFtZSBpcyBub3QgTm9uZToKICAgICAgICBkLmFw
        cGVuZChuYW1lKQogICAgcmV0dXJuICcvJy5qb2luKGQpCgoKZGVmIHRvX2Zs
        b2F0KHBhcmFtKToKICAgIHRyeToKICAgICAgICByZXR1cm4gZmxvYXQocGFy
        YW0pCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwYXNzCgojIyMK
        CmRlZiBvbl9mYXRhbChwYXJhbSk6CiAgICBnbG9iYWwgZmF0YWwKICAgIGlm
        IHBhcmFtLmxvd2VyKCkgPT0gInRydWUiOgogICAgICAgIGZhdGFsID0gVHJ1
        ZQogICAgICAgIGluZm8oJ2ZhdGFsIGtpbGxpbmcnKQogICAgZWxzZToKICAg
        ICAgICBpbmZvKCdiYWQgZmF0YWwgY29tbWFuZCcpCgoKZGVmIG9uX2tpbGwo
        cGFyYW0pOgogICAgZ2xvYmFsIGtpbGxlZAogICAgaWYgcGFyYW0ubG93ZXIo
        KSA9PSAidHJ1ZSI6CiAgICAgICAga2lsbGVkID0gVHJ1ZQogICAgICAgIGlu
        Zm8oJ2tpbGxpbmcgc3RyZWFtJykKICAgIGVsc2U6CiAgICAgICAgaW5mbygn
        YmFkIGtpbGwgY29tbWFuZCcpCgoKZGVmIG9uX3BhdXNlKHBhcmFtKToKICAg
        IGdsb2JhbCBwYXVzZWQKICAgIGlmIHBhcmFtOgogICAgICAgIHBhdXNlZCA9
        IHBhcmFtLmxvd2VyKCkgPT0gInRydWUiCiAgICBicm9rZXIucHVibGlzaChn
        ZW5fdG9waWMoInBhdXNlIiksICdvbicgaWYgcGF1c2VkIGVsc2UgJ29mZicp
        CgoKZGVmIG9uX3JhdGUocGFyYW0pOgogICAgZ2xvYmFsIHJhdGUKICAgIGlm
        IHBhcmFtOgogICAgICAgIHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAg
        ICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIHNh
        bXBsZSByYXRlIGNvbW1hbmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAg
        IHJhZGlvLnNldFNhbXBsZVJhdGUoU09BUFlfU0RSX1JYLCAwLCBwYXJhbSkK
        ICAgIHJhdGUgPSByYWRpby5nZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwg
        MCkKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygicmF0ZSIpLCBmJ3ty
        YXRlLzFlMzouM2Z9IEtIeicpCgoKZGVmIG9uX2ZyZXEocGFyYW0pOgogICAg
        aWYgcGFyYW06CiAgICAgICAgcGFyYW0gPSB0b19mbG9hdChwYXJhbSkKICAg
        ICAgICBpZiBwYXJhbSBpcyBOb25lOgogICAgICAgICAgICBpbmZvKCdiYWQg
        ZnJlcXVlbmN5IGNvbW1hbmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAg
        IHJhZGlvLnNldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQog
        ICAgZnJlcSA9IHJhZGlvLmdldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAp
        CiAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoImZyZXEiKSwgZid7ZnJl
        cS8xZTY6LjZmfSBNSHonKQoKCmRlZiBvbl9nYWluKHBhcmFtKToKICAgIGlm
        IHBhcmFtOgogICAgICAgIHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAg
        ICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIGdh
        aW4gY29tbWFuZCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFkaW8u
        c2V0R2FpbihTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQogICAgZ2FpbiA9IHJh
        ZGlvLmdldEdhaW4oU09BUFlfU0RSX1JYLCAwKQogICAgYnJva2VyLnB1Ymxp
        c2goZ2VuX3RvcGljKCJnYWluIiksIGYne2dhaW46LjNnfSBkQicpCgoKZGVm
        IG9uX2F1dG8ocGFyYW0pOgogICAgaWYgcGFyYW06CiAgICAgICAgcmFkaW8u
        c2V0R2Fpbk1vZGUoU09BUFlfU0RSX1JYLCAwLCBwYXJhbS5sb3dlcigpID09
        ICJ0cnVlIikKICAgIGFnYyA9IHJhZGlvLmdldEdhaW5Nb2RlKFNPQVBZX1NE
        Ul9SWCwgMCkKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygiYWdjIiks
        ICdvbicgaWYgYWdjIGVsc2UgJ29mZicpCgoKZGVmIG9uX3NldHRpbmcoa2V5
        LCBwYXJhbSk6CiAgICBpZiBwYXJhbToKICAgICAgICByYWRpby53cml0ZVNl
        dHRpbmcoa2V5LCBwYXJhbSkKICAgIHZhbCA9IHJhZGlvLnJlYWRTZXR0aW5n
        KGtleSkKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYyhrZXkpLCBzdHIo
        dmFsKSkKCgpkZWYgb25fcHBzKHRzKToKICAgIGlmIHRpbWVmaWxlIGFuZCBu
        b3QgcGF1c2VkOgogICAgICAgIHNlYyA9IHNhbXBsZXNfdG90YWwgLyByYXRl
        CiAgICAgICAgZHQgPSBkYXRldGltZS5zdHJwdGltZSh0cywgIiVZLSVtLSVk
        VCVIOiVNOiVTLiVmWiIpCiAgICAgICAgaWYgZHQuc2Vjb25kICUgYXJncy5y
        ZWZlc2hfcHBzID09IDA6CiAgICAgICAgICAgIGluZm8odHMpCiAgICAgICAg
        dGltZWZpbGUud3JpdGUoZiJ7c2VjOi4zZn1cdHtzZWM6LjNmfVx0e3RzfVxu
        IikKICAgICAgICB0aW1lZmlsZS5mbHVzaCgpCgoKZGVmIG9uX21lc3NhZ2Uo
        Y2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAgIHBheWxvYWQgPSBtc2cucGF5
        bG9hZC5kZWNvZGUoJ2xhdGluJykuc3RyaXAoKQogICAgdHJ5OgogICAgICAg
        IGlmIHBheWxvYWQgYW5kIG1zZy50b3BpYyA9PSBhcmdzLnBwc190b3BpYzoK
        ICAgICAgICAgICAgb25fcHBzKHBheWxvYWQpCiAgICAgICAgaWYgcGF5bG9h
        ZCBhbmQgbXNnLnRvcGljID09IGFyZ3MudG9waWM6CiAgICAgICAgICAgIGNt
        ZCwgXywgcGFyYW0gPSBwYXlsb2FkLnBhcnRpdGlvbignICcpIAogICAgICAg
        ICAgICBwYXJhbSA9IHBhcmFtLnN0cmlwKCkKICAgICAgICAgICAgaWYgY21k
        ID09ICdwJzoKICAgICAgICAgICAgICAgIG9uX3BhdXNlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZyc6CiAgICAgICAgICAgICAgICBvbl9n
        YWluKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnYSc6CiAgICAg
        ICAgICAgICAgICBvbl9hdXRvKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAncic6CiAgICAgICAgICAgICAgICBvbl9yYXRlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZic6CiAgICAgICAgICAgICAgICBvbl9m
        cmVxKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnayc6CiAgICAg
        ICAgICAgICAgICBvbl9raWxsKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAnSyc6CiAgICAgICAgICAgICAgICBvbl9mYXRhbChwYXJhbSkKICAg
        ICAgICAgICAgZWxpZiBjbWQgPT0gJ2RzJzoKICAgICAgICAgICAgICAgIG9u
        X3NldHRpbmcoImRpcmVjdF9zYW1wIiwgcGFyYW0pCiAgICAgICAgICAgIGVs
        aWYgY21kID09ICdpcSc6CiAgICAgICAgICAgICAgICBvbl9zZXR0aW5nKCJp
        cV9zd2FwIiwgcGFyYW0pCiAgICAgICAgICAgIGVsaWYgY21kID09ICdidCc6
        CiAgICAgICAgICAgICAgICBvbl9zZXR0aW5nKCJiaWFzdGVlIiwgcGFyYW0p
        CiAgICAgICAgICAgIGVsaWYgY21kID09ICdkYSc6CiAgICAgICAgICAgICAg
        ICBvbl9zZXR0aW5nKCJkaWdpdGFsX2FnYyIsIHBhcmFtKQogICAgICAgICAg
        ICBlbGlmIGNtZCA9PSAnb3QnOgogICAgICAgICAgICAgICAgb25fc2V0dGlu
        Zygib2Zmc2V0X3R1bmUiLCBwYXJhbSkKICAgICAgICAgICAgZWxzZToKICAg
        ICAgICAgICAgICAgIGluZm8oJ3Vua25vd24gY29tbWFuZCcpCiAgICBleGNl
        cHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgaW5mbyhmIkV4Y2VwdGlvbiBv
        bl9tZXNzYWdlKCk6IHtlfSIpCgoKZGVmIG9uX2Nvbm5lY3QoY2xpZW50LCB1
        c2VyZGF0YSwgZmxhZ3MsIHJjKToKICAgIGNsaWVudC5zdWJzY3JpYmUoZ2Vu
        X3RvcGljKCcjJykpCiAgICBjbGllbnQuc3Vic2NyaWJlKGFyZ3MucHBzX3Rv
        cGljKQoKCiMjIyMjIyMjIyMjIyMjIzMKCgpkZWYgaW5mbyhwYXlsb2FkKToK
        ICAgIHByaW50KHBheWxvYWQsIGZpbGU9c3lzLnN0ZGVycikKICAgIGlmIGJy
        b2tlcjoKICAgICAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoImluZm8i
        KSwgcGF5bG9hZCkKCgpkZWYgbG9nX2hhbmRsZXIobG9nX2xldmVsLCBsb2df
        bWVzc2FnZSk6CiAgICBpZiBicm9rZXI6CiAgICAgICAgYnJva2VyLnB1Ymxp
        c2goZ2VuX3RvcGljKCJsb2ciKSwgbG9nX21lc3NhZ2UpCgoKZGVmIHdhdl9o
        ZWFkZXIocmF0ZSwgY2hhbm5lbHM9Miwgc2FtcGxlX2J5dGVzPTQpOgogICAg
        cmF0ZSA9IGludChyYXRlKQogICAgZGF0YV9pZCA9IGInZGF0YScKICAgIGRh
        dGFfc2l6ZSA9IDB4ODAwMDAwMDAKICAgIHJpZmZfaWQgPSBiJ1JJRkYnCiAg
        ICByaWZmX2Zvcm1hdCA9IGInV0FWRScKICAgIGZtdF9pZCA9IGInZm10ICcK
        ICAgIGZtdF9zaXplID0gMTYKICAgIGZtdF9mb3JtYXQgPSAzICAgICMgSUVF
        RV9GTE9BVAogICAgYnVmID0gc3RydWN0LnBhY2soJzw0c0k0cycsIHJpZmZf
        aWQsIGRhdGFfc2l6ZSArIDIwICsgZm10X3NpemUsIHJpZmZfZm9ybWF0KQog
        ICAgYnVmICs9IHN0cnVjdC5wYWNrKCc8NHNJSEgnLCBmbXRfaWQsIGZtdF9z
        aXplLCBmbXRfZm9ybWF0LCBjaGFubmVscykKICAgIGJ1ZiArPSBzdHJ1Y3Qu
        cGFjaygnPElJSEgnLAogICAgICAgIHJhdGUsICAgICAgICAgICAgICAgICAg
        ICAgICAgICAgIyAzMi1iaXQKICAgICAgICByYXRlICogY2hhbm5lbHMgKiBz
        YW1wbGVfYnl0ZXMsICMgMzItYml0CiAgICAgICAgY2hhbm5lbHMgKiBzYW1w
        bGVfYnl0ZXMsCiAgICAgICAgc2FtcGxlX2J5dGVzICogOCkKICAgIGJ1ZiAr
        PSBzdHJ1Y3QucGFjaygnPDRzSScsIGRhdGFfaWQsIGRhdGFfc2l6ZSkKICAg
        IHJldHVybiBidWYKCgpkZWYgcmFkaW9fY29ubmVjdCgpOgogICAgZ2xvYmFs
        IHJhZGlvCiAgICBkcml2ZXJzID0gWyBkWydkcml2ZXInXSBmb3IgZCBpbiBT
        b2FweVNEUi5EZXZpY2UuZW51bWVyYXRlKCkgXQogICAgaW5mbyhmIkZvdW5k
        IGRyaXZlcnM6IHtkcml2ZXJzfSIpCiAgICBrdyA9IHt9CiAgICBpZiBhcmdz
        LmRyaXZlcjoKICAgICAgICBrd1snZHJpdmVyJ10gPSBhcmdzLmRyaXZlcgog
        ICAgaW5mbyhmIlBhc3NpbmcgdGhlIGZvbGxvd2luZyBhcmd1bWVudHM6IHtr
        d30iKQogICAgcmFkaW8gPSBTb2FweVNEUi5EZXZpY2Uoa3cpCgoKZGVmIHJh
        ZGlvX3NldHRpbmdzKCk6CiAgICBpbmZvKGYiSW5pdGlhbGl6aW5nIHJhZGlv
        IHNldHRpbmdzIikKICAgIGlmIGFyZ3MuZnJlcToKICAgICAgICByYWRpby5z
        ZXRGcmVxdWVuY3koU09BUFlfU0RSX1JYLCAwLCBhcmdzLmZyZXEpCiAgICBp
        ZiBhcmdzLnJhdGU6CiAgICAgICAgcmFkaW8uc2V0U2FtcGxlUmF0ZShTT0FQ
        WV9TRFJfUlgsIDAsIGFyZ3MucmF0ZSkKICAgIHJhZGlvLnNldEdhaW5Nb2Rl
        KFNPQVBZX1NEUl9SWCwgMCwgYXJncy5hZ2MpOwogICAgaWYgYXJncy5nYWlu
        OgogICAgICAgIHJhZGlvLnNldEdhaW4oU09BUFlfU0RSX1JYLCAwLCBhcmdz
        LmdhaW4pCiAgICBpZiBhcmdzLmRpcmVjdF9zYW1wOgogICAgICAgIHJhZGlv
        LndyaXRlU2V0dGluZygiZGlyZWN0X3NhbXAiLCBhcmdzLmRpcmVjdF9zYW1w
        KQogICAgaWYgYXJncy5pcV9zd2FwOgogICAgICAgIHJhZGlvLndyaXRlU2V0
        dGluZygiaXFfc3dhcCIsICJ0cnVlIikKICAgIGlmIGFyZ3MuYmlhc3RlZToK
        ICAgICAgICByYWRpby53cml0ZVNldHRpbmcoImJpYXN0ZWUiLCAidHJ1ZSIp
        CiAgICBpZiBhcmdzLmRpZ2l0YWxfYWdjOgogICAgICAgIHJhZGlvLndyaXRl
        U2V0dGluZygiZGlnaXRhbF9hZ2MiLCAidHJ1ZSIpCiAgICBpZiBhcmdzLmRp
        Z2l0YWxfYWdjOgogICAgICAgIHJhZGlvLndyaXRlU2V0dGluZygib2Zmc2V0
        X3R1bmUiLCAidHJ1ZSIpCgoKZGVmIG1haW5faW5pdCgpOgogICAgZ2xvYmFs
        IHBhdXNlZCwga2lsbGVkLCBmYXRhbAogICAga2lsbGVkID0gRmFsc2UKICAg
        IGZhdGFsID0gRmFsc2UKICAgIHBhdXNlZCA9IGFyZ3MucGF1c2UKCgpkZWYg
        YnJva2VyX2luaXQoKToKICAgIGdsb2JhbCBicm9rZXIsIHRpbWVmaWxlCiAg
        ICB0aW1lZmlsZSA9IE5vbmUKICAgIGJyb2tlciA9IE5vbmUKICAgIGlmIG5v
        dCBhcmdzLm5vYnJva2VyOgogICAgICAgIGluZm8oZiJDb25uZWN0aW5nIHRv
        IGJyb2tlcjoge2FyZ3MuYnJva2VyfSIpCiAgICAgICAgYnJva2VyID0gbXF0
        dC5DbGllbnQoKQogICAgICAgIGJyb2tlci5vbl9jb25uZWN0ID0gb25fY29u
        bmVjdAogICAgICAgIGJyb2tlci5vbl9tZXNzYWdlID0gb25fbWVzc2FnZQog
        ICAgICAgIGJyb2tlci5jb25uZWN0KGFyZ3MuYnJva2VyLCBhcmdzLnBvcnQs
        IGFyZ3Mua2VlcGFsaXZlKQogICAgICAgIGJyb2tlci5sb29wX3N0YXJ0KCkK
        CgpkZWYgbWFpbigpOgogICAgYnJva2VyX2luaXQoKQogICAgU29hcHlTRFIu
        cmVnaXN0ZXJMb2dIYW5kbGVyKGxvZ19oYW5kbGVyKQogICAgaW5pdGlhbGl6
        ZWQ9IEZhbHNlCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAg
        ICAgICAgbWFpbl9pbml0KCkKICAgICAgICAgICAgcmFkaW9fY29ubmVjdCgp
        CiAgICAgICAgICAgIGlmIG5vdCBpbml0aWFsaXplZDoKICAgICAgICAgICAg
        ICAgIHJhZGlvX3NldHRpbmdzKCkKICAgICAgICAgICAgaW5pdGlhbGl6ZWQg
        PSBUcnVlCiAgICAgICAgICAgIHJhZGlvX3N0YXJ0KCkKICAgICAgICBleGNl
        cHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGluZm8oZiJFeGNlcHRp
        b24gbWFpbigpOiB7ZX0iKQogICAgICAgICAgICB0aW1lLnNsZWVwKHJlc3Rh
        cnRfc2Vjb25kcykKCgpkZWYgY2xvc2VfZmlsZShmLCBuYW1lKToKICAgIGlm
        IGY6CiAgICAgICAgaW5mbyhmIkNsb3Npbmcge25hbWV9IGZpbGUuIikKICAg
        ICAgICBmLmNsb3NlKCkKCgpkZWYgb3Blbl9maWxlcygpOgogICAgZHQgPSBk
        YXRldGltZS51dGNub3coKQogICAgdHMgPSBkdC5zdHJmdGltZSgnJXklbSVk
        XyVIJU0lUycpCiAgICBmcmVxID0gcmFkaW8uZ2V0RnJlcXVlbmN5KFNPQVBZ
        X1NEUl9SWCwgMCkKICAgIGJhc2VuYW1lID0gZiJ7YXJncy5vdXRwdXR9X3t0
        c31aX3tmcmVxLzFlNjouNmZ9TUh6IgogICAgZXh0ID0gJ3R4dCcKICAgIGZp
        bGVuYW1lID0gZiJ7YmFzZW5hbWV9LntleHR9IgogICAgaW5mbyhmIk9wZW5p
        bmcge2ZpbGVuYW1lfSBmb3IgZ3BzIHBwcyB0aW1lIikKICAgIHRpbWVmaWxl
        ID0gb3BlbihmaWxlbmFtZSwgInciKQogICAgZXh0ID0gJ3JhdycgaWYgYXJn
        cy5ub3dhdmUgZWxzZSAnd2F2JwogICAgZmlsZW5hbWUgPSBmIntiYXNlbmFt
        ZX0ue2V4dH0iCiAgICBpbmZvKGYiT3BlbmluZyB7ZmlsZW5hbWV9IGZvciBh
        dWRpbyIpCiAgICBhdWRpb2ZpbGUgPSBvcGVuKGZpbGVuYW1lLCAid2IiKQog
        ICAgaWYgbm90IGFyZ3Mubm93YXZlOgogICAgICAgIGF1ZGlvZmlsZS53cml0
        ZSh3YXZfaGVhZGVyKHJhdGU9cmF0ZSkpCiAgICByZXR1cm4gYXVkaW9maWxl
        LCB0aW1lZmlsZQoKCmRlZiBjbG9zZV9zdHJlYW0oc3RyZWFtKToKICAgIGlu
        Zm8oZiJDbG9zaW5nIHJhZGlvIHN0cmVhbS4iKQogICAgcmFkaW8uZGVhY3Rp
        dmF0ZVN0cmVhbShzdHJlYW0pIAogICAgcmFkaW8uY2xvc2VTdHJlYW0oc3Ry
        ZWFtKQoKCmRlZiByYWRpb19wZWFrKHBlYWtfbGV2ZWwpOgogICAgZGIgPSAi
        ezouMWZ9IGRCIi5mb3JtYXQoMjAgKiBucC5sb2cxMChwZWFrX2xldmVsICsg
        MWUtOTkpKQogICAgaWYgYXJncy5tZXRlcjoKICAgICAgICBidWYgPSBmIntk
        Yn1cbiIgaWYgYXJncy5kdW1iIGVsc2UgZiJcMzNbMkt7ZGI6PjlzfVxyIgog
        ICAgICAgIHByaW50KGJ1ZiwgZW5kPSIiLCBmaWxlPXN5cy5zdGRlcnIpCiAg
        ICBpZiBicm9rZXI6CiAgICAgICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGlj
        KCJwZWFrIiksIGRiKQoKCmRlZiByYWRpb19zdGFydCgpOgogICAgZ2xvYmFs
        IHJhdGUsIHRpbWVmaWxlLCBzYW1wbGVzX3RvdGFsCiAgICByYXRlID0gcmFk
        aW8uZ2V0U2FtcGxlUmF0ZShTT0FQWV9TRFJfUlgsIDApCiAgICBzaXplID0g
        YXJncy5wYWNrZXRfc2l6ZQogICAgZGF0YSA9IG5wLmFycmF5KFswXSAqIHNp
        emUgKiAyLCBucC5mbG9hdDMyKQogICAgc3RyZWFtID0gcmFkaW8uc2V0dXBT
        dHJlYW0oU09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMikKICAgIHJhZGlv
        LmFjdGl2YXRlU3RyZWFtKHN0cmVhbSkgCiAgICBzYW1wbGVzX3RvdGFsID0g
        MAogICAgcGVha19sZXZlbCA9IDAKICAgIHNhbXBsZV9udW0gPSAwCiAgICBv
        dXRmaWxlID0gTm9uZQogICAgdHJ5OgogICAgICAgIHdoaWxlIG5vdCBraWxs
        ZWQgYW5kIG5vdCBmYXRhbDoKICAgICAgICAgICAgcmFkaW8ucmVhZFN0cmVh
        bShzdHJlYW0sIFtkYXRhXSwgc2l6ZSkKICAgICAgICAgICAgaWYgbm90IHBh
        dXNlZDoKICAgICAgICAgICAgICAgIGlmIG5vdCBvdXRmaWxlOgogICAgICAg
        ICAgICAgICAgICAgIG91dGZpbGUsIHRpbWVmaWxlID0gb3Blbl9maWxlcygp
        CiAgICAgICAgICAgICAgICBzYW1wbGVzX3RvdGFsICs9IHNpemUKICAgICAg
        ICAgICAgICAgIG91dGZpbGUud3JpdGUoZGF0YSkKICAgICAgICAgICAgcGVh
        a19sZXZlbCA9IG1heChwZWFrX2xldmVsLCBhYnMoZGF0YS5taW4oKSksIGFi
        cyhkYXRhLm1heCgpKSkKICAgICAgICAgICAgc2FtcGxlX251bSArPSBzaXpl
        CiAgICAgICAgICAgIGlmIHNhbXBsZV9udW0gPiByYXRlICogYXJncy5yZWZy
        ZXNoOgogICAgICAgICAgICAgICAgcmFkaW9fcGVhayhwZWFrX2xldmVsKQog
        ICAgICAgICAgICAgICAgcGVha19sZXZlbCA9IDAKICAgICAgICAgICAgICAg
        IHNhbXBsZV9udW0gPSAwCiAgICBleGNlcHQgKEtleWJvYXJkSW50ZXJydXB0
        LCBTeXN0ZW1FcnJvcikgYXMgZToKICAgICAgICBpbmZvKGYiRXhjZXB0aW9u
        IHJhZGlvX3N0YXJ0KCk6IHtlfSIpCiAgICBjbG9zZV9maWxlKG91dGZpbGUs
        ICJhdWRpbyIpCiAgICB0aW1lZmlsZSA9IGNsb3NlX2ZpbGUodGltZWZpbGUs
        ICJ0aW1lIikKICAgIGNsb3NlX3N0cmVhbShzdHJlYW0pCiAgICBpZiBmYXRh
        bDoKICAgICAgICBpbmZvKCJGYXRhbCBjb21tYW5kIGdpdmVuLCBraWxsaW5n
        IHByb2Nlc3MiKQogICAgICAgIHN5cy5leGl0KDEpCgoKaWYgX19uYW1lX18g
        PT0gJ19fbWFpbl9fJzoKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygp
        CiAgICBtYWluKCkKCg==


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqpps
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgYXJncGFyc2UKaW1wb3J0IHBh
        aG8ubXF0dC5jbGllbnQgYXMgbXF0dApmcm9tIGdwcyBpbXBvcnQgZ3BzLCBX
        QVRDSF9FTkFCTEUsIFdBVENIX05FV1NUWUxFCgpwYXJzZXIgPSBhcmdwYXJz
        ZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1hcmdwYXJz
        ZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2VyLmFkZF9h
        cmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxw
        PSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIs
        IGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRk
        X2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhlbHA9J2Jy
        b2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcHMt
        dG9waWMiLCBkZWZhdWx0PSJwcHMiLCBoZWxwPSdQUFMgdG9waWMnKQoKZGVm
        IGdlbl90b3BpYyhuYW1lPU5vbmUpOgogICAgZCA9IGFyZ3MudG9waWMuc3Bs
        aXQoJy8nKVs6LTFdCiAgICBpZiBuYW1lIGlzIG5vdCBOb25lOgogICAgICAg
        IGQuYXBwZW5kKG5hbWUpCiAgICByZXR1cm4gJy8nLmpvaW4oZCkKCmRlZiBv
        bl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCByYyk6CiAgICBj
        bGllbnQuc3Vic2NyaWJlKGdlbl90b3BpYygnIycpKQoKZGVmIG9uX21lc3Nh
        Z2UoY2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAgIHBheWxvYWQgPSBtc2cu
        cGF5bG9hZC5kZWNvZGUoJ2xhdGluJykuc3RyaXAoKQogICAgaWYgbXNnLnRv
        cGljID09IGFyZ3MucHBzX3RvcGljOgogICAgICAgIHByaW50KGYne21zZy50
        b3BpY30ge3BheWxvYWR9JykKCmRlZiBtYWluKCk6CiAgICBjbGllbnQgPSBt
        cXR0LkNsaWVudCgpCiAgICBjbGllbnQub25fY29ubmVjdCA9IG9uX2Nvbm5l
        Y3QKICAgIGNsaWVudC5vbl9tZXNzYWdlID0gb25fbWVzc2FnZQogICAgY2xp
        ZW50LmNvbm5lY3QoYXJncy5icm9rZXIsIGFyZ3MucG9ydCwgYXJncy5rZWVw
        YWxpdmUpCiAgICBjbGllbnQubG9vcF9zdGFydCgpCiAgICBtb2RlID0gV0FU
        Q0hfRU5BQkxFIHwgV0FUQ0hfTkVXU1RZTEUKICAgIHNlc3Npb24gPSBncHMo
        bW9kZT1tb2RlKQogICAgZm9yIG54IGluIHNlc3Npb246CiAgICAgICAgaWYg
        bnhbJ2NsYXNzJ10gPT0gJ1RQVic6CiAgICAgICAgICAgIG1vZGUgPSBueFsn
        bW9kZSddCiAgICAgICAgICAgIHRzID0gbnguZ2V0KCd0aW1lJykKICAgICAg
        ICAgICAgaWYgdHMgYW5kIChtb2RlID09IDIgb3IgbW9kZSA9PSAzKToKICAg
        ICAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKGFyZ3MucHBzX3RvcGljLCB0
        cykgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgYXJncyA9IHBh
        cnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqclient
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgc3lzCmltcG9ydCBhcmdwYXJz
        ZQppbXBvcnQgcGFoby5tcXR0LmNsaWVudCBhcyBtcXR0CgpwYXJzZXIgPSBh
        cmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1h
        cmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEi
        LCBoZWxwPSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0t
        cG9ydCIsIGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhl
        bHA9J2Jyb2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdjb21tYW5kIHRvcGlj
        JykKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCBy
        Yyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKCIjIikKCmRlZiBvbl9tZXNzYWdl
        KGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAgICBwcmludChtc2cudG9waWMg
        KyAiICIgKyBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykpCgpkZWYgbWFp
        bigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50Lm9u
        X2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2FnZSA9
        IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2VyLCBh
        cmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bfc3Rh
        cnQoKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICBsaW5lID0gbmV4dChzeXMu
        c3RkaW4pLnJzdHJpcCgpCiAgICAgICAgY2xpZW50LnB1Ymxpc2goYXJncy50
        b3BpYywgbGluZSkgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAg
        YXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==



  - become: yes
    copy:
      dest: /lib/systemd/system/mqproxy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqproxy
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqsoapy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqsoapy --pause --output {{ fs_path }}/out
        # WorkingDirectory={{ fs_path }}
        User=george
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqpps.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqpps
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    shell: |
      sudo systemctl enable mqproxy
      sudo systemctl enable mqsoapy
      sudo systemctl enable mqpps

  - become: yes
    shell: |
      sudo systemctl restart mqproxy
      sudo systemctl restart mqsoapy
      sudo systemctl restart mqpps

