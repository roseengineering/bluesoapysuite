---
  - set_fact:
      fs_path: "{{ fs_path | default('/srv') }}"

  # output directory

  - become: yes
    file: path={{ fs_path }} state=directory owner={{ user }} group={{ user }}

  # bluezero / mqtt

  - become: yes
    apt:
      name:
      - python3-dbus

  - become: yes
    pip:
      name:
      - bluezero
      - paho-mqtt

  - become: yes
    copy:
      dest: /etc/dbus-1/system.d/ukBaz.bluezero.conf 
      content: |
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE busconfig PUBLIC 
         "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
         "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
        <busconfig>
          <policy context="default">
            <allow own="ukBaz.bluezero"/>
            <allow send_destination="ukBaz.bluezero"
                   send_interface="org.freedesktop.DBus.Introspectable"/>
            <allow send_type="method_call" log="true"/>
          </policy>
        </busconfig>

  # bluesoapy

  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqproxy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCmZyb20gYmx1ZXplcm8gaW1wb3J0IHBlcmlw
        aGVyYWwKClVBUlRfU0VSSVZDRSA9ICc2RTQwMDAwMS1CNUEzLUYzOTMtRTBB
        OS1FNTBFMjREQ0NBOUUnClJYX0NIQVJBQ1RFUklTVElDID0gJzZFNDAwMDAy
        LUI1QTMtRjM5My1FMEE5LUU1MEUyNERDQ0E5RScKVFhfQ0hBUkFDVEVSSVNU
        SUMgPSAnNkU0MDAwMDMtQjVBMy1GMzkzLUUwQTktRTUwRTI0RENDQTlFJwoK
        Y2xhc3MgVWFydFNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgb25y
        ZWFkLCBhbGlhcz0nUlBpX1VBUlQnKToKICAgICAgICBzZWxmLm9ucmVhZCA9
        IG9ucmVhZAogICAgICAgIHNlbGYuYXBwID0gcGVyaXBoZXJhbC5BcHBsaWNh
        dGlvbigpCiAgICAgICAgc2VsZi5ibGVfdWFydCA9IHBlcmlwaGVyYWwuU2Vy
        dmljZShVQVJUX1NFUklWQ0UsIFRydWUpCiAgICAgICAgc2VsZi5yeF91YXJ0
        ID0gcGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhSWF9DSEFSQUNURVJJU1RJ
        QywKICAgICAgICAgICAgWyd3cml0ZScsICd3cml0ZS13aXRob3V0LXJlc3Bv
        bnNlJ10sIHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi50eF91YXJ0ID0g
        cGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhUWF9DSEFSQUNURVJJU1RJQywK
        ICAgICAgICAgICAgWydub3RpZnknXSwgc2VsZi5ibGVfdWFydCkKICAgICAg
        ICBzZWxmLnJ4X3VhcnQuYWRkX3dyaXRlX2V2ZW50KHNlbGYudWFydF9wcmlu
        dCkKICAgICAgICBzZWxmLmJsZV91YXJ0LmFkZF9jaGFyYWN0ZXJpc3RpYyhz
        ZWxmLnJ4X3VhcnQpCiAgICAgICAgc2VsZi5ibGVfdWFydC5hZGRfY2hhcmFj
        dGVyaXN0aWMoc2VsZi50eF91YXJ0KQogICAgICAgIHNlbGYuYXBwLmFkZF9z
        ZXJ2aWNlKHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi5hcHAuZG9uZ2xl
        LmFsaWFzID0gYWxpYXMKICAgIGRlZiB1YXJ0X3ByaW50KHNlbGYsIGRhdGEp
        OgogICAgICAgIHZhbHVlID0gJycuam9pbihjaHIobGV0dGVyKSBmb3IgbGV0
        dGVyIGluIGRhdGEpCiAgICAgICAgc2VsZi5vbnJlYWQodmFsdWUpCiAgICBk
        ZWYgc3RhcnQoc2VsZik6CiAgICAgICAgc2VsZi5hcHAuc3RhcnQoKQoKIyMj
        IyMjIyMjIyMjIyMjIyMjIyMjIwoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBw
        YWhvLm1xdHQuY2xpZW50IGFzIG1xdHQKZnJvbSBkYXRldGltZSBpbXBvcnQg
        ZGF0ZXRpbWUKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKAog
        ICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVmYXVsdHNI
        ZWxwRm9ybWF0dGVyKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWJyb2tlciIs
        IGRlZmF1bHQ9IjEyNy4wLjAuMSIsIGhlbHA9J2Jyb2tlciBob3N0JykKcGFy
        c2VyLmFkZF9hcmd1bWVudCgiLS1wb3J0IiwgZGVmYXVsdD0xODgzLCBoZWxw
        PSdicm9rZXIgcG9ydCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0ta2VlcGFs
        aXZlIiwgZGVmYXVsdD02MCwgaGVscD0nYnJva2VyIGtlZXAgYWxpdmUnKQpw
        YXJzZXIuYWRkX2FyZ3VtZW50KCItLXRvcGljIiwgZGVmYXVsdD0iZi90eCIs
        IGhlbHA9J2NvbW1hbmQgdG9waWMnKQoKZGVmIG1haW4oKToKICAgIGRlZiBv
        bmNvbm5lY3QoY2xpZW50LCB1c2VyZGF0YSwgZmxhZ3MsIHJjKToKICAgICAg
        ICBjbGllbnQuc3Vic2NyaWJlKCcjJykKICAgIGRlZiBvbndyaXRlKHZhbHVl
        KToKICAgICAgICBjbGllbnQucHVibGlzaChhcmdzLnRvcGljLCB2YWx1ZSkK
        ICAgIGRlZiBvbm1lc3NhZ2UoY2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAg
        ICAgICBwYXlsb2FkID0gbXNnLnBheWxvYWQuZGVjb2RlKCdsYXRpbicpCiAg
        ICAgICAgdHMgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMn
        KQogICAgICAgIHVhcnQudHhfdWFydC5zZW5kX25vdGlmeV9ldmVudChmJ3t0
        c30ge21zZy50b3BpY30ge3BheWxvYWR9JykKICAgIHVhcnQgPSBVYXJ0U2Vy
        dmljZShvbndyaXRlKQogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAg
        Y2xpZW50Lm9uX2Nvbm5lY3QgPSBvbmNvbm5lY3QKICAgIGNsaWVudC5vbl9t
        ZXNzYWdlID0gb25tZXNzYWdlCiAgICBjbGllbnQuY29ubmVjdChhcmdzLmJy
        b2tlciwgYXJncy5wb3J0LCBhcmdzLmtlZXBhbGl2ZSkKICAgIGNsaWVudC5s
        b29wX3N0YXJ0KCkKICAgIHVhcnQuc3RhcnQoKQoKaWYgX19uYW1lX18gPT0g
        J19fbWFpbl9fJzoKICAgICMgcHJveHkgYmxlIHVhcnQgdG8gbXF0dCBicm9r
        ZXIKICAgICMgdGhpcyBuZWVkcyB0byBydW4gYXMgcm9vdAogICAgYXJncyA9
        IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqsoapy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgb3MsIHN5cywgdGltZQppbXBv
        cnQgc3RydWN0CmltcG9ydCBhcmdwYXJzZQppbXBvcnQgbnVtcHkgYXMgbnAK
        aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgU29hcHlT
        RFIKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBTb2FweVNE
        UiBpbXBvcnQgU09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMgoKcmVzdGFy
        dF9zZWNvbmRzID0gMTAKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFy
        c2VyKAogICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVm
        YXVsdHNIZWxwRm9ybWF0dGVyKQoKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1i
        cm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxwPSdicm9rZXIgaG9z
        dCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIGRlZmF1bHQ9MTg4
        MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhlbHA9J2Jyb2tlciBrZWVwYWxp
        dmUgaW4gc2Vjb25kcycpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tdG9waWMi
        LCBkZWZhdWx0PSJmL3R4IiwgaGVscD0nbXF0dCB0b3BpYyBmb3IgY29tbWFu
        ZCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcHBzLXRvcGljIiwgZGVmYXVs
        dD0icHBzIiwgaGVscD0nbXF0dCB0b3BpYyBmb3IgZ3BzIHRpbWUnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWRyaXZlciIsIGhlbHA9J25hbWUgb2YgZHJp
        dmVyJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wYWNrZXQtc2l6ZSIsIGRl
        ZmF1bHQ9MTAyNCwgaGVscD0ncGFja2V0IHNpemUnKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLWZyZXEiLCB0eXBlPW5wLmZsb2F0LCBoZWxwPSJjZW50ZXIg
        ZnJlcXVlbmN5IGluIGhlcnR6IikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1y
        YXRlIiwgdHlwZT1ucC5mbG9hdCwgaGVscD0ic2FtcGxlIHJhdGUgaW4gaGVy
        dHoiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWdhaW4iLCB0eXBlPW5wLmZs
        b2F0LCBoZWxwPSJmcm9udCBlbmQgZ2FpbiBpbiBkQiIpCnBhcnNlci5hZGRf
        YXJndW1lbnQoIi0tYWdjIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0i
        ZW5hYmxlIEFHQyIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tbm9icm9rZXIi
        LCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJkaXNhYmxlIG1xdHQgYnJv
        a2VyIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kdW1iIiwgYWN0aW9uPSJz
        dG9yZV90cnVlIiwgaGVscD0iZHVtYiB0ZXJtaW5hbCIpCnBhcnNlci5hZGRf
        YXJndW1lbnQoIi0tb3V0cHV0IiwgZGVmYXVsdD0ib3V0IiwgaGVscD0id3Jp
        dGUgQ0YzMiBzYW1wbGVzIHRvIGZpbGUiKQpwYXJzZXIuYWRkX2FyZ3VtZW50
        KCItLW5vd2F2ZSIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2Fi
        bGUgV0FWIGhlYWRlciIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tbWV0ZXIi
        LCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJlbmFibGUgY29uc29sZSBw
        ZWFrIG1ldGVyIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wYXVzZSIsIGFj
        dGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9InBhdXNlIG91dHB1dCIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tcmVmcmVzaCIsIGRlZmF1bHQ9NSwgaGVscD0i
        cGVhayBtZXRlciByZWZyZXNoIGluIHNlY29uZHMiKQoKIyBhcmdTdHJpbmcK
        cGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kaXJlY3Qtc2FtcCIsIGhlbHA9IjA9
        b2ZmLCAxPUksIDI9USBjaGFubmVsIikKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS1pcS1zd2FwIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0ic3dhcCBJ
        USBzaWduYWxzIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1iaWFzdGVlIiwg
        YWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZW5hYmxlIGJpYXMgdGVlIikK
        cGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kaWdpdGFsLWFnYyIsIGFjdGlvbj0i
        c3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBkaWdpdGFsIEFHQyIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tb2Zmc2V0LXR1bmUiLCBhY3Rpb249InN0b3Jl
        X3RydWUiLCBoZWxwPSJlbmFibGUgb2Zmc2V0IHR1bmUiKQoKCmRlZiBnZW5f
        dG9waWMobmFtZT1Ob25lKToKICAgIGQgPSBhcmdzLnRvcGljLnNwbGl0KCcv
        JylbOi0xXQogICAgaWYgbmFtZSBpcyBub3QgTm9uZToKICAgICAgICBkLmFw
        cGVuZChuYW1lKQogICAgcmV0dXJuICcvJy5qb2luKGQpCgoKZGVmIHRvX2Zs
        b2F0KHBhcmFtKToKICAgIHRyeToKICAgICAgICByZXR1cm4gZmxvYXQocGFy
        YW0pCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwYXNzCgoKZGVm
        IG9uX2ZhdGFsKHBhcmFtKToKICAgIGdsb2JhbCBmYXRhbAogICAgaWYgcGFy
        YW0ubG93ZXIoKSA9PSAidHJ1ZSI6CiAgICAgICAgZmF0YWwgPSBUcnVlCiAg
        ICAgICAgaW5mbygnZmF0YWwga2lsbGluZycpCiAgICBlbHNlOgogICAgICAg
        IGluZm8oJ2JhZCBmYXRhbCBjb21tYW5kJykKCgpkZWYgb25fa2lsbChwYXJh
        bSk6CiAgICBnbG9iYWwga2lsbGVkCiAgICBpZiBwYXJhbS5sb3dlcigpID09
        ICJ0cnVlIjoKICAgICAgICBraWxsZWQgPSBUcnVlCiAgICAgICAgaW5mbygn
        a2lsbGluZyBzdHJlYW0nKQogICAgZWxzZToKICAgICAgICBpbmZvKCdiYWQg
        a2lsbCBjb21tYW5kJykKCgpkZWYgb25fcGF1c2UocGFyYW0pOgogICAgZ2xv
        YmFsIHBhdXNlZAogICAgaWYgcGFyYW06CiAgICAgICAgcGF1c2VkID0gcGFy
        YW0ubG93ZXIoKSA9PSAidHJ1ZSIKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90
        b3BpYygicGF1c2UiKSwgJ29uJyBpZiBwYXVzZWQgZWxzZSAnb2ZmJykKCgpk
        ZWYgb25fcmF0ZShwYXJhbSk6CiAgICBnbG9iYWwgcmF0ZQogICAgaWYgcGFy
        YW06CiAgICAgICAgcGFyYW0gPSB0b19mbG9hdChwYXJhbSkKICAgICAgICBp
        ZiBwYXJhbSBpcyBOb25lOgogICAgICAgICAgICBpbmZvKCdiYWQgc2FtcGxl
        IHJhdGUgY29tbWFuZCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFk
        aW8uc2V0U2FtcGxlUmF0ZShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQogICAg
        cmF0ZSA9IHJhZGlvLmdldFNhbXBsZVJhdGUoU09BUFlfU0RSX1JYLCAwKQog
        ICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJyYXRlIiksIGYne3JhdGUv
        MWUzOi4zZn0gS0h6JykKCgpkZWYgb25fZnJlcShwYXJhbSk6CiAgICBpZiBw
        YXJhbToKICAgICAgICBwYXJhbSA9IHRvX2Zsb2F0KHBhcmFtKQogICAgICAg
        IGlmIHBhcmFtIGlzIE5vbmU6CiAgICAgICAgICAgIGluZm8oJ2JhZCBmcmVx
        dWVuY3kgY29tbWFuZCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFk
        aW8uc2V0RnJlcXVlbmN5KFNPQVBZX1NEUl9SWCwgMCwgcGFyYW0pCiAgICBm
        cmVxID0gcmFkaW8uZ2V0RnJlcXVlbmN5KFNPQVBZX1NEUl9SWCwgMCkKICAg
        IGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygiZnJlcSIpLCBmJ3tmcmVxLzFl
        NjouNmZ9IE1IeicpCgoKZGVmIG9uX2dhaW4ocGFyYW0pOgogICAgaWYgcGFy
        YW06CiAgICAgICAgcGFyYW0gPSB0b19mbG9hdChwYXJhbSkKICAgICAgICBp
        ZiBwYXJhbSBpcyBOb25lOgogICAgICAgICAgICBpbmZvKCdiYWQgZ2FpbiBj
        b21tYW5kJykKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWRpby5zZXRH
        YWluKFNPQVBZX1NEUl9SWCwgMCwgcGFyYW0pCiAgICBnYWluID0gcmFkaW8u
        Z2V0R2FpbihTT0FQWV9TRFJfUlgsIDApCiAgICBicm9rZXIucHVibGlzaChn
        ZW5fdG9waWMoImdhaW4iKSwgZid7Z2FpbjouM2d9IGRCJykKCgpkZWYgb25f
        YXV0byhwYXJhbSk6CiAgICBpZiBwYXJhbToKICAgICAgICByYWRpby5zZXRH
        YWluTW9kZShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtLmxvd2VyKCkgPT0gInRy
        dWUiKQogICAgYWdjID0gcmFkaW8uZ2V0R2Fpbk1vZGUoU09BUFlfU0RSX1JY
        LCAwKQogICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJhZ2MiKSwgJ29u
        JyBpZiBhZ2MgZWxzZSAnb2ZmJykKCgpkZWYgb25fc2V0dGluZyhrZXksIHBh
        cmFtKToKICAgIGlmIHBhcmFtOgogICAgICAgIHJhZGlvLndyaXRlU2V0dGlu
        ZyhrZXksIHBhcmFtKQogICAgdmFsID0gcmFkaW8ucmVhZFNldHRpbmcoa2V5
        KQogICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKGtleSksIHN0cih2YWwp
        KQoKCmRlZiBvbl9tZXNzYWdlKGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAg
        ICB0cnk6CiAgICAgICAgcGF5bG9hZCA9IG1zZy5wYXlsb2FkLmRlY29kZSgn
        bGF0aW4nKS5zdHJpcCgpCiAgICAgICAgaWYgcGF5bG9hZCBhbmQgbXNnLnRv
        cGljID09IGFyZ3MucHBzX3RvcGljOgogICAgICAgICAgICBpZiB0aW1lZmls
        ZSBhbmQgbm90IHBhdXNlZDoKICAgICAgICAgICAgICAgIHNlYyA9IHNhbXBs
        ZXNfdG90YWwgLyByYXRlCiAgICAgICAgICAgICAgICB0aW1lZmlsZS53cml0
        ZShmIntzZWM6LjNmfVx0e3NlYzouM2Z9XHR7cGF5bG9hZH1cbiIpCiAgICAg
        ICAgICAgICAgICB0aW1lZmlsZS5mbHVzaCgpCiAgICAgICAgaWYgcGF5bG9h
        ZCBhbmQgbXNnLnRvcGljID09IGFyZ3MudG9waWM6CiAgICAgICAgICAgIGNt
        ZCwgXywgcGFyYW0gPSBwYXlsb2FkLnBhcnRpdGlvbignICcpIAogICAgICAg
        ICAgICBwYXJhbSA9IHBhcmFtLnN0cmlwKCkKICAgICAgICAgICAgaWYgY21k
        ID09ICdwJzoKICAgICAgICAgICAgICAgIG9uX3BhdXNlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZyc6CiAgICAgICAgICAgICAgICBvbl9n
        YWluKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnYSc6CiAgICAg
        ICAgICAgICAgICBvbl9hdXRvKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAncic6CiAgICAgICAgICAgICAgICBvbl9yYXRlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZic6CiAgICAgICAgICAgICAgICBvbl9m
        cmVxKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnayc6CiAgICAg
        ICAgICAgICAgICBvbl9raWxsKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAnSyc6CiAgICAgICAgICAgICAgICBvbl9mYXRhbChwYXJhbSkKICAg
        ICAgICAgICAgZWxpZiBjbWQgPT0gJ2RzJzoKICAgICAgICAgICAgICAgIG9u
        X3NldHRpbmcoImRpcmVjdF9zYW1wIiwgcGFyYW0pCiAgICAgICAgICAgIGVs
        aWYgY21kID09ICdpcSc6CiAgICAgICAgICAgICAgICBvbl9zZXR0aW5nKCJp
        cV9zd2FwIiwgcGFyYW0pCiAgICAgICAgICAgIGVsaWYgY21kID09ICdidCc6
        CiAgICAgICAgICAgICAgICBvbl9zZXR0aW5nKCJiaWFzdGVlIiwgcGFyYW0p
        CiAgICAgICAgICAgIGVsaWYgY21kID09ICdkYSc6CiAgICAgICAgICAgICAg
        ICBvbl9zZXR0aW5nKCJkaWdpdGFsX2FnYyIsIHBhcmFtKQogICAgICAgICAg
        ICBlbGlmIGNtZCA9PSAnb3QnOgogICAgICAgICAgICAgICAgb25fc2V0dGlu
        Zygib2Zmc2V0X3R1bmUiLCBwYXJhbSkKICAgICAgICAgICAgZWxzZToKICAg
        ICAgICAgICAgICAgIGluZm8oJ3Vua25vd24gY29tbWFuZCcpCiAgICBleGNl
        cHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgaW5mbyhmIkV4Y2VwdGlvbiBv
        bl9tZXNzYWdlKCk6IHtlfSIpCgoKZGVmIG9uX2Nvbm5lY3QoY2xpZW50LCB1
        c2VyZGF0YSwgZmxhZ3MsIHJjKToKICAgIGNsaWVudC5zdWJzY3JpYmUoZ2Vu
        X3RvcGljKCcjJykpCiAgICBjbGllbnQuc3Vic2NyaWJlKGFyZ3MucHBzX3Rv
        cGljKQoKCiMjIyMjIyMjIyMjIyMjIzMKCgpkZWYgaW5mbyhwYXlsb2FkKToK
        ICAgIHByaW50KHBheWxvYWQsIGZpbGU9c3lzLnN0ZGVycikKICAgIGlmIGJy
        b2tlcjoKICAgICAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoImluZm8i
        KSwgcGF5bG9hZCkKCgpkZWYgbG9nX2hhbmRsZXIobG9nX2xldmVsLCBsb2df
        bWVzc2FnZSk6CiAgICBpZiBicm9rZXI6CiAgICAgICAgYnJva2VyLnB1Ymxp
        c2goZ2VuX3RvcGljKCJsb2ciKSwgbG9nX21lc3NhZ2UpCgoKZGVmIHdhdl9o
        ZWFkZXIocmF0ZSwgY2hhbm5lbHM9Miwgc2FtcGxlX2J5dGVzPTQpOgogICAg
        cmF0ZSA9IGludChyYXRlKQogICAgZGF0YV9pZCA9IGInZGF0YScKICAgIGRh
        dGFfc2l6ZSA9IDB4ODAwMDAwMDAKICAgIHJpZmZfaWQgPSBiJ1JJRkYnCiAg
        ICByaWZmX2Zvcm1hdCA9IGInV0FWRScKICAgIGZtdF9pZCA9IGInZm10ICcK
        ICAgIGZtdF9zaXplID0gMTYKICAgIGZtdF9mb3JtYXQgPSAzICAgICMgSUVF
        RV9GTE9BVAogICAgYnVmID0gc3RydWN0LnBhY2soJzw0c0k0cycsIHJpZmZf
        aWQsIGRhdGFfc2l6ZSArIDIwICsgZm10X3NpemUsIHJpZmZfZm9ybWF0KQog
        ICAgYnVmICs9IHN0cnVjdC5wYWNrKCc8NHNJSEgnLCBmbXRfaWQsIGZtdF9z
        aXplLCBmbXRfZm9ybWF0LCBjaGFubmVscykKICAgIGJ1ZiArPSBzdHJ1Y3Qu
        cGFjaygnPElJSEgnLAogICAgICAgIHJhdGUsICAgICAgICAgICAgICAgICAg
        ICAgICAgICAgIyAzMi1iaXQKICAgICAgICByYXRlICogY2hhbm5lbHMgKiBz
        YW1wbGVfYnl0ZXMsICMgMzItYml0CiAgICAgICAgY2hhbm5lbHMgKiBzYW1w
        bGVfYnl0ZXMsCiAgICAgICAgc2FtcGxlX2J5dGVzICogOCkKICAgIGJ1ZiAr
        PSBzdHJ1Y3QucGFjaygnPDRzSScsIGRhdGFfaWQsIGRhdGFfc2l6ZSkKICAg
        IHJldHVybiBidWYKCgpkZWYgcmFkaW9fY29ubmVjdCgpOgogICAgZ2xvYmFs
        IHJhZGlvCiAgICBkcml2ZXJzID0gWyBkWydkcml2ZXInXSBmb3IgZCBpbiBT
        b2FweVNEUi5EZXZpY2UuZW51bWVyYXRlKCkgXQogICAgaW5mbyhmIkZvdW5k
        IGRyaXZlcnM6IHtkcml2ZXJzfSIpCiAgICBrdyA9IHt9CiAgICBpZiBhcmdz
        LmRyaXZlcjoKICAgICAgICBrd1snZHJpdmVyJ10gPSBhcmdzLmRyaXZlcgog
        ICAgaW5mbyhmIlBhc3NpbmcgdGhlIGZvbGxvd2luZyBhcmd1bWVudHM6IHtr
        d30iKQogICAgcmFkaW8gPSBTb2FweVNEUi5EZXZpY2Uoa3cpCgoKZGVmIHJh
        ZGlvX3NldHRpbmdzKCk6CiAgICBpbmZvKGYiSW5pdGlhbGl6aW5nIHJhZGlv
        IHNldHRpbmdzIikKICAgIGlmIGFyZ3MuZnJlcToKICAgICAgICByYWRpby5z
        ZXRGcmVxdWVuY3koU09BUFlfU0RSX1JYLCAwLCBhcmdzLmZyZXEpCiAgICBp
        ZiBhcmdzLnJhdGU6CiAgICAgICAgcmFkaW8uc2V0U2FtcGxlUmF0ZShTT0FQ
        WV9TRFJfUlgsIDAsIGFyZ3MucmF0ZSkKICAgIHJhZGlvLnNldEdhaW5Nb2Rl
        KFNPQVBZX1NEUl9SWCwgMCwgYXJncy5hZ2MpOwogICAgaWYgYXJncy5nYWlu
        OgogICAgICAgIHJhZGlvLnNldEdhaW4oU09BUFlfU0RSX1JYLCAwLCBhcmdz
        LmdhaW4pCiAgICBpZiBhcmdzLmRpcmVjdF9zYW1wOgogICAgICAgIHJhZGlv
        LndyaXRlU2V0dGluZygiZGlyZWN0X3NhbXAiLCBhcmdzLmRpcmVjdF9zYW1w
        KQogICAgaWYgYXJncy5pcV9zd2FwOgogICAgICAgIHJhZGlvLndyaXRlU2V0
        dGluZygiaXFfc3dhcCIsICJ0cnVlIikKICAgIGlmIGFyZ3MuYmlhc3RlZToK
        ICAgICAgICByYWRpby53cml0ZVNldHRpbmcoImJpYXN0ZWUiLCAidHJ1ZSIp
        CiAgICBpZiBhcmdzLmRpZ2l0YWxfYWdjOgogICAgICAgIHJhZGlvLndyaXRl
        U2V0dGluZygiZGlnaXRhbF9hZ2MiLCAidHJ1ZSIpCiAgICBpZiBhcmdzLmRp
        Z2l0YWxfYWdjOgogICAgICAgIHJhZGlvLndyaXRlU2V0dGluZygib2Zmc2V0
        X3R1bmUiLCAidHJ1ZSIpCgoKZGVmIG1haW5faW5pdCgpOgogICAgZ2xvYmFs
        IHBhdXNlZCwga2lsbGVkLCBmYXRhbAogICAga2lsbGVkID0gRmFsc2UKICAg
        IGZhdGFsID0gRmFsc2UKICAgIHBhdXNlZCA9IGFyZ3MucGF1c2UKCgpkZWYg
        YnJva2VyX2luaXQoKToKICAgIGdsb2JhbCBicm9rZXIsIHRpbWVmaWxlCiAg
        ICB0aW1lZmlsZSA9IE5vbmUKICAgIGJyb2tlciA9IE5vbmUKICAgIGlmIG5v
        dCBhcmdzLm5vYnJva2VyOgogICAgICAgIGluZm8oZiJDb25uZWN0aW5nIHRv
        IGJyb2tlcjoge2FyZ3MuYnJva2VyfSIpCiAgICAgICAgYnJva2VyID0gbXF0
        dC5DbGllbnQoKQogICAgICAgIGJyb2tlci5vbl9jb25uZWN0ID0gb25fY29u
        bmVjdAogICAgICAgIGJyb2tlci5vbl9tZXNzYWdlID0gb25fbWVzc2FnZQog
        ICAgICAgIGJyb2tlci5jb25uZWN0KGFyZ3MuYnJva2VyLCBhcmdzLnBvcnQs
        IGFyZ3Mua2VlcGFsaXZlKQogICAgICAgIGJyb2tlci5sb29wX3N0YXJ0KCkK
        CgpkZWYgbWFpbigpOgogICAgYnJva2VyX2luaXQoKQogICAgU29hcHlTRFIu
        cmVnaXN0ZXJMb2dIYW5kbGVyKGxvZ19oYW5kbGVyKQogICAgaW5pdGlhbGl6
        ZWQ9IEZhbHNlCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAg
        ICAgICAgbWFpbl9pbml0KCkKICAgICAgICAgICAgcmFkaW9fY29ubmVjdCgp
        CiAgICAgICAgICAgIGlmIG5vdCBpbml0aWFsaXplZDoKICAgICAgICAgICAg
        ICAgIHJhZGlvX3NldHRpbmdzKCkKICAgICAgICAgICAgaW5pdGlhbGl6ZWQg
        PSBUcnVlCiAgICAgICAgICAgIHJhZGlvX3N0YXJ0KCkKICAgICAgICBleGNl
        cHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGluZm8oZiJFeGNlcHRp
        b24gbWFpbigpOiB7ZX0iKQogICAgICAgICAgICB0aW1lLnNsZWVwKHJlc3Rh
        cnRfc2Vjb25kcykKCgpkZWYgY2xvc2VfZmlsZShmLCBuYW1lKToKICAgIGlm
        IGY6CiAgICAgICAgaW5mbyhmIkNsb3Npbmcge25hbWV9IGZpbGUuIikKICAg
        ICAgICBmLmNsb3NlKCkKCgpkZWYgb3Blbl9maWxlcygpOgogICAgZHQgPSBk
        YXRldGltZS51dGNub3coKQogICAgdHMgPSBkdC5zdHJmdGltZSgnJXklbSVk
        XyVIJU0lUycpCiAgICBmcmVxID0gcmFkaW8uZ2V0RnJlcXVlbmN5KFNPQVBZ
        X1NEUl9SWCwgMCkKICAgIGJhc2VuYW1lID0gZiJ7YXJncy5vdXRwdXR9X3t0
        c31aX3tmcmVxLzFlNjouNmZ9TUh6IgogICAgZXh0ID0gJ3R4dCcKICAgIGZp
        bGVuYW1lID0gZiJ7YmFzZW5hbWV9LntleHR9IgogICAgaW5mbyhmIk9wZW5p
        bmcge2ZpbGVuYW1lfSBmb3IgZ3BzIHRpbWUiKQogICAgdGltZWZpbGUgPSBv
        cGVuKGZpbGVuYW1lLCAidyIpCiAgICBleHQgPSAncmF3JyBpZiBhcmdzLm5v
        d2F2ZSBlbHNlICd3YXYnCiAgICBmaWxlbmFtZSA9IGYie2Jhc2VuYW1lfS57
        ZXh0fSIKICAgIGluZm8oZiJPcGVuaW5nIHtmaWxlbmFtZX0gZm9yIGF1ZGlv
        IikKICAgIGF1ZGlvZmlsZSA9IG9wZW4oZmlsZW5hbWUsICJ3YiIpCiAgICBp
        ZiBub3QgYXJncy5ub3dhdmU6CiAgICAgICAgYXVkaW9maWxlLndyaXRlKHdh
        dl9oZWFkZXIocmF0ZT1yYXRlKSkKICAgIHJldHVybiBhdWRpb2ZpbGUsIHRp
        bWVmaWxlCgoKZGVmIGNsb3NlX3N0cmVhbShzdHJlYW0pOgogICAgaW5mbyhm
        IkNsb3NpbmcgcmFkaW8gc3RyZWFtLiIpCiAgICByYWRpby5kZWFjdGl2YXRl
        U3RyZWFtKHN0cmVhbSkgCiAgICByYWRpby5jbG9zZVN0cmVhbShzdHJlYW0p
        CgoKZGVmIHJhZGlvX3BlYWsocGVha19sZXZlbCk6CiAgICBkYiA9ICJ7Oi4x
        Zn0gZEIiLmZvcm1hdCgyMCAqIG5wLmxvZzEwKHBlYWtfbGV2ZWwgKyAxZS05
        OSkpCiAgICBpZiBhcmdzLm1ldGVyOgogICAgICAgIGJ1ZiA9IGYie2RifVxu
        IiBpZiBhcmdzLmR1bWIgZWxzZSBmIlwzM1syS3tkYjo+OXN9XHIiCiAgICAg
        ICAgcHJpbnQoYnVmLCBlbmQ9IiIsIGZpbGU9c3lzLnN0ZGVycikKICAgIGlm
        IGJyb2tlcjoKICAgICAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoInBl
        YWsiKSwgZGIpCgoKZGVmIHJhZGlvX3N0YXJ0KCk6CiAgICBnbG9iYWwgcmF0
        ZSwgdGltZWZpbGUsIHNhbXBsZXNfdG90YWwKICAgIHJhdGUgPSByYWRpby5n
        ZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwgMCkKICAgIHNpemUgPSBhcmdz
        LnBhY2tldF9zaXplCiAgICBkYXRhID0gbnAuYXJyYXkoWzBdICogc2l6ZSAq
        IDIsIG5wLmZsb2F0MzIpCiAgICBzdHJlYW0gPSByYWRpby5zZXR1cFN0cmVh
        bShTT0FQWV9TRFJfUlgsIFNPQVBZX1NEUl9DRjMyKQogICAgcmFkaW8uYWN0
        aXZhdGVTdHJlYW0oc3RyZWFtKSAKICAgIHNhbXBsZXNfdG90YWwgPSAwCiAg
        ICBwZWFrX2xldmVsID0gMAogICAgc2FtcGxlX251bSA9IDAKICAgIG91dGZp
        bGUgPSBOb25lCiAgICB0cnk6CiAgICAgICAgd2hpbGUgbm90IGtpbGxlZCBh
        bmQgbm90IGZhdGFsOgogICAgICAgICAgICByYWRpby5yZWFkU3RyZWFtKHN0
        cmVhbSwgW2RhdGFdLCBzaXplKQogICAgICAgICAgICBpZiBub3QgcGF1c2Vk
        OgogICAgICAgICAgICAgICAgaWYgbm90IG91dGZpbGU6CiAgICAgICAgICAg
        ICAgICAgICAgb3V0ZmlsZSwgdGltZWZpbGUgPSBvcGVuX2ZpbGVzKCkKICAg
        ICAgICAgICAgICAgIHNhbXBsZXNfdG90YWwgKz0gc2l6ZQogICAgICAgICAg
        ICAgICAgb3V0ZmlsZS53cml0ZShkYXRhKQogICAgICAgICAgICBwZWFrX2xl
        dmVsID0gbWF4KHBlYWtfbGV2ZWwsIGFicyhkYXRhLm1pbigpKSwgYWJzKGRh
        dGEubWF4KCkpKQogICAgICAgICAgICBzYW1wbGVfbnVtICs9IHNpemUKICAg
        ICAgICAgICAgaWYgc2FtcGxlX251bSA+IHJhdGUgKiBhcmdzLnJlZnJlc2g6
        CiAgICAgICAgICAgICAgICByYWRpb19wZWFrKHBlYWtfbGV2ZWwpCiAgICAg
        ICAgICAgICAgICBwZWFrX2xldmVsID0gMAogICAgICAgICAgICAgICAgc2Ft
        cGxlX251bSA9IDAKICAgIGV4Y2VwdCAoS2V5Ym9hcmRJbnRlcnJ1cHQsIFN5
        c3RlbUVycm9yKSBhcyBlOgogICAgICAgIGluZm8oZiJFeGNlcHRpb24gcmFk
        aW9fc3RhcnQoKToge2V9IikKICAgIGNsb3NlX2ZpbGUob3V0ZmlsZSwgImF1
        ZGlvIikKICAgIHRpbWVmaWxlID0gY2xvc2VfZmlsZSh0aW1lZmlsZSwgInRp
        bWUiKQogICAgY2xvc2Vfc3RyZWFtKHN0cmVhbSkKICAgIGlmIGZhdGFsOgog
        ICAgICAgIGluZm8oIkZhdGFsIGNvbW1hbmQgZ2l2ZW4sIGtpbGxpbmcgcHJv
        Y2VzcyIpCiAgICAgICAgc3lzLmV4aXQoMSkKCgppZiBfX25hbWVfXyA9PSAn
        X19tYWluX18nOgogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAg
        IG1haW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqpps
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgYXJncGFyc2UKaW1wb3J0IHBh
        aG8ubXF0dC5jbGllbnQgYXMgbXF0dApmcm9tIGRhdGV0aW1lIGltcG9ydCBk
        YXRldGltZQpmcm9tIGdwcyBpbXBvcnQgZ3BzLCBXQVRDSF9FTkFCTEUsIFdB
        VENIX05FV1NUWUxFCgpwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNl
        cigKICAgIGZvcm1hdHRlcl9jbGFzcz1hcmdwYXJzZS5Bcmd1bWVudERlZmF1
        bHRzSGVscEZvcm1hdHRlcikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1icm9r
        ZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxwPSdicm9rZXIgaG9zdCcp
        CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIGRlZmF1bHQ9MTg4Mywg
        aGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWtl
        ZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhlbHA9J2Jyb2tlciBrZWVwIGFsaXZl
        JykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcHMtdG9waWMiLCBkZWZhdWx0
        PSJwcHMiLCBoZWxwPSdQUFMgdG9waWMnKQpwYXJzZXIuYWRkX2FyZ3VtZW50
        KCItLWludGVydmFsIiwgZGVmYXVsdD0xMCwgaGVscD0ncHVibGlzaCBpbnRl
        cnZhbCBpbiBzZWNvbmRzJykKCmRlZiBnZW5fdG9waWMobmFtZT1Ob25lKToK
        ICAgIGQgPSBhcmdzLnRvcGljLnNwbGl0KCcvJylbOi0xXQogICAgaWYgbmFt
        ZSBpcyBub3QgTm9uZToKICAgICAgICBkLmFwcGVuZChuYW1lKQogICAgcmV0
        dXJuICcvJy5qb2luKGQpCgpkZWYgb25fY29ubmVjdChjbGllbnQsIHVzZXJk
        YXRhLCBmbGFncywgcmMpOgogICAgY2xpZW50LnN1YnNjcmliZShnZW5fdG9w
        aWMoJyMnKSkKCmRlZiBvbl9tZXNzYWdlKGNsaWVudCwgdXNlcmRhdGEsIG1z
        Zyk6CiAgICBwYXlsb2FkID0gbXNnLnBheWxvYWQuZGVjb2RlKCdsYXRpbicp
        LnN0cmlwKCkKICAgIGlmIG1zZy50b3BpYyA9PSBhcmdzLnBwc190b3BpYzoK
        ICAgICAgICBwcmludChmJ3ttc2cudG9waWN9IHtwYXlsb2FkfScpCgpkZWYg
        bWFpbigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50
        Lm9uX2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2Fn
        ZSA9IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2Vy
        LCBhcmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bf
        c3RhcnQoKQogICAgbW9kZSA9IFdBVENIX0VOQUJMRSB8IFdBVENIX05FV1NU
        WUxFCiAgICBzZXNzaW9uID0gZ3BzKG1vZGU9bW9kZSkKICAgIGZvciBueCBp
        biBzZXNzaW9uOgogICAgICAgIGlmIG54WydjbGFzcyddID09ICdUUFYnOgog
        ICAgICAgICAgICBtb2RlID0gbnhbJ21vZGUnXQogICAgICAgICAgICB0cyA9
        IG54LmdldCgndGltZScpCiAgICAgICAgICAgIGlmIHRzIGFuZCAobW9kZSA9
        PSAyIG9yIG1vZGUgPT0gMyk6CiAgICAgICAgICAgICAgICBkdCA9IGRhdGV0
        aW1lLnN0cnB0aW1lKHRzLCAiJVktJW0tJWRUJUg6JU06JVMuJWZaIikKICAg
        ICAgICAgICAgICAgIGlmIGR0LnNlY29uZCAlIGFyZ3MuaW50ZXJ2YWwgPT0g
        MDoKICAgICAgICAgICAgICAgICAgICBjbGllbnQucHVibGlzaChhcmdzLnBw
        c190b3BpYywgdHMpIAoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAg
        IGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCiAgICBtYWluKCkKCgo=


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqclient
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgc3lzCmltcG9ydCBhcmdwYXJz
        ZQppbXBvcnQgcGFoby5tcXR0LmNsaWVudCBhcyBtcXR0CgpwYXJzZXIgPSBh
        cmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1h
        cmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEi
        LCBoZWxwPSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0t
        cG9ydCIsIGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhl
        bHA9J2Jyb2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdjb21tYW5kIHRvcGlj
        JykKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCBy
        Yyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKCIjIikKCmRlZiBvbl9tZXNzYWdl
        KGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAgICBwcmludChtc2cudG9waWMg
        KyAiICIgKyBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykpCgpkZWYgbWFp
        bigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50Lm9u
        X2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2FnZSA9
        IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2VyLCBh
        cmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bfc3Rh
        cnQoKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICBsaW5lID0gbmV4dChzeXMu
        c3RkaW4pLnJzdHJpcCgpCiAgICAgICAgY2xpZW50LnB1Ymxpc2goYXJncy50
        b3BpYywgbGluZSkgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAg
        YXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==



  - become: yes
    copy:
      dest: /lib/systemd/system/mqproxy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqproxy
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqsoapy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqsoapy --pause --output {{ fs_path }}/out
        # WorkingDirectory={{ fs_path }}
        User=george
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqpps.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqpps
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    shell: |
      sudo systemctl enable mqproxy
      sudo systemctl enable mqsoapy
      sudo systemctl enable mqpps

  - become: yes
    shell: |
      sudo systemctl restart mqproxy
      sudo systemctl restart mqsoapy
      sudo systemctl restart mqpps

