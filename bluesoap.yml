---
  - set_fact:
      fs_path: "{{ fs_path | default('/srv') }}"

  # output directory

  - become: yes
    file: path={{ fs_path }} state=directory owner={{ user }} group={{ user }}

  # bluezero / mqtt

  - become: yes
    apt:
      name:
      - python3-dbus

  - become: yes
    pip:
      name:
      - bluezero
      - paho-mqtt

  - become: yes
    copy:
      dest: /etc/dbus-1/system.d/ukBaz.bluezero.conf 
      content: |
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE busconfig PUBLIC 
         "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
         "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
        <busconfig>
          <policy context="default">
            <allow own="ukBaz.bluezero"/>
            <allow send_destination="ukBaz.bluezero"
                   send_interface="org.freedesktop.DBus.Introspectable"/>
            <allow send_type="method_call" log="true"/>
          </policy>
        </busconfig>

  # bluesoapy

  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqproxy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCmZyb20gYmx1ZXplcm8gaW1wb3J0IHBlcmlw
        aGVyYWwKClVBUlRfU0VSSVZDRSA9ICc2RTQwMDAwMS1CNUEzLUYzOTMtRTBB
        OS1FNTBFMjREQ0NBOUUnClJYX0NIQVJBQ1RFUklTVElDID0gJzZFNDAwMDAy
        LUI1QTMtRjM5My1FMEE5LUU1MEUyNERDQ0E5RScKVFhfQ0hBUkFDVEVSSVNU
        SUMgPSAnNkU0MDAwMDMtQjVBMy1GMzkzLUUwQTktRTUwRTI0RENDQTlFJwoK
        Y2xhc3MgVWFydFNlcnZpY2U6CiAgICBkZWYgX19pbml0X18oc2VsZiwgb25y
        ZWFkLCBhbGlhcz0nUlBpX1VBUlQnKToKICAgICAgICBzZWxmLm9ucmVhZCA9
        IG9ucmVhZAogICAgICAgIHNlbGYuYXBwID0gcGVyaXBoZXJhbC5BcHBsaWNh
        dGlvbigpCiAgICAgICAgc2VsZi5ibGVfdWFydCA9IHBlcmlwaGVyYWwuU2Vy
        dmljZShVQVJUX1NFUklWQ0UsIFRydWUpCiAgICAgICAgc2VsZi5yeF91YXJ0
        ID0gcGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhSWF9DSEFSQUNURVJJU1RJ
        QywKICAgICAgICAgICAgWyd3cml0ZScsICd3cml0ZS13aXRob3V0LXJlc3Bv
        bnNlJ10sIHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi50eF91YXJ0ID0g
        cGVyaXBoZXJhbC5DaGFyYWN0ZXJpc3RpYyhUWF9DSEFSQUNURVJJU1RJQywK
        ICAgICAgICAgICAgWydub3RpZnknXSwgc2VsZi5ibGVfdWFydCkKICAgICAg
        ICBzZWxmLnJ4X3VhcnQuYWRkX3dyaXRlX2V2ZW50KHNlbGYudWFydF9wcmlu
        dCkKICAgICAgICBzZWxmLmJsZV91YXJ0LmFkZF9jaGFyYWN0ZXJpc3RpYyhz
        ZWxmLnJ4X3VhcnQpCiAgICAgICAgc2VsZi5ibGVfdWFydC5hZGRfY2hhcmFj
        dGVyaXN0aWMoc2VsZi50eF91YXJ0KQogICAgICAgIHNlbGYuYXBwLmFkZF9z
        ZXJ2aWNlKHNlbGYuYmxlX3VhcnQpCiAgICAgICAgc2VsZi5hcHAuZG9uZ2xl
        LmFsaWFzID0gYWxpYXMKICAgIGRlZiB1YXJ0X3ByaW50KHNlbGYsIGRhdGEp
        OgogICAgICAgIHZhbHVlID0gJycuam9pbihjaHIobGV0dGVyKSBmb3IgbGV0
        dGVyIGluIGRhdGEpCiAgICAgICAgc2VsZi5vbnJlYWQodmFsdWUpCiAgICBk
        ZWYgc3RhcnQoc2VsZik6CiAgICAgICAgc2VsZi5hcHAuc3RhcnQoKQoKIyMj
        IyMjIyMjIyMjIyMjIyMjIyMjIwoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBw
        YWhvLm1xdHQuY2xpZW50IGFzIG1xdHQKZnJvbSBkYXRldGltZSBpbXBvcnQg
        ZGF0ZXRpbWUKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKAog
        ICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVmYXVsdHNI
        ZWxwRm9ybWF0dGVyKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWJyb2tlciIs
        IGRlZmF1bHQ9IjEyNy4wLjAuMSIsIGhlbHA9J2Jyb2tlciBob3N0JykKcGFy
        c2VyLmFkZF9hcmd1bWVudCgiLS1wb3J0IiwgZGVmYXVsdD0xODgzLCBoZWxw
        PSdicm9rZXIgcG9ydCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0ta2VlcGFs
        aXZlIiwgZGVmYXVsdD02MCwgaGVscD0nYnJva2VyIGtlZXAgYWxpdmUnKQpw
        YXJzZXIuYWRkX2FyZ3VtZW50KCItLXRvcGljIiwgZGVmYXVsdD0iZi90eCIs
        IGhlbHA9J2NvbW1hbmQgdG9waWMnKQoKZGVmIG1haW4oKToKICAgIGRlZiBv
        bmNvbm5lY3QoY2xpZW50LCB1c2VyZGF0YSwgZmxhZ3MsIHJjKToKICAgICAg
        ICBjbGllbnQuc3Vic2NyaWJlKCcjJykKICAgIGRlZiBvbndyaXRlKHZhbHVl
        KToKICAgICAgICBjbGllbnQucHVibGlzaChhcmdzLnRvcGljLCB2YWx1ZSkK
        ICAgIGRlZiBvbm1lc3NhZ2UoY2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAg
        ICAgICBwYXlsb2FkID0gbXNnLnBheWxvYWQuZGVjb2RlKCdsYXRpbicpCiAg
        ICAgICAgdHMgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMn
        KQogICAgICAgIHVhcnQudHhfdWFydC5zZW5kX25vdGlmeV9ldmVudChmJ3t0
        c30ge21zZy50b3BpY30ge3BheWxvYWR9JykKICAgIHVhcnQgPSBVYXJ0U2Vy
        dmljZShvbndyaXRlKQogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAg
        Y2xpZW50Lm9uX2Nvbm5lY3QgPSBvbmNvbm5lY3QKICAgIGNsaWVudC5vbl9t
        ZXNzYWdlID0gb25tZXNzYWdlCiAgICBjbGllbnQuY29ubmVjdChhcmdzLmJy
        b2tlciwgYXJncy5wb3J0LCBhcmdzLmtlZXBhbGl2ZSkKICAgIGNsaWVudC5s
        b29wX3N0YXJ0KCkKICAgIHVhcnQuc3RhcnQoKQoKaWYgX19uYW1lX18gPT0g
        J19fbWFpbl9fJzoKICAgICMgcHJveHkgYmxlIHVhcnQgdG8gbXF0dCBicm9r
        ZXIKICAgICMgdGhpcyBuZWVkcyB0byBydW4gYXMgcm9vdAogICAgYXJncyA9
        IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqsoapy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgb3MsIHN5cywgdGltZQppbXBv
        cnQgc3RydWN0CmltcG9ydCBhcmdwYXJzZQppbXBvcnQgbnVtcHkgYXMgbnAK
        aW1wb3J0IHBhaG8ubXF0dC5jbGllbnQgYXMgbXF0dAppbXBvcnQgU29hcHlT
        RFIKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBTb2FweVNE
        UiBpbXBvcnQgU09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMgoKcmVzdGFy
        dF9zZWNvbmRzID0gMTAKCnBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFy
        c2VyKAogICAgZm9ybWF0dGVyX2NsYXNzPWFyZ3BhcnNlLkFyZ3VtZW50RGVm
        YXVsdHNIZWxwRm9ybWF0dGVyKQoKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1i
        cm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxwPSdicm9rZXIgaG9z
        dCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIGRlZmF1bHQ9MTg4
        MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhlbHA9J2Jyb2tlciBrZWVwYWxp
        dmUgaW4gc2Vjb25kcycpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tdG9waWMi
        LCBkZWZhdWx0PSJmL3R4IiwgaGVscD0nbXF0dCB0b3BpYyBmb3IgY29tbWFu
        ZCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcHBzLXRvcGljIiwgZGVmYXVs
        dD0icHBzIiwgaGVscD0nbXF0dCB0b3BpYyBmb3IgZ3BzIHRpbWUnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWRyaXZlciIsIGhlbHA9J25hbWUgb2YgZHJp
        dmVyJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wYWNrZXQtc2l6ZSIsIGRl
        ZmF1bHQ9MTAyNCwgaGVscD0ncGFja2V0IHNpemUnKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLWZyZXEiLCB0eXBlPW5wLmZsb2F0LCBoZWxwPSJjZW50ZXIg
        ZnJlcXVlbmN5IGluIGhlcnR6IikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1y
        YXRlIiwgdHlwZT1ucC5mbG9hdCwgaGVscD0ic2FtcGxlIHJhdGUgaW4gaGVy
        dHoiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWdhaW4iLCB0eXBlPW5wLmZs
        b2F0LCBoZWxwPSJmcm9udCBlbmQgZ2FpbiBpbiBkQiIpCnBhcnNlci5hZGRf
        YXJndW1lbnQoIi0tYWdjIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0i
        ZW5hYmxlIEFHQyIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tbm9icm9rZXIi
        LCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJkaXNhYmxlIG1xdHQgYnJv
        a2VyIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kdW1iIiwgYWN0aW9uPSJz
        dG9yZV90cnVlIiwgaGVscD0iZHVtYiB0ZXJtaW5hbCIpCnBhcnNlci5hZGRf
        YXJndW1lbnQoIi0tb3V0cHV0IiwgZGVmYXVsdD0ib3V0IiwgaGVscD0id3Jp
        dGUgQ0YzMiBzYW1wbGVzIHRvIGZpbGUiKQpwYXJzZXIuYWRkX2FyZ3VtZW50
        KCItLW5vd2F2ZSIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2Fi
        bGUgV0FWIGhlYWRlciIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tbWV0ZXIi
        LCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxwPSJlbmFibGUgcGVhayBtZXRl
        ciIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcGF1c2UiLCBhY3Rpb249InN0
        b3JlX3RydWUiLCBoZWxwPSJwYXVzZSBvdXRwdXQiKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLXJlZnJlc2giLCBkZWZhdWx0PTUsIGhlbHA9InBlYWsgbWV0
        ZXIgcmVmcmVzaCBpbiBzZWNvbmRzIikKCiMgYXJnU3RyaW5nCnBhcnNlci5h
        ZGRfYXJndW1lbnQoIi0tZGlyZWN0LXNhbXAiLCBoZWxwPSIwPW9mZiwgMT1J
        LCAyPVEgY2hhbm5lbCIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0taXEtc3dh
        cCIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9InN3YXAgSVEgc2lnbmFs
        cyIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tYmlhc3RlZSIsIGFjdGlvbj0i
        c3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBiaWFzIHRlZSIpCnBhcnNlci5h
        ZGRfYXJndW1lbnQoIi0tZGlnaXRhbC1hZ2MiLCBhY3Rpb249InN0b3JlX3Ry
        dWUiLCBoZWxwPSJlbmFibGUgZGlnaXRhbCBBR0MiKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLW9mZnNldC10dW5lIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwg
        aGVscD0iZW5hYmxlIG9mZnNldCB0dW5lIikKCgpkZWYgZ2VuX3RvcGljKG5h
        bWU9Tm9uZSk6CiAgICBkID0gYXJncy50b3BpYy5zcGxpdCgnLycpWzotMV0K
        ICAgIGlmIG5hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgZC5hcHBlbmQobmFt
        ZSkKICAgIHJldHVybiAnLycuam9pbihkKQoKCmRlZiB0b19mbG9hdChwYXJh
        bSk6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGZsb2F0KHBhcmFtKQogICAg
        ZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcGFzcwoKCmRlZiBvbl9mYXRh
        bChwYXJhbSk6CiAgICBnbG9iYWwgZmF0YWwKICAgIGlmIHBhcmFtLmxvd2Vy
        KCkgPT0gInRydWUiOgogICAgICAgIGZhdGFsID0gVHJ1ZQogICAgICAgIGlu
        Zm8oJ2ZhdGFsIGtpbGxpbmcnKQogICAgZWxzZToKICAgICAgICBpbmZvKCdi
        YWQgZmF0YWwgY29tbWFuZCcpCgoKZGVmIG9uX2tpbGwocGFyYW0pOgogICAg
        Z2xvYmFsIGtpbGxlZAogICAgaWYgcGFyYW0ubG93ZXIoKSA9PSAidHJ1ZSI6
        CiAgICAgICAga2lsbGVkID0gVHJ1ZQogICAgICAgIGluZm8oJ2tpbGxpbmcg
        c3RyZWFtJykKICAgIGVsc2U6CiAgICAgICAgaW5mbygnYmFkIGtpbGwgY29t
        bWFuZCcpCgoKZGVmIG9uX3BhdXNlKHBhcmFtKToKICAgIGdsb2JhbCBwYXVz
        ZWQKICAgIGlmIHBhcmFtOgogICAgICAgIHBhdXNlZCA9IHBhcmFtLmxvd2Vy
        KCkgPT0gInRydWUiCiAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoInBh
        dXNlIiksICdvbicgaWYgcGF1c2VkIGVsc2UgJ29mZicpCgoKZGVmIG9uX3Jh
        dGUocGFyYW0pOgogICAgZ2xvYmFsIHJhdGUKICAgIGlmIHBhcmFtOgogICAg
        ICAgIHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0g
        aXMgTm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIHNhbXBsZSByYXRlIGNv
        bW1hbmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhZGlvLnNldFNh
        bXBsZVJhdGUoU09BUFlfU0RSX1JYLCAwLCBwYXJhbSkKICAgIHJhdGUgPSBy
        YWRpby5nZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwgMCkKICAgIGJyb2tl
        ci5wdWJsaXNoKGdlbl90b3BpYygicmF0ZSIpLCBmJ3tyYXRlLzFlMzouM2Z9
        IEtIeicpCgoKZGVmIG9uX2ZyZXEocGFyYW0pOgogICAgaWYgcGFyYW06CiAg
        ICAgICAgcGFyYW0gPSB0b19mbG9hdChwYXJhbSkKICAgICAgICBpZiBwYXJh
        bSBpcyBOb25lOgogICAgICAgICAgICBpbmZvKCdiYWQgZnJlcXVlbmN5IGNv
        bW1hbmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhZGlvLnNldEZy
        ZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQogICAgZnJlcSA9IHJh
        ZGlvLmdldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDApCiAgICBicm9rZXIu
        cHVibGlzaChnZW5fdG9waWMoImZyZXEiKSwgZid7ZnJlcS8xZTY6LjZmfSBN
        SHonKQoKCmRlZiBvbl9nYWluKHBhcmFtKToKICAgIGlmIHBhcmFtOgogICAg
        ICAgIHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0g
        aXMgTm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIGdhaW4gY29tbWFuZCcp
        CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFkaW8uc2V0R2FpbihTT0FQ
        WV9TRFJfUlgsIDAsIHBhcmFtKQogICAgZ2FpbiA9IHJhZGlvLmdldEdhaW4o
        U09BUFlfU0RSX1JYLCAwKQogICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGlj
        KCJnYWluIiksIGYne2dhaW46LjNnfSBkQicpCgoKZGVmIG9uX2F1dG8ocGFy
        YW0pOgogICAgaWYgcGFyYW06CiAgICAgICAgcmFkaW8uc2V0R2Fpbk1vZGUo
        U09BUFlfU0RSX1JYLCAwLCBwYXJhbS5sb3dlcigpID09ICJ0cnVlIikKICAg
        IGFnYyA9IHJhZGlvLmdldEdhaW5Nb2RlKFNPQVBZX1NEUl9SWCwgMCkKICAg
        IGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygiYWdjIiksICdvbicgaWYgYWdj
        IGVsc2UgJ29mZicpCgoKZGVmIG9uX3NldHRpbmcoa2V5LCBwYXJhbSk6CiAg
        ICBpZiBwYXJhbToKICAgICAgICByYWRpby53cml0ZVNldHRpbmcoa2V5LCBw
        YXJhbSkKICAgIHZhbCA9IHJhZGlvLnJlYWRTZXR0aW5nKGtleSkKICAgIGJy
        b2tlci5wdWJsaXNoKGdlbl90b3BpYygic2V0dGluZyIpLCBzdHIodmFsKSkK
        CgpkZWYgb25fbWVzc2FnZShjbGllbnQsIHVzZXJkYXRhLCBtc2cpOgogICAg
        dHJ5OgogICAgICAgIHBheWxvYWQgPSBtc2cucGF5bG9hZC5kZWNvZGUoJ2xh
        dGluJykuc3RyaXAoKQogICAgICAgIGlmIHBheWxvYWQgYW5kIG1zZy50b3Bp
        YyA9PSBhcmdzLnBwc190b3BpYzoKICAgICAgICAgICAgaWYgdGltZWZpbGUg
        YW5kIG5vdCBwYXVzZWQ6CiAgICAgICAgICAgICAgICBzZWMgPSBzYW1wbGVz
        X3RvdGFsIC8gcmF0ZQogICAgICAgICAgICAgICAgdGltZWZpbGUud3JpdGUo
        ZiJ7c2VjOi4zZn1cdHtzZWM6LjNmfVx0e3BheWxvYWR9XG4iKQogICAgICAg
        ICAgICAgICAgdGltZWZpbGUuZmx1c2goKQogICAgICAgIGlmIHBheWxvYWQg
        YW5kIG1zZy50b3BpYyA9PSBhcmdzLnRvcGljOgogICAgICAgICAgICBjbWQs
        IF8sIHBhcmFtID0gcGF5bG9hZC5wYXJ0aXRpb24oJyAnKSAKICAgICAgICAg
        ICAgcGFyYW0gPSBwYXJhbS5zdHJpcCgpCiAgICAgICAgICAgIGlmIGNtZCA9
        PSAncCc6CiAgICAgICAgICAgICAgICBvbl9wYXVzZShwYXJhbSkKICAgICAg
        ICAgICAgZWxpZiBjbWQgPT0gJ2cnOgogICAgICAgICAgICAgICAgb25fZ2Fp
        bihwYXJhbSkKICAgICAgICAgICAgZWxpZiBjbWQgPT0gJ2EnOgogICAgICAg
        ICAgICAgICAgb25fYXV0byhwYXJhbSkKICAgICAgICAgICAgZWxpZiBjbWQg
        PT0gJ3InOgogICAgICAgICAgICAgICAgb25fcmF0ZShwYXJhbSkKICAgICAg
        ICAgICAgZWxpZiBjbWQgPT0gJ2YnOgogICAgICAgICAgICAgICAgb25fZnJl
        cShwYXJhbSkKICAgICAgICAgICAgZWxpZiBjbWQgPT0gJ2snOgogICAgICAg
        ICAgICAgICAgb25fa2lsbChwYXJhbSkKICAgICAgICAgICAgZWxpZiBjbWQg
        PT0gJ0snOgogICAgICAgICAgICAgICAgb25fZmF0YWwocGFyYW0pCiAgICAg
        ICAgICAgIGVsaWYgY21kID09ICdkcyc6CiAgICAgICAgICAgICAgICBvbl9z
        ZXR0aW5nKCJkaXJlY3Rfc2FtcCIsIHBhcmFtKQogICAgICAgICAgICBlbGlm
        IGNtZCA9PSAnaXEnOgogICAgICAgICAgICAgICAgb25fc2V0dGluZygiaXFf
        c3dhcCIsIHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnYnQnOgog
        ICAgICAgICAgICAgICAgb25fc2V0dGluZygiYmlhc3RlZSIsIHBhcmFtKQog
        ICAgICAgICAgICBlbGlmIGNtZCA9PSAnZGEnOgogICAgICAgICAgICAgICAg
        b25fc2V0dGluZygiZGlnaXRhbF9hZ2MiLCBwYXJhbSkKICAgICAgICAgICAg
        ZWxpZiBjbWQgPT0gJ290JzoKICAgICAgICAgICAgICAgIG9uX3NldHRpbmco
        Im9mZnNldF90dW5lIiwgcGFyYW0pCiAgICAgICAgICAgIGVsc2U6CiAgICAg
        ICAgICAgICAgICBpbmZvKCd1bmtub3duIGNvbW1hbmQnKQogICAgZXhjZXB0
        IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGluZm8oZiJFeGNlcHRpb24gb25f
        bWVzc2FnZSgpOiB7ZX0iKQoKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNl
        cmRhdGEsIGZsYWdzLCByYyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKGdlbl90
        b3BpYygnIycpKQogICAgY2xpZW50LnN1YnNjcmliZShhcmdzLnBwc190b3Bp
        YykKCgojIyMjIyMjIyMjIyMjIyMzCgoKZGVmIGluZm8ocGF5bG9hZCk6CiAg
        ICBwcmludChwYXlsb2FkLCBmaWxlPXN5cy5zdGRlcnIpCiAgICBpZiBicm9r
        ZXI6CiAgICAgICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJpbmZvIiks
        IHBheWxvYWQpCgoKZGVmIGxvZ19oYW5kbGVyKGxvZ19sZXZlbCwgbG9nX21l
        c3NhZ2UpOgogICAgaWYgYnJva2VyOgogICAgICAgIGJyb2tlci5wdWJsaXNo
        KGdlbl90b3BpYygibG9nIiksIGxvZ19tZXNzYWdlKQoKCmRlZiB3YXZfaGVh
        ZGVyKHJhdGUsIGNoYW5uZWxzPTIsIHNhbXBsZV9ieXRlcz00KToKICAgIHJh
        dGUgPSBpbnQocmF0ZSkKICAgIGRhdGFfaWQgPSBiJ2RhdGEnCiAgICBkYXRh
        X3NpemUgPSAweDgwMDAwMDAwCiAgICByaWZmX2lkID0gYidSSUZGJwogICAg
        cmlmZl9mb3JtYXQgPSBiJ1dBVkUnCiAgICBmbXRfaWQgPSBiJ2ZtdCAnCiAg
        ICBmbXRfc2l6ZSA9IDE2CiAgICBmbXRfZm9ybWF0ID0gMyAgICAjIElFRUVf
        RkxPQVQKICAgIGJ1ZiA9IHN0cnVjdC5wYWNrKCc8NHNJNHMnLCByaWZmX2lk
        LCBkYXRhX3NpemUgKyAyMCArIGZtdF9zaXplLCByaWZmX2Zvcm1hdCkKICAg
        IGJ1ZiArPSBzdHJ1Y3QucGFjaygnPDRzSUhIJywgZm10X2lkLCBmbXRfc2l6
        ZSwgZm10X2Zvcm1hdCwgY2hhbm5lbHMpCiAgICBidWYgKz0gc3RydWN0LnBh
        Y2soJzxJSUhIJywKICAgICAgICByYXRlLCAgICAgICAgICAgICAgICAgICAg
        ICAgICAgICMgMzItYml0CiAgICAgICAgcmF0ZSAqIGNoYW5uZWxzICogc2Ft
        cGxlX2J5dGVzLCAjIDMyLWJpdAogICAgICAgIGNoYW5uZWxzICogc2FtcGxl
        X2J5dGVzLAogICAgICAgIHNhbXBsZV9ieXRlcyAqIDgpCiAgICBidWYgKz0g
        c3RydWN0LnBhY2soJzw0c0knLCBkYXRhX2lkLCBkYXRhX3NpemUpCiAgICBy
        ZXR1cm4gYnVmCgoKZGVmIHJhZGlvX2Nvbm5lY3QoKToKICAgIGdsb2JhbCBy
        YWRpbwogICAgZHJpdmVycyA9IFsgZFsnZHJpdmVyJ10gZm9yIGQgaW4gU29h
        cHlTRFIuRGV2aWNlLmVudW1lcmF0ZSgpIF0KICAgIGluZm8oZiJGb3VuZCBk
        cml2ZXJzOiB7ZHJpdmVyc30iKQogICAga3cgPSB7fQogICAgaWYgYXJncy5k
        cml2ZXI6CiAgICAgICAga3dbJ2RyaXZlciddID0gYXJncy5kcml2ZXIKICAg
        IGluZm8oZiJQYXNzaW5nIHRoZSBmb2xsb3dpbmcgYXJndW1lbnRzOiB7a3d9
        IikKICAgIHJhZGlvID0gU29hcHlTRFIuRGV2aWNlKGt3KQoKCmRlZiByYWRp
        b19zZXR0aW5ncygpOgogICAgaW5mbyhmIkluaXRpYWxpemluZyByYWRpbyBz
        ZXR0aW5ncyIpCiAgICBpZiBhcmdzLmZyZXE6CiAgICAgICAgcmFkaW8uc2V0
        RnJlcXVlbmN5KFNPQVBZX1NEUl9SWCwgMCwgYXJncy5mcmVxKQogICAgaWYg
        YXJncy5yYXRlOgogICAgICAgIHJhZGlvLnNldFNhbXBsZVJhdGUoU09BUFlf
        U0RSX1JYLCAwLCBhcmdzLnJhdGUpCiAgICByYWRpby5zZXRHYWluTW9kZShT
        T0FQWV9TRFJfUlgsIDAsIGFyZ3MuYWdjKTsKICAgIGlmIGFyZ3MuZ2FpbjoK
        ICAgICAgICByYWRpby5zZXRHYWluKFNPQVBZX1NEUl9SWCwgMCwgYXJncy5n
        YWluKQogICAgaWYgYXJncy5kaXJlY3Rfc2FtcDoKICAgICAgICByYWRpby53
        cml0ZVNldHRpbmcoImRpcmVjdF9zYW1wIiwgYXJncy5kaXJlY3Rfc2FtcCkK
        ICAgIGlmIGFyZ3MuaXFfc3dhcDoKICAgICAgICByYWRpby53cml0ZVNldHRp
        bmcoImlxX3N3YXAiLCAidHJ1ZSIpCiAgICBpZiBhcmdzLmJpYXN0ZWU6CiAg
        ICAgICAgcmFkaW8ud3JpdGVTZXR0aW5nKCJiaWFzdGVlIiwgInRydWUiKQog
        ICAgaWYgYXJncy5kaWdpdGFsX2FnYzoKICAgICAgICByYWRpby53cml0ZVNl
        dHRpbmcoImRpZ2l0YWxfYWdjIiwgInRydWUiKQogICAgaWYgYXJncy5kaWdp
        dGFsX2FnYzoKICAgICAgICByYWRpby53cml0ZVNldHRpbmcoIm9mZnNldF90
        dW5lIiwgInRydWUiKQoKCmRlZiBtYWluX2luaXQoKToKICAgIGdsb2JhbCBw
        YXVzZWQsIGtpbGxlZCwgZmF0YWwKICAgIGtpbGxlZCA9IEZhbHNlCiAgICBm
        YXRhbCA9IEZhbHNlCiAgICBwYXVzZWQgPSBhcmdzLnBhdXNlCgoKZGVmIGJy
        b2tlcl9pbml0KCk6CiAgICBnbG9iYWwgYnJva2VyLCB0aW1lZmlsZQogICAg
        dGltZWZpbGUgPSBOb25lCiAgICBicm9rZXIgPSBOb25lCiAgICBpZiBub3Qg
        YXJncy5ub2Jyb2tlcjoKICAgICAgICBpbmZvKGYiQ29ubmVjdGluZyB0byBi
        cm9rZXI6IHthcmdzLmJyb2tlcn0iKQogICAgICAgIGJyb2tlciA9IG1xdHQu
        Q2xpZW50KCkKICAgICAgICBicm9rZXIub25fY29ubmVjdCA9IG9uX2Nvbm5l
        Y3QKICAgICAgICBicm9rZXIub25fbWVzc2FnZSA9IG9uX21lc3NhZ2UKICAg
        ICAgICBicm9rZXIuY29ubmVjdChhcmdzLmJyb2tlciwgYXJncy5wb3J0LCBh
        cmdzLmtlZXBhbGl2ZSkKICAgICAgICBicm9rZXIubG9vcF9zdGFydCgpCgoK
        ZGVmIG1haW4oKToKICAgIGJyb2tlcl9pbml0KCkKICAgIFNvYXB5U0RSLnJl
        Z2lzdGVyTG9nSGFuZGxlcihsb2dfaGFuZGxlcikKICAgIGluaXRpYWxpemVk
        PSBGYWxzZQogICAgd2hpbGUgVHJ1ZToKICAgICAgICB0cnk6CiAgICAgICAg
        ICAgIG1haW5faW5pdCgpCiAgICAgICAgICAgIHJhZGlvX2Nvbm5lY3QoKQog
        ICAgICAgICAgICBpZiBub3QgaW5pdGlhbGl6ZWQ6CiAgICAgICAgICAgICAg
        ICByYWRpb19zZXR0aW5ncygpCiAgICAgICAgICAgIGluaXRpYWxpemVkID0g
        VHJ1ZQogICAgICAgICAgICByYWRpb19zdGFydCgpCiAgICAgICAgZXhjZXB0
        IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpbmZvKGYiRXhjZXB0aW9u
        IG1haW4oKToge2V9IikKICAgICAgICAgICAgdGltZS5zbGVlcChyZXN0YXJ0
        X3NlY29uZHMpCgoKZGVmIGNsb3NlX2ZpbGUoZiwgbmFtZSk6CiAgICBpZiBm
        OgogICAgICAgIGluZm8oZiJDbG9zaW5nIHtuYW1lfSBmaWxlLiIpCiAgICAg
        ICAgZi5jbG9zZSgpCgoKZGVmIG9wZW5fZmlsZXMoKToKICAgIGR0ID0gZGF0
        ZXRpbWUudXRjbm93KCkKICAgIHRzID0gZHQuc3RyZnRpbWUoJyV5JW0lZF8l
        SCVNJVMnKQogICAgZnJlcSA9IHJhZGlvLmdldEZyZXF1ZW5jeShTT0FQWV9T
        RFJfUlgsIDApCiAgICBiYXNlbmFtZSA9IGYie2FyZ3Mub3V0cHV0fV97dHN9
        Wl97ZnJlcS8xZTY6LjZmfU1IeiIKICAgIGV4dCA9ICd0eHQnCiAgICBmaWxl
        bmFtZSA9IGYie2Jhc2VuYW1lfS57ZXh0fSIKICAgIGluZm8oZiJPcGVuaW5n
        IHtmaWxlbmFtZX0gZm9yIGdwcyB0aW1lIikKICAgIHRpbWVmaWxlID0gb3Bl
        bihmaWxlbmFtZSwgInciKQogICAgZXh0ID0gJ3JhdycgaWYgYXJncy5ub3dh
        dmUgZWxzZSAnd2F2JwogICAgZmlsZW5hbWUgPSBmIntiYXNlbmFtZX0ue2V4
        dH0iCiAgICBpbmZvKGYiT3BlbmluZyB7ZmlsZW5hbWV9IGZvciBhdWRpbyIp
        CiAgICBhdWRpb2ZpbGUgPSBvcGVuKGZpbGVuYW1lLCAid2IiKQogICAgaWYg
        bm90IGFyZ3Mubm93YXZlOgogICAgICAgIGF1ZGlvZmlsZS53cml0ZSh3YXZf
        aGVhZGVyKHJhdGU9cmF0ZSkpCiAgICByZXR1cm4gYXVkaW9maWxlLCB0aW1l
        ZmlsZQoKCmRlZiBjbG9zZV9zdHJlYW0oc3RyZWFtKToKICAgIGluZm8oZiJD
        bG9zaW5nIHJhZGlvIHN0cmVhbS4iKQogICAgcmFkaW8uZGVhY3RpdmF0ZVN0
        cmVhbShzdHJlYW0pIAogICAgcmFkaW8uY2xvc2VTdHJlYW0oc3RyZWFtKQoK
        CmRlZiByYWRpb19wZWFrKHBlYWtfbGV2ZWwpOgogICAgZGIgPSAiezouMWZ9
        IGRCIi5mb3JtYXQoMjAgKiBucC5sb2cxMChwZWFrX2xldmVsICsgMWUtOTkp
        KQogICAgaWYgYXJncy5tZXRlcjoKICAgICAgICBidWYgPSBmIntkYn1cbiIg
        aWYgYXJncy5kdW1iIGVsc2UgZiJcMzNbMkt7ZGI6PjlzfVxyIgogICAgICAg
        IHByaW50KGJ1ZiwgZW5kPSIiLCBmaWxlPXN5cy5zdGRlcnIpCiAgICBpZiBi
        cm9rZXI6CiAgICAgICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJwZWFr
        IiksIGRiKQoKCmRlZiByYWRpb19zdGFydCgpOgogICAgZ2xvYmFsIHJhdGUs
        IHRpbWVmaWxlLCBzYW1wbGVzX3RvdGFsCiAgICByYXRlID0gcmFkaW8uZ2V0
        U2FtcGxlUmF0ZShTT0FQWV9TRFJfUlgsIDApCiAgICBzaXplID0gYXJncy5w
        YWNrZXRfc2l6ZQogICAgZGF0YSA9IG5wLmFycmF5KFswXSAqIHNpemUgKiAy
        LCBucC5mbG9hdDMyKQogICAgc3RyZWFtID0gcmFkaW8uc2V0dXBTdHJlYW0o
        U09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMikKICAgIHJhZGlvLmFjdGl2
        YXRlU3RyZWFtKHN0cmVhbSkgCiAgICBzYW1wbGVzX3RvdGFsID0gMAogICAg
        cGVha19sZXZlbCA9IDAKICAgIHNhbXBsZV9udW0gPSAwCiAgICBvdXRmaWxl
        ID0gTm9uZQogICAgdHJ5OgogICAgICAgIHdoaWxlIG5vdCBraWxsZWQgYW5k
        IG5vdCBmYXRhbDoKICAgICAgICAgICAgcmFkaW8ucmVhZFN0cmVhbShzdHJl
        YW0sIFtkYXRhXSwgc2l6ZSkKICAgICAgICAgICAgaWYgbm90IHBhdXNlZDoK
        ICAgICAgICAgICAgICAgIGlmIG5vdCBvdXRmaWxlOgogICAgICAgICAgICAg
        ICAgICAgIG91dGZpbGUsIHRpbWVmaWxlID0gb3Blbl9maWxlcygpCiAgICAg
        ICAgICAgICAgICBzYW1wbGVzX3RvdGFsICs9IHNpemUKICAgICAgICAgICAg
        ICAgIG91dGZpbGUud3JpdGUoZGF0YSkKICAgICAgICAgICAgcGVha19sZXZl
        bCA9IG1heChwZWFrX2xldmVsLCBhYnMoZGF0YS5taW4oKSksIGFicyhkYXRh
        Lm1heCgpKSkKICAgICAgICAgICAgc2FtcGxlX251bSArPSBzaXplCiAgICAg
        ICAgICAgIGlmIHNhbXBsZV9udW0gPiByYXRlICogYXJncy5yZWZyZXNoOgog
        ICAgICAgICAgICAgICAgcmFkaW9fcGVhayhwZWFrX2xldmVsKQogICAgICAg
        ICAgICAgICAgcGVha19sZXZlbCA9IDAKICAgICAgICAgICAgICAgIHNhbXBs
        ZV9udW0gPSAwCiAgICBleGNlcHQgKEtleWJvYXJkSW50ZXJydXB0LCBTeXN0
        ZW1FcnJvcikgYXMgZToKICAgICAgICBpbmZvKGYiRXhjZXB0aW9uIHJhZGlv
        X3N0YXJ0KCk6IHtlfSIpCiAgICBjbG9zZV9maWxlKG91dGZpbGUsICJhdWRp
        byIpCiAgICB0aW1lZmlsZSA9IGNsb3NlX2ZpbGUodGltZWZpbGUsICJ0aW1l
        IikKICAgIGNsb3NlX3N0cmVhbShzdHJlYW0pCiAgICBpZiBmYXRhbDoKICAg
        ICAgICBpbmZvKCJGYXRhbCBjb21tYW5kIGdpdmVuLCBraWxsaW5nIHByb2Nl
        c3MiKQogICAgICAgIHN5cy5leGl0KDEpCgoKaWYgX19uYW1lX18gPT0gJ19f
        bWFpbl9fJzoKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCiAgICBt
        YWluKCkKCg==


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqpps
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgYXJncGFyc2UKaW1wb3J0IHBh
        aG8ubXF0dC5jbGllbnQgYXMgbXF0dApmcm9tIGRhdGV0aW1lIGltcG9ydCBk
        YXRldGltZQpmcm9tIGdwcyBpbXBvcnQgZ3BzLCBXQVRDSF9FTkFCTEUsIFdB
        VENIX05FV1NUWUxFCgpwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNl
        cigKICAgIGZvcm1hdHRlcl9jbGFzcz1hcmdwYXJzZS5Bcmd1bWVudERlZmF1
        bHRzSGVscEZvcm1hdHRlcikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1icm9r
        ZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEiLCBoZWxwPSdicm9rZXIgaG9zdCcp
        CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIGRlZmF1bHQ9MTg4Mywg
        aGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWtl
        ZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhlbHA9J2Jyb2tlciBrZWVwIGFsaXZl
        JykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcHMtdG9waWMiLCBkZWZhdWx0
        PSJwcHMiLCBoZWxwPSdQUFMgdG9waWMnKQpwYXJzZXIuYWRkX2FyZ3VtZW50
        KCItLWludGVydmFsIiwgZGVmYXVsdD0xMCwgaGVscD0ncHVibGlzaCBpbnRl
        cnZhbCBpbiBzZWNvbmRzJykKCmRlZiBnZW5fdG9waWMobmFtZT1Ob25lKToK
        ICAgIGQgPSBhcmdzLnRvcGljLnNwbGl0KCcvJylbOi0xXQogICAgaWYgbmFt
        ZSBpcyBub3QgTm9uZToKICAgICAgICBkLmFwcGVuZChuYW1lKQogICAgcmV0
        dXJuICcvJy5qb2luKGQpCgpkZWYgb25fY29ubmVjdChjbGllbnQsIHVzZXJk
        YXRhLCBmbGFncywgcmMpOgogICAgY2xpZW50LnN1YnNjcmliZShnZW5fdG9w
        aWMoJyMnKSkKCmRlZiBvbl9tZXNzYWdlKGNsaWVudCwgdXNlcmRhdGEsIG1z
        Zyk6CiAgICBwYXlsb2FkID0gbXNnLnBheWxvYWQuZGVjb2RlKCdsYXRpbicp
        LnN0cmlwKCkKICAgIGlmIG1zZy50b3BpYyA9PSBhcmdzLnBwc190b3BpYzoK
        ICAgICAgICBwcmludChmJ3ttc2cudG9waWN9IHtwYXlsb2FkfScpCgpkZWYg
        bWFpbigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50
        Lm9uX2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2Fn
        ZSA9IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2Vy
        LCBhcmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bf
        c3RhcnQoKQogICAgbW9kZSA9IFdBVENIX0VOQUJMRSB8IFdBVENIX05FV1NU
        WUxFCiAgICBzZXNzaW9uID0gZ3BzKG1vZGU9bW9kZSkKICAgIGZvciBueCBp
        biBzZXNzaW9uOgogICAgICAgIGlmIG54WydjbGFzcyddID09ICdUUFYnOgog
        ICAgICAgICAgICBtb2RlID0gbnhbJ21vZGUnXQogICAgICAgICAgICB0cyA9
        IG54LmdldCgndGltZScpCiAgICAgICAgICAgIGlmIHRzIGFuZCAobW9kZSA9
        PSAyIG9yIG1vZGUgPT0gMyk6CiAgICAgICAgICAgICAgICBkdCA9IGRhdGV0
        aW1lLnN0cnB0aW1lKHRzLCAiJVktJW0tJWRUJUg6JU06JVMuJWZaIikKICAg
        ICAgICAgICAgICAgIGlmIGR0LnNlY29uZCAlIGFyZ3MuaW50ZXJ2YWwgPT0g
        MDoKICAgICAgICAgICAgICAgICAgICBjbGllbnQucHVibGlzaChhcmdzLnBw
        c190b3BpYywgdHMpIAoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAg
        IGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCiAgICBtYWluKCkKCgo=


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqclient
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgc3lzCmltcG9ydCBhcmdwYXJz
        ZQppbXBvcnQgcGFoby5tcXR0LmNsaWVudCBhcyBtcXR0CgpwYXJzZXIgPSBh
        cmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1h
        cmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEi
        LCBoZWxwPSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0t
        cG9ydCIsIGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhl
        bHA9J2Jyb2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdjb21tYW5kIHRvcGlj
        JykKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCBy
        Yyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKCIjIikKCmRlZiBvbl9tZXNzYWdl
        KGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAgICBwcmludChtc2cudG9waWMg
        KyAiICIgKyBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykpCgpkZWYgbWFp
        bigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50Lm9u
        X2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2FnZSA9
        IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2VyLCBh
        cmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bfc3Rh
        cnQoKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICBsaW5lID0gbmV4dChzeXMu
        c3RkaW4pLnJzdHJpcCgpCiAgICAgICAgY2xpZW50LnB1Ymxpc2goYXJncy50
        b3BpYywgbGluZSkgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAg
        YXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==



  - become: yes
    copy:
      dest: /lib/systemd/system/mqproxy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqproxy
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqsoapy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqsoapy --pause --output {{ fs_path }}/out
        # WorkingDirectory={{ fs_path }}
        User=george
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    copy:
      dest: /lib/systemd/system/mqpps.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqpps
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    shell: |
      sudo systemctl enable mqproxy
      sudo systemctl enable mqsoapy
      sudo systemctl enable mqpps

  - become: yes
    shell: |
      sudo systemctl restart mqproxy
      sudo systemctl restart mqsoapy
      sudo systemctl restart mqpps

