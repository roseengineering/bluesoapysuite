---
  - set_fact:
      fs_path: "{{ fs_path | default('/srv') }}"

  # apt

  - become: yes
    apt:
      name:
      - mosquitto

  # pip

  - become: yes
    pip:
      name:
      - paho-mqtt

  # code

  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqsoapy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgb3MsIHN5cywgdGltZQppbXBv
        cnQgc29ja2V0LCBzZWxlY3QKaW1wb3J0IHN0cnVjdAppbXBvcnQgYXJncGFy
        c2UKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYWhvLm1xdHQuY2xpZW50
        IGFzIG1xdHQKaW1wb3J0IFNvYXB5U0RSCmZyb20gZGF0ZXRpbWUgaW1wb3J0
        IGRhdGV0aW1lCmZyb20gU29hcHlTRFIgaW1wb3J0IFNPQVBZX1NEUl9SWCwg
        U09BUFlfU0RSX0NGMzIKCnJlc3RhcnRfc2Vjb25kcyA9IDEwCgpwYXJzZXIg
        PSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFz
        cz1hcmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKCiMg
        YnJva2VyCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tYnJva2VyIiwgZGVmYXVs
        dD0iMC4wLjAuMCIsIGhlbHA9J2Jyb2tlciBob3N0JykKcGFyc2VyLmFkZF9h
        cmd1bWVudCgiLS1icm9rZXItcG9ydCIsIGRlZmF1bHQ9MTg4MywgdHlwZT1p
        bnQsIGhlbHA9J2Jyb2tlciBwb3J0JykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS1icm9rZXIta2VlcGFsaXZlIiwgZGVmYXVsdD02MCwgdHlwZT1pbnQsIGhl
        bHA9J2Jyb2tlciBrZWVwYWxpdmUgc2Vjb25kcycpCnBhcnNlci5hZGRfYXJn
        dW1lbnQoIi0tdG9waWMiLCBkZWZhdWx0PSJmL3R4IiwgaGVscD0nbXF0dCB0
        b3BpYyBmb3IgY29tbWFuZCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcHBz
        LXRvcGljIiwgZGVmYXVsdD0icHBzIiwgaGVscD0nbXF0dCB0b3BpYyBmb3Ig
        Z3BzIHBwcyB0aW1lJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1ub2Jyb2tl
        ciIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2FibGUgbXF0dCBi
        cm9rZXIiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXJlZnJlc2gtcHBzIiwg
        ZGVmYXVsdD0xMCwgdHlwZT1pbnQsIGhlbHA9J3BwcyByZWZyZXNoIGluIHNl
        Y29uZHMnKQoKIyBzb2FweQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWRyaXZl
        ciIsIGhlbHA9J25hbWUgb2YgZHJpdmVyJykKcGFyc2VyLmFkZF9hcmd1bWVu
        dCgiLS1wYWNrZXQtc2l6ZSIsIGRlZmF1bHQ9MTAyNCwgdHlwZT1pbnQsIGhl
        bHA9J3BhY2tldCBzaXplJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1mcmVx
        IiwgdHlwZT1ucC5mbG9hdCwgaGVscD0iY2VudGVyIGZyZXF1ZW5jeSBpbiBo
        ZXJ0eiIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcmF0ZSIsIHR5cGU9bnAu
        ZmxvYXQsIGhlbHA9InNhbXBsZSByYXRlIGluIGhlcnR6IikKcGFyc2VyLmFk
        ZF9hcmd1bWVudCgiLS1nYWluIiwgdHlwZT1ucC5mbG9hdCwgaGVscD0iZnJv
        bnQgZW5kIGdhaW4gaW4gZEIiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWFn
        YyIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBBR0MiKQoK
        IyBzb2FweSBhcmdTdHJpbmcKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kaXJl
        Y3Qtc2FtcCIsIGhlbHA9IjA9b2ZmLCAxIG9yIGk9SSwgMiBvciBxPVEgY2hh
        bm5lbCIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0taXEtc3dhcCIsIGFjdGlv
        bj0ic3RvcmVfdHJ1ZSIsIGhlbHA9InN3YXAgSVEgc2lnbmFscyIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tYmlhc3RlZSIsIGFjdGlvbj0ic3RvcmVfdHJ1
        ZSIsIGhlbHA9ImVuYWJsZSBiaWFzIHRlZSIpCnBhcnNlci5hZGRfYXJndW1l
        bnQoIi0tZGlnaXRhbC1hZ2MiLCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxw
        PSJlbmFibGUgZGlnaXRhbCBBR0MiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LW9mZnNldC10dW5lIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZW5h
        YmxlIG9mZnNldCB0dW5lIikKCiMgb3RoZXIKcGFyc2VyLmFkZF9hcmd1bWVu
        dCgiLS1vdXRwdXQiLCBkZWZhdWx0PSJvdXQiLCBoZWxwPSJ3cml0ZSBDRjMy
        IHNhbXBsZXMgdG8gZmlsZSIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tbm93
        YXZlIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZGlzYWJsZSBXQVYg
        aGVhZGVyIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wYXVzZSIsIGFjdGlv
        bj0ic3RvcmVfdHJ1ZSIsIGhlbHA9InBhdXNlIG91dHB1dCIpCgojIHBlYWsg
        bWV0ZXIKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1yZWZyZXNoIiwgZGVmYXVs
        dD01LCB0eXBlPWludCwgaGVscD0icGVhayBtZXRlciByZWZyZXNoIGluIHNl
        Y29uZHMiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW1ldGVyIiwgYWN0aW9u
        PSJzdG9yZV90cnVlIiwgaGVscD0iZW5hYmxlIGNvbnNvbGUgcGVhayBtZXRl
        ciIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tZHVtYiIsIGFjdGlvbj0ic3Rv
        cmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBkdW1iIHRlcm1pbmFsIGNvbnNvbGUi
        KQogCiMgdGNwIHNlcnZlcgpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWhvc3Qi
        LCBkZWZhdWx0PSIwLjAuMC4wIiwgaGVscD0iQ0YzMiB0Y3Agc2VydmVyIGhv
        c3QgYWRkcmVzcyIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIHR5
        cGU9aW50LCBkZWZhdWx0PTEyMzQsIGhlbHA9IkNGMzIgdGNwIHNlcnZlciBw
        b3J0IGFkZHJlc3MiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXJ0bHRjcCIs
        IGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBDVTggcnRsdGNw
        IHNlcnZlciBtb2RlIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1ub3NlcnZl
        ciIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2FibGUgdGNwIHNl
        cnZlciIpCgoKCmRlZiBnZW5fdG9waWMobmFtZT1Ob25lKToKICAgIGQgPSBh
        cmdzLnRvcGljLnNwbGl0KCcvJylbOi0xXQogICAgaWYgbmFtZSBpcyBub3Qg
        Tm9uZToKICAgICAgICBkLmFwcGVuZChuYW1lKQogICAgcmV0dXJuICcvJy5q
        b2luKGQpCgoKZGVmIHRvX2Zsb2F0KHBhcmFtKToKICAgIHRyeToKICAgICAg
        ICByZXR1cm4gZmxvYXQocGFyYW0pCiAgICBleGNlcHQgVmFsdWVFcnJvcjoK
        ICAgICAgICBwYXNzCgoKIyMjIyMjIyMjIyMjCgpkZWYgb25faW5mbyhwYXJh
        bSk6CiAgICBjaGFuID0gMAogICAgZm9yIHIgaW4gcmFkaW8uZ2V0U2FtcGxl
        UmF0ZVJhbmdlKFNPQVBZX1NEUl9SWCwgY2hhbik6CiAgICAgICBwYXlsb2Fk
        ID0gJ3JhdGU6IHs6LjNmfSBLSHonLmZvcm1hdChyLm1pbmltdW0oKSAvIDFl
        MykKICAgICAgIGluZm8ocGF5bG9hZCkKICAgIGZvciByIGluIHJhZGlvLmdl
        dEZyZXF1ZW5jeVJhbmdlKFNPQVBZX1NEUl9SWCwgY2hhbik6CiAgICAgICBw
        YXlsb2FkID0gJ2ZyZXE6IHs6LjZmfSAtIHs6LjZmfSBNSHonLmZvcm1hdCgK
        ICAgICAgICAgICByLm1pbmltdW0oKSAvIDFlNiwgci5tYXhpbXVtKCkgLyAx
        ZTYpCiAgICAgICBpbmZvKHBheWxvYWQpCiAgICByID0gcmFkaW8uZ2V0R2Fp
        blJhbmdlKFNPQVBZX1NEUl9SWCwgY2hhbikKICAgIHBheWxvYWQgPSAnZ2Fp
        bjogezouMmZ9IC0gezouMmZ9IGRCJy5mb3JtYXQoci5taW5pbXVtKCksIHIu
        bWF4aW11bSgpKQogICAgaW5mbyhwYXlsb2FkKQoKCmRlZiBvbl9mYXRhbChw
        YXJhbSk6CiAgICBnbG9iYWwgZmF0YWwKICAgIGlmIHBhcmFtLmxvd2VyKCkg
        PT0gInRydWUiOgogICAgICAgIGZhdGFsID0gVHJ1ZQogICAgICAgIGluZm8o
        J2ZhdGFsIGtpbGxpbmcnKQogICAgZWxzZToKICAgICAgICBpbmZvKCdiYWQg
        ZmF0YWwgY29tbWFuZCcpCgoKZGVmIG9uX2tpbGwocGFyYW0pOgogICAgZ2xv
        YmFsIGtpbGxlZAogICAgaWYgcGFyYW0ubG93ZXIoKSA9PSAidHJ1ZSI6CiAg
        ICAgICAga2lsbGVkID0gVHJ1ZQogICAgICAgIGluZm8oJ2tpbGxpbmcgc3Ry
        ZWFtJykKICAgIGVsc2U6CiAgICAgICAgaW5mbygnYmFkIGtpbGwgY29tbWFu
        ZCcpCgoKZGVmIG9uX3BhdXNlKHBhcmFtKToKICAgIGdsb2JhbCBwYXVzZWQK
        ICAgIGlmIHBhcmFtOgogICAgICAgIHBhdXNlZCA9IHBhcmFtLmxvd2VyKCkg
        PT0gInRydWUiCiAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoInBhdXNl
        IiksICdvbicgaWYgcGF1c2VkIGVsc2UgJ29mZicpCgoKZGVmIG9uX3JhdGUo
        cGFyYW0pOgogICAgZ2xvYmFsIHJhdGUKICAgIGlmIHBhcmFtOgogICAgICAg
        IHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0gaXMg
        Tm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIHNhbXBsZSByYXRlIGNvbW1h
        bmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhZGlvLnNldFNhbXBs
        ZVJhdGUoU09BUFlfU0RSX1JYLCAwLCBwYXJhbSkKICAgIHJhdGUgPSByYWRp
        by5nZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwgMCkKICAgIGJyb2tlci5w
        dWJsaXNoKGdlbl90b3BpYygicmF0ZSIpLCBmJ3tyYXRlLzFlMzouM2Z9IEtI
        eicpCgoKZGVmIG9uX2ZyZXEocGFyYW0pOgogICAgaWYgcGFyYW06CiAgICAg
        ICAgcGFyYW0gPSB0b19mbG9hdChwYXJhbSkKICAgICAgICBpZiBwYXJhbSBp
        cyBOb25lOgogICAgICAgICAgICBpbmZvKCdiYWQgZnJlcXVlbmN5IGNvbW1h
        bmQnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhZGlvLnNldEZyZXF1
        ZW5jeShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQogICAgZnJlcSA9IHJhZGlv
        LmdldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDApCiAgICBicm9rZXIucHVi
        bGlzaChnZW5fdG9waWMoImZyZXEiKSwgZid7ZnJlcS8xZTY6LjZmfSBNSHon
        KQoKCmRlZiBvbl9nYWluKHBhcmFtKToKICAgIGlmIHBhcmFtOgogICAgICAg
        IHBhcmFtID0gdG9fZmxvYXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0gaXMg
        Tm9uZToKICAgICAgICAgICAgaW5mbygnYmFkIGdhaW4gY29tbWFuZCcpCiAg
        ICAgICAgZWxzZToKICAgICAgICAgICAgcmFkaW8uc2V0R2FpbihTT0FQWV9T
        RFJfUlgsIDAsIHBhcmFtKQogICAgZ2FpbiA9IHJhZGlvLmdldEdhaW4oU09B
        UFlfU0RSX1JYLCAwKQogICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJn
        YWluIiksIGYne2dhaW46LjNnfSBkQicpCgoKZGVmIG9uX2F1dG8ocGFyYW0p
        OgogICAgaWYgcGFyYW06CiAgICAgICAgcmFkaW8uc2V0R2Fpbk1vZGUoU09B
        UFlfU0RSX1JYLCAwLCBwYXJhbS5sb3dlcigpID09ICJ0cnVlIikKICAgIGFn
        YyA9IHJhZGlvLmdldEdhaW5Nb2RlKFNPQVBZX1NEUl9SWCwgMCkKICAgIGJy
        b2tlci5wdWJsaXNoKGdlbl90b3BpYygiYWdjIiksICdvbicgaWYgYWdjIGVs
        c2UgJ29mZicpCgoKZGVmIG9uX3NldHRpbmcoa2V5LCBwYXJhbSk6CiAgICBp
        ZiBwYXJhbToKICAgICAgICByYWRpby53cml0ZVNldHRpbmcoa2V5LCBwYXJh
        bSkKICAgIHZhbCA9IHJhZGlvLnJlYWRTZXR0aW5nKGtleSkKICAgIGJyb2tl
        ci5wdWJsaXNoKGdlbl90b3BpYyhrZXkpLCBzdHIodmFsKSkKCgpkZWYgb25f
        cHBzKHRzKToKICAgIGlmIHRpbWVmaWxlIGFuZCBub3QgcGF1c2VkOgogICAg
        ICAgIHNlYyA9IHNhbXBsZXNfdG90YWwgLyByYXRlCiAgICAgICAgZHQgPSBk
        YXRldGltZS5zdHJwdGltZSh0cywgIiVZLSVtLSVkVCVIOiVNOiVTLiVmWiIp
        CiAgICAgICAgaWYgZHQuc2Vjb25kICUgYXJncy5yZWZlc2hfcHBzID09IDA6
        CiAgICAgICAgICAgIGluZm8odHMpCiAgICAgICAgdGltZWZpbGUud3JpdGUo
        ZiJ7c2VjOi4zZn1cdHtzZWM6LjNmfVx0e3RzfVxuIikKICAgICAgICB0aW1l
        ZmlsZS5mbHVzaCgpCgoKZGVmIG9uX21lc3NhZ2UoY2xpZW50LCB1c2VyZGF0
        YSwgbXNnKToKICAgIHBheWxvYWQgPSBtc2cucGF5bG9hZC5kZWNvZGUoJ2xh
        dGluJykuc3RyaXAoKQogICAgdHJ5OgogICAgICAgIGlmIHBheWxvYWQgYW5k
        IG1zZy50b3BpYyA9PSBhcmdzLnBwc190b3BpYzoKICAgICAgICAgICAgb25f
        cHBzKHBheWxvYWQpCiAgICAgICAgaWYgcGF5bG9hZCBhbmQgbXNnLnRvcGlj
        ID09IGFyZ3MudG9waWM6CiAgICAgICAgICAgIGNtZCwgXywgcGFyYW0gPSBw
        YXlsb2FkLnBhcnRpdGlvbignICcpIAogICAgICAgICAgICBwYXJhbSA9IHBh
        cmFtLnN0cmlwKCkKICAgICAgICAgICAgaWYgY21kID09ICdpJzoKICAgICAg
        ICAgICAgICAgIG9uX2luZm8ocGFyYW0pCiAgICAgICAgICAgIGVsaWYgY21k
        ID09ICdwJzoKICAgICAgICAgICAgICAgIG9uX3BhdXNlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZyc6CiAgICAgICAgICAgICAgICBvbl9n
        YWluKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnYSc6CiAgICAg
        ICAgICAgICAgICBvbl9hdXRvKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAncic6CiAgICAgICAgICAgICAgICBvbl9yYXRlKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnZic6CiAgICAgICAgICAgICAgICBvbl9m
        cmVxKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnayc6CiAgICAg
        ICAgICAgICAgICBvbl9raWxsKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAnSyc6CiAgICAgICAgICAgICAgICBvbl9mYXRhbChwYXJhbSkKICAg
        ICAgICAgICAgZWxpZiBjbWQgPT0gJ2RzJzoKICAgICAgICAgICAgICAgIGlm
        IHBhcmFtLmxvd2VyKCkgPT0gImkiOiBwYXJhbSA9ICIxIgogICAgICAgICAg
        ICAgICAgaWYgcGFyYW0ubG93ZXIoKSA9PSAicSI6IHBhcmFtID0gIjIiCiAg
        ICAgICAgICAgICAgICBvbl9zZXR0aW5nKCJkaXJlY3Rfc2FtcCIsIHBhcmFt
        KQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnaXEnOgogICAgICAgICAgICAg
        ICAgb25fc2V0dGluZygiaXFfc3dhcCIsIHBhcmFtKQogICAgICAgICAgICBl
        bGlmIGNtZCA9PSAnYnQnOgogICAgICAgICAgICAgICAgb25fc2V0dGluZygi
        Ymlhc3RlZSIsIHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnZGEn
        OgogICAgICAgICAgICAgICAgb25fc2V0dGluZygiZGlnaXRhbF9hZ2MiLCBw
        YXJhbSkKICAgICAgICAgICAgZWxpZiBjbWQgPT0gJ290JzoKICAgICAgICAg
        ICAgICAgIG9uX3NldHRpbmcoIm9mZnNldF90dW5lIiwgcGFyYW0pCiAgICAg
        ICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpbmZvKCd1bmtub3duIGNv
        bW1hbmQnKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGlu
        Zm8oZiJFeGNlcHRpb24gb25fbWVzc2FnZSgpOiB7ZX0iKQoKCmRlZiBvbl9j
        b25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCByYyk6CiAgICBjbGll
        bnQuc3Vic2NyaWJlKGdlbl90b3BpYygnIycpKQogICAgY2xpZW50LnN1YnNj
        cmliZShhcmdzLnBwc190b3BpYykKCgojIyMjIyMjIyMjIyMjIyMKCmRlZiBp
        bmZvKHBheWxvYWQpOgogICAgcHJpbnQocGF5bG9hZCwgZmlsZT1zeXMuc3Rk
        ZXJyKQogICAgaWYgYnJva2VyOgogICAgICAgIGJyb2tlci5wdWJsaXNoKGdl
        bl90b3BpYygiaW5mbyIpLCBwYXlsb2FkKQoKCmRlZiBsb2dfaGFuZGxlcihs
        b2dfbGV2ZWwsIGxvZ19tZXNzYWdlKToKICAgIGlmIGJyb2tlcjoKICAgICAg
        ICBicm9rZXIucHVibGlzaChnZW5fdG9waWMoImxvZyIpLCBsb2dfbWVzc2Fn
        ZSkKCgpkZWYgd2F2X2hlYWRlcihyYXRlLCBjaGFubmVscz0yLCBzYW1wbGVf
        Ynl0ZXM9NCk6CiAgICByYXRlID0gaW50KHJhdGUpCiAgICBkYXRhX2lkID0g
        YidkYXRhJwogICAgZGF0YV9zaXplID0gMHg4MDAwMDAwMAogICAgcmlmZl9p
        ZCA9IGInUklGRicKICAgIHJpZmZfZm9ybWF0ID0gYidXQVZFJwogICAgZm10
        X2lkID0gYidmbXQgJwogICAgZm10X3NpemUgPSAxNgogICAgZm10X2Zvcm1h
        dCA9IDMgICAgIyBJRUVFX0ZMT0FUCiAgICBidWYgPSBzdHJ1Y3QucGFjaygn
        PDRzSTRzJywgcmlmZl9pZCwgZGF0YV9zaXplICsgMjAgKyBmbXRfc2l6ZSwg
        cmlmZl9mb3JtYXQpCiAgICBidWYgKz0gc3RydWN0LnBhY2soJzw0c0lISCcs
        IGZtdF9pZCwgZm10X3NpemUsIGZtdF9mb3JtYXQsIGNoYW5uZWxzKQogICAg
        YnVmICs9IHN0cnVjdC5wYWNrKCc8SUlISCcsCiAgICAgICAgcmF0ZSwgICAg
        ICAgICAgICAgICAgICAgICAgICAgICAjIDMyLWJpdAogICAgICAgIHJhdGUg
        KiBjaGFubmVscyAqIHNhbXBsZV9ieXRlcywgIyAzMi1iaXQKICAgICAgICBj
        aGFubmVscyAqIHNhbXBsZV9ieXRlcywKICAgICAgICBzYW1wbGVfYnl0ZXMg
        KiA4KQogICAgYnVmICs9IHN0cnVjdC5wYWNrKCc8NHNJJywgZGF0YV9pZCwg
        ZGF0YV9zaXplKQogICAgcmV0dXJuIGJ1ZgoKCmRlZiByYWRpb19jb25uZWN0
        KCk6CiAgICBnbG9iYWwgcmFkaW8KICAgIGRyaXZlcnMgPSBbIGRbJ2RyaXZl
        ciddIGZvciBkIGluIFNvYXB5U0RSLkRldmljZS5lbnVtZXJhdGUoKSBdCiAg
        ICBpbmZvKGYiRm91bmQgZHJpdmVyczoge2RyaXZlcnN9IikKICAgIGt3ID0g
        e30KICAgIGlmIGFyZ3MuZHJpdmVyOgogICAgICAgIGt3Wydkcml2ZXInXSA9
        IGFyZ3MuZHJpdmVyCiAgICBpbmZvKGYiUGFzc2luZyB0aGUgZm9sbG93aW5n
        IGFyZ3VtZW50czoge2t3fSIpCiAgICByYWRpbyA9IFNvYXB5U0RSLkRldmlj
        ZShrdykKCgpkZWYgcmFkaW9fc2V0dGluZ3MoKToKICAgIGluZm8oZiJJbml0
        aWFsaXppbmcgcmFkaW8gc2V0dGluZ3MiKQogICAgaWYgYXJncy5mcmVxOgog
        ICAgICAgIHJhZGlvLnNldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAsIGFy
        Z3MuZnJlcSkKICAgIGlmIGFyZ3MucmF0ZToKICAgICAgICByYWRpby5zZXRT
        YW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwgMCwgYXJncy5yYXRlKQogICAgcmFk
        aW8uc2V0R2Fpbk1vZGUoU09BUFlfU0RSX1JYLCAwLCBhcmdzLmFnYyk7CiAg
        ICBpZiBhcmdzLmdhaW46CiAgICAgICAgcmFkaW8uc2V0R2FpbihTT0FQWV9T
        RFJfUlgsIDAsIGFyZ3MuZ2FpbikKICAgIGlmIGFyZ3MuZGlyZWN0X3NhbXA6
        CiAgICAgICAgcGFyYW0gPSBhcmdzLmRpcmVjdF9zYW1wCiAgICAgICAgaWYg
        cGFyYW0ubG93ZXIoKSA9PSAiaSI6IHBhcmFtID0gIjEiCiAgICAgICAgaWYg
        cGFyYW0ubG93ZXIoKSA9PSAicSI6IHBhcmFtID0gIjIiCiAgICAgICAgcmFk
        aW8ud3JpdGVTZXR0aW5nKCJkaXJlY3Rfc2FtcCIsIHBhcmFtKQogICAgaWYg
        YXJncy5pcV9zd2FwOgogICAgICAgIHJhZGlvLndyaXRlU2V0dGluZygiaXFf
        c3dhcCIsICJ0cnVlIikKICAgIGlmIGFyZ3MuYmlhc3RlZToKICAgICAgICBy
        YWRpby53cml0ZVNldHRpbmcoImJpYXN0ZWUiLCAidHJ1ZSIpCiAgICBpZiBh
        cmdzLmRpZ2l0YWxfYWdjOgogICAgICAgIHJhZGlvLndyaXRlU2V0dGluZygi
        ZGlnaXRhbF9hZ2MiLCAidHJ1ZSIpCiAgICBpZiBhcmdzLmRpZ2l0YWxfYWdj
        OgogICAgICAgIHJhZGlvLndyaXRlU2V0dGluZygib2Zmc2V0X3R1bmUiLCAi
        dHJ1ZSIpCgoKZGVmIG1haW5faW5pdCgpOgogICAgZ2xvYmFsIHBhdXNlZCwg
        a2lsbGVkLCBmYXRhbAogICAga2lsbGVkID0gRmFsc2UKICAgIGZhdGFsID0g
        RmFsc2UKICAgIHBhdXNlZCA9IGFyZ3MucGF1c2UKCgpkZWYgYnJva2VyX2lu
        aXQoKToKICAgIGdsb2JhbCBicm9rZXIsIHRpbWVmaWxlCiAgICB0aW1lZmls
        ZSA9IE5vbmUKICAgIGJyb2tlciA9IE5vbmUKICAgIGlmIG5vdCBhcmdzLm5v
        YnJva2VyOgogICAgICAgIGluZm8oZiJDb25uZWN0aW5nIHRvIGJyb2tlcjog
        e2FyZ3MuYnJva2VyfSIpCiAgICAgICAgYnJva2VyID0gbXF0dC5DbGllbnQo
        KQogICAgICAgIGJyb2tlci5vbl9jb25uZWN0ID0gb25fY29ubmVjdAogICAg
        ICAgIGJyb2tlci5vbl9tZXNzYWdlID0gb25fbWVzc2FnZQogICAgICAgIGJy
        b2tlci5jb25uZWN0KGFyZ3MuYnJva2VyLCBhcmdzLmJyb2tlcl9wb3J0LCBh
        cmdzLmJyb2tlcl9rZWVwYWxpdmUpCiAgICAgICAgYnJva2VyLmxvb3Bfc3Rh
        cnQoKQogICAgaW5mbygnSW5pdGlhbGl6aW5nJykKCgpkZWYgbWFpbigpOgog
        ICAgYnJva2VyX2luaXQoKQogICAgU29hcHlTRFIucmVnaXN0ZXJMb2dIYW5k
        bGVyKGxvZ19oYW5kbGVyKQogICAgaW5pdGlhbGl6ZWQ9IEZhbHNlCiAgICB3
        aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgbWFpbl9pbml0
        KCkKICAgICAgICAgICAgcmFkaW9fY29ubmVjdCgpCiAgICAgICAgICAgIGlm
        IG5vdCBpbml0aWFsaXplZDoKICAgICAgICAgICAgICAgIHJhZGlvX3NldHRp
        bmdzKCkKICAgICAgICAgICAgaW5pdGlhbGl6ZWQgPSBUcnVlCiAgICAgICAg
        ICAgIHJhZGlvX3N0YXJ0KCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFz
        IGU6CiAgICAgICAgICAgIGluZm8oZiJFeGNlcHRpb24gbWFpbigpOiB7ZX0i
        KQogICAgICAgICAgICB0aW1lLnNsZWVwKHJlc3RhcnRfc2Vjb25kcykKCgpk
        ZWYgY2xvc2VfZmlsZShmLCBuYW1lKToKICAgIGlmIGY6CiAgICAgICAgaW5m
        byhmIkNsb3Npbmcge25hbWV9IGZpbGUuIikKICAgICAgICBmLmNsb3NlKCkK
        CgpkZWYgb3Blbl9maWxlcygpOgogICAgZHQgPSBkYXRldGltZS51dGNub3co
        KQogICAgdHMgPSBkdC5zdHJmdGltZSgnJXklbSVkXyVIJU0lUycpCiAgICBm
        cmVxID0gcmFkaW8uZ2V0RnJlcXVlbmN5KFNPQVBZX1NEUl9SWCwgMCkKICAg
        IGJhc2VuYW1lID0gZiJ7YXJncy5vdXRwdXR9X3t0c31aX3tmcmVxLzFlNjou
        NmZ9TUh6IgogICAgZXh0ID0gJ3R4dCcKICAgIGZpbGVuYW1lID0gZiJ7YmFz
        ZW5hbWV9LntleHR9IgogICAgaW5mbyhmIk9wZW5pbmcge2ZpbGVuYW1lfSBm
        b3IgZ3BzIHBwcyB0aW1lIikKICAgIHRpbWVmaWxlID0gb3BlbihmaWxlbmFt
        ZSwgInciKQogICAgZXh0ID0gJ3JhdycgaWYgYXJncy5ub3dhdmUgZWxzZSAn
        d2F2JwogICAgZmlsZW5hbWUgPSBmIntiYXNlbmFtZX0ue2V4dH0iCiAgICBp
        bmZvKGYiT3BlbmluZyB7ZmlsZW5hbWV9IGZvciBhdWRpbyIpCiAgICBhdWRp
        b2ZpbGUgPSBvcGVuKGZpbGVuYW1lLCAid2IiKQogICAgaWYgbm90IGFyZ3Mu
        bm93YXZlOgogICAgICAgIGF1ZGlvZmlsZS53cml0ZSh3YXZfaGVhZGVyKHJh
        dGU9cmF0ZSkpCiAgICByZXR1cm4gYXVkaW9maWxlLCB0aW1lZmlsZQoKCmRl
        ZiBjbG9zZV9zdHJlYW0oc3RyZWFtKToKICAgIGluZm8oZiJDbG9zaW5nIHJh
        ZGlvIHN0cmVhbS4iKQogICAgcmFkaW8uZGVhY3RpdmF0ZVN0cmVhbShzdHJl
        YW0pIAogICAgcmFkaW8uY2xvc2VTdHJlYW0oc3RyZWFtKQoKCmRlZiByYWRp
        b19wZWFrKHBlYWtfbGV2ZWwpOgogICAgZGIgPSAiezouMWZ9IGRCIi5mb3Jt
        YXQoMjAgKiBucC5sb2cxMChwZWFrX2xldmVsICsgMWUtOTkpKQogICAgaWYg
        YXJncy5tZXRlcjoKICAgICAgICBidWYgPSBmIntkYn1cbiIgaWYgYXJncy5k
        dW1iIGVsc2UgZiJcMzNbMkt7ZGI6PjlzfVxyIgogICAgICAgIHByaW50KGJ1
        ZiwgZW5kPSIiLCBmaWxlPXN5cy5zdGRlcnIpCiAgICBpZiBicm9rZXI6CiAg
        ICAgICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJwZWFrIiksIGRiKQoK
        CiMjIyMjIyMjIyMjIyMjIwoKc29ja19saXN0ID0gW10Kc29ja19zZXJ2ZXI9
        IE5vbmUKCgpkZWYgb3Blbl9jb25uKHNvY2ssIGNsaWVudF9hZGRyZXNzKToK
        ICAgIHNvY2tfbGlzdC5hcHBlbmQoc29jaykKCgpkZWYgY2xvc2VfY29ubihz
        b2NrKToKICAgIHNvY2tfbGlzdC5yZW1vdmUoc29jaykKICAgIHNvY2suY2xv
        c2UoKQoKCmRlZiBjbG9zZV9zZXJ2ZXIoKToKICAgIGZvciBzb2NrIGluIHNv
        Y2tfbGlzdDoKICAgICAgICBzb2NrLmNsb3NlKCkKCgpkZWYgdGNwX3NlcnZl
        cihkYXRhKToKICAgIGlmIGFyZ3MucnRsdGNwOgogICAgICAgIGRhdGEgPSAo
        ZGF0YSAqIDEyOCArIDEyOCkuYXN0eXBlKCdCJykKICAgIHJlYWRhYmxlLCB3
        cml0YWJsZSwgZXhjZXB0aW9uYWwgPSBzZWxlY3Quc2VsZWN0KHNvY2tfbGlz
        dCwgc29ja19saXN0LCBzb2NrX2xpc3QsIDApCiAgICBmb3Igc29jayBpbiBz
        b2NrX2xpc3Q6CiAgICAgICAgaWYgc29jayBpbiBleGNlcHRpb25hbDoKICAg
        ICAgICAgICAgY2xvc2VfY29ubihzb2NrKQogICAgZm9yIHNvY2sgaW4gc29j
        a19saXN0OgogICAgICAgIGlmIHNvY2sgaW4gd3JpdGFibGU6CiAgICAgICAg
        ICAgIHRyeToKICAgICAgICAgICAgICAgIHNvY2suc2VuZGFsbChkYXRhKQog
        ICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIGNs
        b3NlX2Nvbm4oc29jaykKICAgIGZvciBzb2NrIGluIHNvY2tfbGlzdDoKICAg
        ICAgICBpZiBzb2NrIGluIHJlYWRhYmxlOgogICAgICAgICAgICBpZiBzb2Nr
        ID09IHNvY2tfc2VydmVyOgogICAgICAgICAgICAgICAgY29ubiwgY2xpZW50
        X2FkZHJlc3MgPSBzb2NrLmFjY2VwdCgpCiAgICAgICAgICAgICAgICBvcGVu
        X2Nvbm4oY29ubiwgY2xpZW50X2FkZHJlc3MpCiAgICAgICAgICAgICAgICBp
        ZiBhcmdzLnJ0bHRjcDoKICAgICAgICAgICAgICAgICAgICB0dW5lcl9udW1i
        ZXIgPSA1ICMgUjgyMFQKICAgICAgICAgICAgICAgICAgICB0dW5lcl9nYWlu
        cyA9IDI5ICMgUjgyMFQKICAgICAgICAgICAgICAgICAgICBkb25nbGVfaW5m
        byA9IHN0cnVjdC5wYWNrKCc+NHNJSScsIGInUlRMMCcsIHR1bmVyX251bWJl
        ciwgdHVuZXJfZ2FpbnMpCiAgICAgICAgICAgICAgICAgICAgY29ubi5zZW5k
        YWxsKGRvbmdsZV9pbmZvKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAg
        ICAgICAgc29jay5yZWN2KDQwOTYpCgoKZGVmIGluaXRfc2VydmVyKCk6CiAg
        ICBnbG9iYWwgc29ja19zZXJ2ZXIsIHNvY2tfbGlzdAogICAgc29jayA9IHNv
        Y2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVB
        TSkKICAgIHNvY2suc2V0c29ja29wdChzb2NrZXQuU09MX1NPQ0tFVCwgc29j
        a2V0LlNPX1JFVVNFQUREUiwgMSkKICAgIHNvY2suYmluZCgoYXJncy5ob3N0
        LCBhcmdzLnBvcnQpKQogICAgc29jay5saXN0ZW4oKQogICAgc29ja19saXN0
        ID0gWyBzb2NrIF0KICAgIHNvY2tfc2VydmVyID0gc29jawoKCmRlZiByYWRp
        b19zdGFydCgpOgogICAgZ2xvYmFsIHJhdGUsIHRpbWVmaWxlLCBzYW1wbGVz
        X3RvdGFsCiAgICBpZiBub3QgYXJncy5ub3NlcnZlcjogCiAgICAgICAgaW5p
        dF9zZXJ2ZXIoKQogICAgcmF0ZSA9IHJhZGlvLmdldFNhbXBsZVJhdGUoU09B
        UFlfU0RSX1JYLCAwKQogICAgZGF0YSA9IG5wLmFycmF5KFswXSAqIGFyZ3Mu
        cGFja2V0X3NpemUgKiAyLCBucC5mbG9hdDMyKQogICAgc3RyZWFtID0gcmFk
        aW8uc2V0dXBTdHJlYW0oU09BUFlfU0RSX1JYLCBTT0FQWV9TRFJfQ0YzMikK
        ICAgIHJhZGlvLmFjdGl2YXRlU3RyZWFtKHN0cmVhbSkgCiAgICBzYW1wbGVz
        X3RvdGFsID0gMAogICAgcGVha19sZXZlbCA9IDAKICAgIHNhbXBsZV9udW0g
        PSAwCiAgICBvdXRmaWxlID0gTm9uZQogICAgdHJ5OgogICAgICAgIHdoaWxl
        IG5vdCBraWxsZWQgYW5kIG5vdCBmYXRhbDoKICAgICAgICAgICAgcmFkaW8u
        cmVhZFN0cmVhbShzdHJlYW0sIFtkYXRhXSwgYXJncy5wYWNrZXRfc2l6ZSkK
        ICAgICAgICAgICAgaWYgbm90IHBhdXNlZDoKICAgICAgICAgICAgICAgIGlm
        IG5vdCBvdXRmaWxlOgogICAgICAgICAgICAgICAgICAgIG91dGZpbGUsIHRp
        bWVmaWxlID0gb3Blbl9maWxlcygpCiAgICAgICAgICAgICAgICBzYW1wbGVz
        X3RvdGFsICs9IGFyZ3MucGFja2V0X3NpemUKICAgICAgICAgICAgICAgIG91
        dGZpbGUud3JpdGUoZGF0YSkKICAgICAgICAgICAgaWYgbm90IGFyZ3Mubm9z
        ZXJ2ZXI6CiAgICAgICAgICAgICAgICB0Y3Bfc2VydmVyKGRhdGEpCgogICAg
        ICAgICAgICAjIHBlYWsgbWV0ZXIKICAgICAgICAgICAgcGVha19sZXZlbCA9
        IG1heChwZWFrX2xldmVsLCBhYnMoZGF0YS5taW4oKSksIGFicyhkYXRhLm1h
        eCgpKSkKICAgICAgICAgICAgc2FtcGxlX251bSArPSBhcmdzLnBhY2tldF9z
        aXplCiAgICAgICAgICAgIGlmIHNhbXBsZV9udW0gPiByYXRlICogYXJncy5y
        ZWZyZXNoOgogICAgICAgICAgICAgICAgcmFkaW9fcGVhayhwZWFrX2xldmVs
        KQogICAgICAgICAgICAgICAgcGVha19sZXZlbCA9IDAKICAgICAgICAgICAg
        ICAgIHNhbXBsZV9udW0gPSAwCiAgICBleGNlcHQgKEtleWJvYXJkSW50ZXJy
        dXB0LCBTeXN0ZW1FcnJvcikgYXMgZToKICAgICAgICBpbmZvKGYiRXhjZXB0
        aW9uIHJhZGlvX3N0YXJ0KCk6IHtlfSIpCiAgICBpZiBub3QgYXJncy5ub3Nl
        cnZlcjogCiAgICAgICAgY2xvc2Vfc2VydmVyKCkKICAgIGNsb3NlX2ZpbGUo
        b3V0ZmlsZSwgImF1ZGlvIikKICAgIHRpbWVmaWxlID0gY2xvc2VfZmlsZSh0
        aW1lZmlsZSwgInRpbWUiKQogICAgY2xvc2Vfc3RyZWFtKHN0cmVhbSkKICAg
        IGlmIGZhdGFsOgogICAgICAgIGluZm8oIkZhdGFsIGNvbW1hbmQgZ2l2ZW4s
        IGtpbGxpbmcgcHJvY2VzcyIpCiAgICAgICAgc3lzLmV4aXQoMSkKCgppZiBf
        X25hbWVfXyA9PSAnX19tYWluX18nOgogICAgYXJncyA9IHBhcnNlci5wYXJz
        ZV9hcmdzKCkKICAgIG1haW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqclient
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgc3lzCmltcG9ydCBhcmdwYXJz
        ZQppbXBvcnQgcGFoby5tcXR0LmNsaWVudCBhcyBtcXR0CgpwYXJzZXIgPSBh
        cmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1h
        cmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEi
        LCBoZWxwPSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0t
        cG9ydCIsIGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhl
        bHA9J2Jyb2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdjb21tYW5kIHRvcGlj
        JykKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCBy
        Yyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKCIjIikKCmRlZiBvbl9tZXNzYWdl
        KGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAgICBwcmludChtc2cudG9waWMg
        KyAiICIgKyBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykpCgpkZWYgbWFp
        bigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50Lm9u
        X2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2FnZSA9
        IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2VyLCBh
        cmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bfc3Rh
        cnQoKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICBsaW5lID0gbmV4dChzeXMu
        c3RkaW4pLnJzdHJpcCgpCiAgICAgICAgY2xpZW50LnB1Ymxpc2goYXJncy50
        b3BpYywgbGluZSkgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAg
        YXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==



  # output directory

  - become: yes
    file: path={{ fs_path }} state=directory owner={{ user }} group={{ user }}

  - become: yes
    copy:
      dest: /lib/systemd/system/mqsoapy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqsoapy --rtltcp --pause --output {{ fs_path }}/out
        # WorkingDirectory={{ fs_path }}
        User=george
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    shell: |
      sudo systemctl enable mqsoapy
      sudo systemctl restart mqsoapy


