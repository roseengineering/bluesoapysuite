---
  - set_fact:
      fs_path: "{{ fs_path | default('/srv') }}"

  # apt

  - become: yes
    apt:
      name:
      - mosquitto

  # pip

  - become: yes
    pip:
      name:
      - paho-mqtt

  # code

  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqsoapy
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgb3MsIHN5cywgdGltZQppbXBv
        cnQgc29ja2V0LCBzZWxlY3QKaW1wb3J0IHN0cnVjdAppbXBvcnQgYXJncGFy
        c2UKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYWhvLm1xdHQuY2xpZW50
        IGFzIG1xdHQKaW1wb3J0IFNvYXB5U0RSCmZyb20gZGF0ZXRpbWUgaW1wb3J0
        IGRhdGV0aW1lCmZyb20gU29hcHlTRFIgaW1wb3J0IFNPQVBZX1NEUl9SWCwg
        U09BUFlfU0RSX0NGMzIKCmNvbW1hbmRfZm10ID0gIj5CSSIKY29tbWFuZF9z
        aXplID0gc3RydWN0LmNhbGNzaXplKGNvbW1hbmRfZm10KQoKCnBhcnNlciA9
        IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKAogICAgZm9ybWF0dGVyX2NsYXNz
        PWFyZ3BhcnNlLkFyZ3VtZW50RGVmYXVsdHNIZWxwRm9ybWF0dGVyKQoKIyBi
        cm9rZXIKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0
        PSIwLjAuMC4wIiwgaGVscD0nYnJva2VyIGhvc3QnKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLWJyb2tlci1wb3J0IiwgZGVmYXVsdD0xODgzLCB0eXBlPWlu
        dCwgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
        LWJyb2tlci1rZWVwYWxpdmUiLCBkZWZhdWx0PTYwLCB0eXBlPWludCwgaGVs
        cD0nYnJva2VyIGtlZXBhbGl2ZSBzZWNvbmRzJykKcGFyc2VyLmFkZF9hcmd1
        bWVudCgiLS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdtcXR0IHRv
        cGljIGZvciBjb21tYW5kJykKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcHMt
        dG9waWMiLCBkZWZhdWx0PSJwcHMiLCBoZWxwPSdtcXR0IHRvcGljIGZvciBn
        cHMgcHBzIHRpbWUnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW5vYnJva2Vy
        IiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZGlzYWJsZSBtcXR0IGJy
        b2tlciIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcmVmcmVzaC1wcHMiLCBk
        ZWZhdWx0PTEwLCB0eXBlPWludCwgaGVscD0ncHBzIHJlZnJlc2ggaW4gc2Vj
        b25kcycpCgojIHNvYXB5CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tZHJpdmVy
        IiwgaGVscD0nbmFtZSBvZiBkcml2ZXInKQpwYXJzZXIuYWRkX2FyZ3VtZW50
        KCItLXBhY2tldC1zaXplIiwgZGVmYXVsdD0xMDI0LCB0eXBlPWludCwgaGVs
        cD0ncGFja2V0IHNpemUnKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWZyZXEi
        LCB0eXBlPW5wLmZsb2F0LCBoZWxwPSJjZW50ZXIgZnJlcXVlbmN5IGluIGhl
        cnR6IikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1yYXRlIiwgdHlwZT1ucC5m
        bG9hdCwgaGVscD0ic2FtcGxlIHJhdGUgaW4gaGVydHoiKQpwYXJzZXIuYWRk
        X2FyZ3VtZW50KCItLWdhaW4iLCB0eXBlPW5wLmZsb2F0LCBoZWxwPSJmcm9u
        dCBlbmQgZ2FpbiBpbiBkQiIpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tYWdj
        IiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZW5hYmxlIEFHQyIpCgoj
        IHNvYXB5IGFyZ1N0cmluZwpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWRpcmVj
        dC1zYW1wIiwgaGVscD0iMSBvciBpPUksIDIgb3IgcT1RIGNoYW5uZWwiKQpw
        YXJzZXIuYWRkX2FyZ3VtZW50KCItLWlxLXN3YXAiLCBhY3Rpb249InN0b3Jl
        X3RydWUiLCBoZWxwPSJzd2FwIElRIHNpZ25hbHMiKQpwYXJzZXIuYWRkX2Fy
        Z3VtZW50KCItLWJpYXN0ZWUiLCBhY3Rpb249InN0b3JlX3RydWUiLCBoZWxw
        PSJlbmFibGUgYmlhcyB0ZWUiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWRp
        Z2l0YWwtYWdjIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iZW5hYmxl
        IGRpZ2l0YWwgQUdDIikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1vZmZzZXQt
        dHVuZSIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBvZmZz
        ZXQgdHVuZSIpCgojIG90aGVyCnBhcnNlci5hZGRfYXJndW1lbnQoIi0tb3V0
        cHV0IiwgZGVmYXVsdD0ib3V0IiwgaGVscD0id3JpdGUgQ0YzMiBzYW1wbGVz
        IHRvIGZpbGUiKQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW5vd2F2ZSIsIGFj
        dGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2FibGUgV0FWIGhlYWRlciIp
        CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcGF1c2UiLCBhY3Rpb249InN0b3Jl
        X3RydWUiLCBoZWxwPSJwYXVzZSBvdXRwdXQiKQpwYXJzZXIuYWRkX2FyZ3Vt
        ZW50KCItLXJlc3RhcnQtc2Vjb25kcyIsIGRlZmF1bHQ9MTAsIGhlbHA9InJl
        c3RhcnQgZGVsYXkgaW4gc2Vjb25kcyIpCgojIHBlYWsgbWV0ZXIKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1yZWZyZXNoIiwgZGVmYXVsdD01LCB0eXBlPWlu
        dCwgaGVscD0icGVhayBtZXRlciByZWZyZXNoIGluIHNlY29uZHMiKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLW1ldGVyIiwgYWN0aW9uPSJzdG9yZV90cnVl
        IiwgaGVscD0iZW5hYmxlIGNvbnNvbGUgcGVhayBtZXRlciIpCnBhcnNlci5h
        ZGRfYXJndW1lbnQoIi0tZHVtYiIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhl
        bHA9ImVuYWJsZSBkdW1iIHRlcm1pbmFsIGNvbnNvbGUiKQogCiMgdGNwIHNl
        cnZlcgpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWhvc3QiLCBkZWZhdWx0PSIw
        LjAuMC4wIiwgaGVscD0iQ0YzMiB0Y3Agc2VydmVyIGhvc3QgYWRkcmVzcyIp
        CnBhcnNlci5hZGRfYXJndW1lbnQoIi0tcG9ydCIsIHR5cGU9aW50LCBkZWZh
        dWx0PTEyMzQsIGhlbHA9IkNGMzIgdGNwIHNlcnZlciBwb3J0IGFkZHJlc3Mi
        KQpwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXJ0bHRjcCIsIGFjdGlvbj0ic3Rv
        cmVfdHJ1ZSIsIGhlbHA9ImVuYWJsZSBDVTggcnRsdGNwIHNlcnZlciBtb2Rl
        IikKcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1ub3NlcnZlciIsIGFjdGlvbj0i
        c3RvcmVfdHJ1ZSIsIGhlbHA9ImRpc2FibGUgdGNwIHNlcnZlciIpCnBhcnNl
        ci5hZGRfYXJndW1lbnQoIi0tZnJlZXplIiwgYWN0aW9uPSJzdG9yZV90cnVl
        IiwgaGVscD0iZnJlZXplIHRjcCBzZXJ2ZXIgc2V0dGluZ3MiKQoKCmRlZiBn
        ZW5fdG9waWMobmFtZT1Ob25lKToKICAgIGQgPSBhcmdzLnRvcGljLnNwbGl0
        KCcvJylbOi0xXQogICAgaWYgbmFtZSBpcyBub3QgTm9uZToKICAgICAgICBk
        LmFwcGVuZChuYW1lKQogICAgcmV0dXJuICcvJy5qb2luKGQpCgoKZGVmIHRv
        X2Zsb2F0KHBhcmFtKToKICAgIHRyeToKICAgICAgICByZXR1cm4gZmxvYXQo
        cGFyYW0pCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwYXNzCgoK
        IyMjIyMjIyMjIyMjCgpkZWYgb25faW5mbyhwYXJhbSk6CiAgICBjaGFuID0g
        MAogICAgZm9yIHIgaW4gcmFkaW8uZ2V0U2FtcGxlUmF0ZVJhbmdlKFNPQVBZ
        X1NEUl9SWCwgY2hhbik6CiAgICAgICBwYXlsb2FkID0gJ3JhdGU6IHs6LjNm
        fSBLSHonLmZvcm1hdChyLm1pbmltdW0oKSAvIDFlMykKICAgICAgIGluZm8o
        cGF5bG9hZCkKICAgIGZvciByIGluIHJhZGlvLmdldEZyZXF1ZW5jeVJhbmdl
        KFNPQVBZX1NEUl9SWCwgY2hhbik6CiAgICAgICBwYXlsb2FkID0gJ2ZyZXE6
        IHs6LjZmfSAtIHs6LjZmfSBNSHonLmZvcm1hdCgKICAgICAgICAgICByLm1p
        bmltdW0oKSAvIDFlNiwgci5tYXhpbXVtKCkgLyAxZTYpCiAgICAgICBpbmZv
        KHBheWxvYWQpCiAgICByID0gcmFkaW8uZ2V0R2FpblJhbmdlKFNPQVBZX1NE
        Ul9SWCwgY2hhbikKICAgIHBheWxvYWQgPSAnZ2FpbjogezouMmZ9IC0gezou
        MmZ9IGRCJy5mb3JtYXQoci5taW5pbXVtKCksIHIubWF4aW11bSgpKQogICAg
        aW5mbyhwYXlsb2FkKQoKCmRlZiBvbl9mYXRhbChwYXJhbSk6CiAgICBnbG9i
        YWwgZmF0YWwKICAgIGlmIHBhcmFtLmxvd2VyKCkgPT0gInRydWUiOgogICAg
        ICAgIGZhdGFsID0gVHJ1ZQogICAgICAgIGluZm8oJ2ZhdGFsIGtpbGxpbmcn
        KQogICAgZWxzZToKICAgICAgICBpbmZvKCdiYWQgZmF0YWwgY29tbWFuZCcp
        CgoKZGVmIG9uX2tpbGwocGFyYW0pOgogICAgZ2xvYmFsIGtpbGxlZAogICAg
        aWYgcGFyYW0ubG93ZXIoKSA9PSAidHJ1ZSI6CiAgICAgICAga2lsbGVkID0g
        VHJ1ZQogICAgICAgIGluZm8oJ2tpbGxpbmcgc3RyZWFtJykKICAgIGVsc2U6
        CiAgICAgICAgaW5mbygnYmFkIGtpbGwgY29tbWFuZCcpCgoKZGVmIG9uX3Bh
        dXNlKHBhcmFtKToKICAgIGdsb2JhbCBwYXVzZWQKICAgIGlmIHBhcmFtOgog
        ICAgICAgIHBhdXNlZCA9IHBhcmFtLmxvd2VyKCkgPT0gInRydWUiCiAgICBi
        cm9rZXIucHVibGlzaChnZW5fdG9waWMoInBhdXNlIiksICdvbicgaWYgcGF1
        c2VkIGVsc2UgJ29mZicpCgoKZGVmIG9uX3JhdGUocGFyYW0pOgogICAgZ2xv
        YmFsIHJhdGUKICAgIGlmIHBhcmFtOgogICAgICAgIHBhcmFtID0gdG9fZmxv
        YXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAg
        ICAgaW5mbygnYmFkIHNhbXBsZSByYXRlIGNvbW1hbmQnKQogICAgICAgIGVs
        c2U6CiAgICAgICAgICAgIHJhZGlvLnNldFNhbXBsZVJhdGUoU09BUFlfU0RS
        X1JYLCAwLCBwYXJhbSkKICAgIHJhdGUgPSByYWRpby5nZXRTYW1wbGVSYXRl
        KFNPQVBZX1NEUl9SWCwgMCkKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3Bp
        YygicmF0ZSIpLCBmJ3tyYXRlLzFlMzouM2Z9IEtIeicpCgoKZGVmIG9uX2Zy
        ZXEocGFyYW0pOgogICAgaWYgcGFyYW06CiAgICAgICAgcGFyYW0gPSB0b19m
        bG9hdChwYXJhbSkKICAgICAgICBpZiBwYXJhbSBpcyBOb25lOgogICAgICAg
        ICAgICBpbmZvKCdiYWQgZnJlcXVlbmN5IGNvbW1hbmQnKQogICAgICAgIGVs
        c2U6CiAgICAgICAgICAgIHJhZGlvLnNldEZyZXF1ZW5jeShTT0FQWV9TRFJf
        UlgsIDAsIHBhcmFtKQogICAgZnJlcSA9IHJhZGlvLmdldEZyZXF1ZW5jeShT
        T0FQWV9TRFJfUlgsIDApCiAgICBicm9rZXIucHVibGlzaChnZW5fdG9waWMo
        ImZyZXEiKSwgZid7ZnJlcS8xZTY6LjZmfSBNSHonKQoKCmRlZiBvbl9nYWlu
        KHBhcmFtKToKICAgIGlmIHBhcmFtOgogICAgICAgIHBhcmFtID0gdG9fZmxv
        YXQocGFyYW0pCiAgICAgICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAg
        ICAgaW5mbygnYmFkIGdhaW4gY29tbWFuZCcpCiAgICAgICAgZWxzZToKICAg
        ICAgICAgICAgcmFkaW8uc2V0R2FpbihTT0FQWV9TRFJfUlgsIDAsIHBhcmFt
        KQogICAgZ2FpbiA9IHJhZGlvLmdldEdhaW4oU09BUFlfU0RSX1JYLCAwKQog
        ICAgYnJva2VyLnB1Ymxpc2goZ2VuX3RvcGljKCJnYWluIiksIGYne2dhaW46
        LjNnfSBkQicpCgoKZGVmIG9uX2F1dG8ocGFyYW0pOgogICAgaWYgcGFyYW06
        CiAgICAgICAgcmFkaW8uc2V0R2Fpbk1vZGUoU09BUFlfU0RSX1JYLCAwLCBw
        YXJhbS5sb3dlcigpID09ICJ0cnVlIikKICAgIGFnYyA9IHJhZGlvLmdldEdh
        aW5Nb2RlKFNPQVBZX1NEUl9SWCwgMCkKICAgIGJyb2tlci5wdWJsaXNoKGdl
        bl90b3BpYygiYWdjIiksICdvbicgaWYgYWdjIGVsc2UgJ29mZicpCgoKZGVm
        IG9uX3NldHRpbmcoa2V5LCBwYXJhbSk6CiAgICBpZiBwYXJhbToKICAgICAg
        ICByYWRpby53cml0ZVNldHRpbmcoa2V5LCBwYXJhbSkKICAgIHZhbCA9IHJh
        ZGlvLnJlYWRTZXR0aW5nKGtleSkKICAgIGJyb2tlci5wdWJsaXNoKGdlbl90
        b3BpYyhrZXkpLCBzdHIodmFsKSkKCgpkZWYgb25fcHBzKHRzKToKICAgIGlm
        IHRpbWVmaWxlIGFuZCBub3QgcGF1c2VkOgogICAgICAgIHNlYyA9IHNhbXBs
        ZXNfdG90YWwgLyByYXRlCiAgICAgICAgZHQgPSBkYXRldGltZS5zdHJwdGlt
        ZSh0cywgIiVZLSVtLSVkVCVIOiVNOiVTLiVmWiIpCiAgICAgICAgaWYgZHQu
        c2Vjb25kICUgYXJncy5yZWZlc2hfcHBzID09IDA6CiAgICAgICAgICAgIGlu
        Zm8odHMpCiAgICAgICAgdGltZWZpbGUud3JpdGUoZiJ7c2VjOi4zZn1cdHtz
        ZWM6LjNmfVx0e3RzfVxuIikKICAgICAgICB0aW1lZmlsZS5mbHVzaCgpCgoK
        ZGVmIG9uX21lc3NhZ2UoY2xpZW50LCB1c2VyZGF0YSwgbXNnKToKICAgIHBh
        eWxvYWQgPSBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykuc3RyaXAoKQog
        ICAgdHJ5OgogICAgICAgIGlmIHBheWxvYWQgYW5kIG1zZy50b3BpYyA9PSBh
        cmdzLnBwc190b3BpYzoKICAgICAgICAgICAgb25fcHBzKHBheWxvYWQpCiAg
        ICAgICAgaWYgcGF5bG9hZCBhbmQgbXNnLnRvcGljID09IGFyZ3MudG9waWM6
        CiAgICAgICAgICAgIGNtZCwgXywgcGFyYW0gPSBwYXlsb2FkLnBhcnRpdGlv
        bignICcpIAogICAgICAgICAgICBwYXJhbSA9IHBhcmFtLnN0cmlwKCkKICAg
        ICAgICAgICAgaWYgY21kID09ICdpJzoKICAgICAgICAgICAgICAgIG9uX2lu
        Zm8ocGFyYW0pCiAgICAgICAgICAgIGVsaWYgY21kID09ICdwJzoKICAgICAg
        ICAgICAgICAgIG9uX3BhdXNlKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAnZyc6CiAgICAgICAgICAgICAgICBvbl9nYWluKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnYSc6CiAgICAgICAgICAgICAgICBvbl9h
        dXRvKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAncic6CiAgICAg
        ICAgICAgICAgICBvbl9yYXRlKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNt
        ZCA9PSAnZic6CiAgICAgICAgICAgICAgICBvbl9mcmVxKHBhcmFtKQogICAg
        ICAgICAgICBlbGlmIGNtZCA9PSAnayc6CiAgICAgICAgICAgICAgICBvbl9r
        aWxsKHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnSyc6CiAgICAg
        ICAgICAgICAgICBvbl9mYXRhbChwYXJhbSkKICAgICAgICAgICAgZWxpZiBj
        bWQgPT0gJ2RzJzoKICAgICAgICAgICAgICAgIGlmIHBhcmFtLmxvd2VyKCkg
        PT0gImkiOiBwYXJhbSA9ICIxIgogICAgICAgICAgICAgICAgaWYgcGFyYW0u
        bG93ZXIoKSA9PSAicSI6IHBhcmFtID0gIjIiCiAgICAgICAgICAgICAgICBv
        bl9zZXR0aW5nKCJkaXJlY3Rfc2FtcCIsIHBhcmFtKQogICAgICAgICAgICBl
        bGlmIGNtZCA9PSAnaXEnOgogICAgICAgICAgICAgICAgb25fc2V0dGluZygi
        aXFfc3dhcCIsIHBhcmFtKQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnYnQn
        OgogICAgICAgICAgICAgICAgb25fc2V0dGluZygiYmlhc3RlZSIsIHBhcmFt
        KQogICAgICAgICAgICBlbGlmIGNtZCA9PSAnZGEnOgogICAgICAgICAgICAg
        ICAgb25fc2V0dGluZygiZGlnaXRhbF9hZ2MiLCBwYXJhbSkKICAgICAgICAg
        ICAgZWxpZiBjbWQgPT0gJ290JzoKICAgICAgICAgICAgICAgIG9uX3NldHRp
        bmcoIm9mZnNldF90dW5lIiwgcGFyYW0pCiAgICAgICAgICAgIGVsc2U6CiAg
        ICAgICAgICAgICAgICBpbmZvKCd1bmtub3duIGNvbW1hbmQnKQogICAgZXhj
        ZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGluZm8oZiJFeGNlcHRpb24g
        b25fbWVzc2FnZSgpOiB7ZX0iKQoKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwg
        dXNlcmRhdGEsIGZsYWdzLCByYyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKGdl
        bl90b3BpYygnIycpKQogICAgY2xpZW50LnN1YnNjcmliZShhcmdzLnBwc190
        b3BpYykKCgojIyMjIyMjIyMjIyMjIyMKCmRlZiBpbmZvKHBheWxvYWQpOgog
        ICAgcHJpbnQocGF5bG9hZCwgZmlsZT1zeXMuc3RkZXJyKQogICAgaWYgYnJv
        a2VyOgogICAgICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygiaW5mbyIp
        LCBwYXlsb2FkKQoKCmRlZiBsb2dfaGFuZGxlcihsb2dfbGV2ZWwsIGxvZ19t
        ZXNzYWdlKToKICAgIGlmIGJyb2tlcjoKICAgICAgICBicm9rZXIucHVibGlz
        aChnZW5fdG9waWMoImxvZyIpLCBsb2dfbWVzc2FnZSkKCgpkZWYgd2F2X2hl
        YWRlcihyYXRlLCBjaGFubmVscz0yLCBzYW1wbGVfYnl0ZXM9NCk6CiAgICBy
        YXRlID0gaW50KHJhdGUpCiAgICBkYXRhX2lkID0gYidkYXRhJwogICAgZGF0
        YV9zaXplID0gMHg4MDAwMDAwMAogICAgcmlmZl9pZCA9IGInUklGRicKICAg
        IHJpZmZfZm9ybWF0ID0gYidXQVZFJwogICAgZm10X2lkID0gYidmbXQgJwog
        ICAgZm10X3NpemUgPSAxNgogICAgZm10X2Zvcm1hdCA9IDMgICAgIyBJRUVF
        X0ZMT0FUCiAgICBidWYgPSBzdHJ1Y3QucGFjaygnPDRzSTRzJywgcmlmZl9p
        ZCwgZGF0YV9zaXplICsgMjAgKyBmbXRfc2l6ZSwgcmlmZl9mb3JtYXQpCiAg
        ICBidWYgKz0gc3RydWN0LnBhY2soJzw0c0lISCcsIGZtdF9pZCwgZm10X3Np
        emUsIGZtdF9mb3JtYXQsIGNoYW5uZWxzKQogICAgYnVmICs9IHN0cnVjdC5w
        YWNrKCc8SUlISCcsCiAgICAgICAgcmF0ZSwgICAgICAgICAgICAgICAgICAg
        ICAgICAgICAjIDMyLWJpdAogICAgICAgIHJhdGUgKiBjaGFubmVscyAqIHNh
        bXBsZV9ieXRlcywgIyAzMi1iaXQKICAgICAgICBjaGFubmVscyAqIHNhbXBs
        ZV9ieXRlcywKICAgICAgICBzYW1wbGVfYnl0ZXMgKiA4KQogICAgYnVmICs9
        IHN0cnVjdC5wYWNrKCc8NHNJJywgZGF0YV9pZCwgZGF0YV9zaXplKQogICAg
        cmV0dXJuIGJ1ZgoKCmRlZiByYWRpb19jb25uZWN0KCk6CiAgICBnbG9iYWwg
        cmFkaW8KICAgIGRyaXZlcnMgPSBbIGRbJ2RyaXZlciddIGZvciBkIGluIFNv
        YXB5U0RSLkRldmljZS5lbnVtZXJhdGUoKSBdCiAgICBpbmZvKGYiRm91bmQg
        ZHJpdmVyczoge2RyaXZlcnN9IikKICAgIGRyaXZlciA9IGFyZ3MuZHJpdmVy
        CiAgICBpZiBub3QgZHJpdmVyOgogICAgICAgIGZvciByZXMgaW4gU29hcHlT
        RFIuRGV2aWNlLmVudW1lcmF0ZSgpOiAKICAgICAgICAgICAgZHJpdmVyID0g
        cmVzWydkcml2ZXInXQogICAgcmFkaW8gPSBTb2FweVNEUi5EZXZpY2UoZHJp
        dmVyKQoKCmRlZiByYWRpb19zZXR0aW5ncygpOgogICAgaW5mbyhmIkluaXRp
        YWxpemluZyByYWRpbyBzZXR0aW5ncyIpCiAgICBpZiBhcmdzLmZyZXE6CiAg
        ICAgICAgcmFkaW8uc2V0RnJlcXVlbmN5KFNPQVBZX1NEUl9SWCwgMCwgYXJn
        cy5mcmVxKQogICAgaWYgYXJncy5yYXRlOgogICAgICAgIHJhZGlvLnNldFNh
        bXBsZVJhdGUoU09BUFlfU0RSX1JYLCAwLCBhcmdzLnJhdGUpCiAgICByYWRp
        by5zZXRHYWluTW9kZShTT0FQWV9TRFJfUlgsIDAsIGFyZ3MuYWdjKTsKICAg
        IGlmIGFyZ3MuZ2FpbjoKICAgICAgICByYWRpby5zZXRHYWluKFNPQVBZX1NE
        Ul9SWCwgMCwgYXJncy5nYWluKQogICAgaWYgYXJncy5kaXJlY3Rfc2FtcDoK
        ICAgICAgICBwYXJhbSA9IGFyZ3MuZGlyZWN0X3NhbXAKICAgICAgICBpZiBw
        YXJhbS5sb3dlcigpID09ICJpIjogcGFyYW0gPSAiMSIKICAgICAgICBpZiBw
        YXJhbS5sb3dlcigpID09ICJxIjogcGFyYW0gPSAiMiIKICAgICAgICByYWRp
        by53cml0ZVNldHRpbmcoImRpcmVjdF9zYW1wIiwgcGFyYW0pCiAgICBpZiBh
        cmdzLmlxX3N3YXA6CiAgICAgICAgcmFkaW8ud3JpdGVTZXR0aW5nKCJpcV9z
        d2FwIiwgInRydWUiKQogICAgaWYgYXJncy5iaWFzdGVlOgogICAgICAgIHJh
        ZGlvLndyaXRlU2V0dGluZygiYmlhc3RlZSIsICJ0cnVlIikKICAgIGlmIGFy
        Z3MuZGlnaXRhbF9hZ2M6CiAgICAgICAgcmFkaW8ud3JpdGVTZXR0aW5nKCJk
        aWdpdGFsX2FnYyIsICJ0cnVlIikKICAgIGlmIGFyZ3MuZGlnaXRhbF9hZ2M6
        CiAgICAgICAgcmFkaW8ud3JpdGVTZXR0aW5nKCJvZmZzZXRfdHVuZSIsICJ0
        cnVlIikKCgpkZWYgbWFpbl9pbml0KCk6CiAgICBnbG9iYWwgcGF1c2VkLCBr
        aWxsZWQsIGZhdGFsCiAgICBraWxsZWQgPSBGYWxzZQogICAgZmF0YWwgPSBG
        YWxzZQogICAgcGF1c2VkID0gYXJncy5wYXVzZQoKCmRlZiBicm9rZXJfaW5p
        dCgpOgogICAgZ2xvYmFsIGJyb2tlciwgdGltZWZpbGUKICAgIHRpbWVmaWxl
        ID0gTm9uZQogICAgYnJva2VyID0gTm9uZQogICAgaWYgbm90IGFyZ3Mubm9i
        cm9rZXI6CiAgICAgICAgaW5mbyhmIkNvbm5lY3RpbmcgdG8gYnJva2VyOiB7
        YXJncy5icm9rZXJ9IikKICAgICAgICBicm9rZXIgPSBtcXR0LkNsaWVudCgp
        CiAgICAgICAgYnJva2VyLm9uX2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICAg
        ICAgYnJva2VyLm9uX21lc3NhZ2UgPSBvbl9tZXNzYWdlCiAgICAgICAgYnJv
        a2VyLmNvbm5lY3QoYXJncy5icm9rZXIsIGFyZ3MuYnJva2VyX3BvcnQsIGFy
        Z3MuYnJva2VyX2tlZXBhbGl2ZSkKICAgICAgICBicm9rZXIubG9vcF9zdGFy
        dCgpCiAgICBpbmZvKCdJbml0aWFsaXppbmcnKQoKCmRlZiBtYWluKCk6CiAg
        ICBicm9rZXJfaW5pdCgpCiAgICBTb2FweVNEUi5yZWdpc3RlckxvZ0hhbmRs
        ZXIobG9nX2hhbmRsZXIpCiAgICBpbml0aWFsaXplZD0gRmFsc2UKICAgIHdo
        aWxlIFRydWU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBtYWluX2luaXQo
        KQogICAgICAgICAgICByYWRpb19jb25uZWN0KCkKICAgICAgICAgICAgaWYg
        bm90IGluaXRpYWxpemVkOgogICAgICAgICAgICAgICAgcmFkaW9fc2V0dGlu
        Z3MoKQogICAgICAgICAgICBpbml0aWFsaXplZCA9IFRydWUKICAgICAgICAg
        ICAgcmFkaW9fc3RhcnQoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMg
        ZToKICAgICAgICAgICAgaW5mbyhmIkV4Y2VwdGlvbiBtYWluKCk6IHtlfSIp
        CiAgICAgICAgICAgIHRpbWUuc2xlZXAoYXJncy5yZXN0YXJ0X3NlY29uZHMp
        CgoKZGVmIGNsb3NlX2ZpbGUoZiwgbmFtZSk6CiAgICBpZiBmOgogICAgICAg
        IGluZm8oZiJDbG9zaW5nIHtuYW1lfSBmaWxlLiIpCiAgICAgICAgZi5jbG9z
        ZSgpCgoKZGVmIG9wZW5fZmlsZXMoKToKICAgIGR0ID0gZGF0ZXRpbWUudXRj
        bm93KCkKICAgIHRzID0gZHQuc3RyZnRpbWUoJyV5JW0lZF8lSCVNJVMnKQog
        ICAgZnJlcSA9IHJhZGlvLmdldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAp
        CiAgICBiYXNlbmFtZSA9IGYie2FyZ3Mub3V0cHV0fV97dHN9Wl97ZnJlcS8x
        ZTY6LjZmfU1IeiIKICAgIGV4dCA9ICd0eHQnCiAgICBmaWxlbmFtZSA9IGYi
        e2Jhc2VuYW1lfS57ZXh0fSIKICAgIGluZm8oZiJPcGVuaW5nIHtmaWxlbmFt
        ZX0gZm9yIGdwcyBwcHMgdGltZSIpCiAgICB0aW1lZmlsZSA9IG9wZW4oZmls
        ZW5hbWUsICJ3IikKICAgIGV4dCA9ICdyYXcnIGlmIGFyZ3Mubm93YXZlIGVs
        c2UgJ3dhdicKICAgIGZpbGVuYW1lID0gZiJ7YmFzZW5hbWV9LntleHR9Igog
        ICAgaW5mbyhmIk9wZW5pbmcge2ZpbGVuYW1lfSBmb3IgYXVkaW8iKQogICAg
        YXVkaW9maWxlID0gb3BlbihmaWxlbmFtZSwgIndiIikKICAgIGlmIG5vdCBh
        cmdzLm5vd2F2ZToKICAgICAgICBhdWRpb2ZpbGUud3JpdGUod2F2X2hlYWRl
        cihyYXRlPXJhdGUpKQogICAgcmV0dXJuIGF1ZGlvZmlsZSwgdGltZWZpbGUK
        CgpkZWYgY2xvc2Vfc3RyZWFtKHN0cmVhbSk6CiAgICBpbmZvKGYiQ2xvc2lu
        ZyByYWRpbyBzdHJlYW0uIikKICAgIHJhZGlvLmRlYWN0aXZhdGVTdHJlYW0o
        c3RyZWFtKSAKICAgIHJhZGlvLmNsb3NlU3RyZWFtKHN0cmVhbSkKCgpkZWYg
        cmFkaW9fcGVhayhwZWFrX2xldmVsKToKICAgIGRiID0gIns6LjFmfSBkQiIu
        Zm9ybWF0KDIwICogbnAubG9nMTAocGVha19sZXZlbCArIDFlLTk5KSkKICAg
        IGlmIGFyZ3MubWV0ZXI6CiAgICAgICAgYnVmID0gZiJ7ZGJ9XG4iIGlmIGFy
        Z3MuZHVtYiBlbHNlIGYiXDMzWzJLe2RiOj45c31cciIKICAgICAgICBwcmlu
        dChidWYsIGVuZD0iIiwgZmlsZT1zeXMuc3RkZXJyKQogICAgaWYgYnJva2Vy
        OgogICAgICAgIGJyb2tlci5wdWJsaXNoKGdlbl90b3BpYygicGVhayIpLCBk
        YikKCgojIyMjIyMjIyMjIyMjIyMKCnNvY2tfbGlzdCA9IFtdCnNvY2tfc2Vy
        dmVyPSBOb25lCgoKZGVmIG9wZW5fY29ubihzb2NrLCBjbGllbnRfYWRkcmVz
        cyk6CiAgICBzb2NrX2xpc3QuYXBwZW5kKHNvY2spCgoKZGVmIGNsb3NlX2Nv
        bm4oc29jayk6CiAgICBzb2NrX2xpc3QucmVtb3ZlKHNvY2spCiAgICBzb2Nr
        LmNsb3NlKCkKCgpkZWYgY2xvc2Vfc2VydmVyKCk6CiAgICBmb3Igc29jayBp
        biBzb2NrX2xpc3Q6CiAgICAgICAgc29jay5jbG9zZSgpCgoKZGVmIHRjcF9j
        b21tYW5kKGRhdGEpOgogICAgY29tbWFuZCwgcGFyYW0gPSBzdHJ1Y3QudW5w
        YWNrKGNvbW1hbmRfZm10LCBkYXRhKQogICAgaWYgYXJncy5mcmVlemU6CiAg
        ICAgICAgcGFzcwogICAgZWxpZiBjb21tYW5kID09IDB4MDE6CiAgICAgICAg
        aWYgYXJncy5kaXJlY3Rfc2FtcDoKICAgICAgICAgICAgcGFyYW0gPSBucC5h
        YnMocGFyYW0gLSAxMDBlNikKICAgICAgICBpbmZvKCdzZXRfZnJlcXVlbmN5
        OiB7Oi42Zn0gTUh6Jy5mb3JtYXQocGFyYW0gLyAxZTYpKQogICAgICAgIHJh
        ZGlvLnNldEZyZXF1ZW5jeShTT0FQWV9TRFJfUlgsIDAsIHBhcmFtKQogICAg
        ZWxpZiBjb21tYW5kID09IDB4MDI6CiAgICAgICAgaW5mbygnc2V0X3NhbXBs
        ZV9yYXRlOiB7fSBIeicuZm9ybWF0KHBhcmFtKSkKICAgICAgICByYWRpby5z
        ZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwgMCwgcGFyYW0pCiAgICBlbGlm
        IGNvbW1hbmQgPT0gMHgwMzoKICAgICAgICBpbmZvKCdzZXRfZ2Fpbl9tb2Rl
        OiB7fScuZm9ybWF0KHBhcmFtKSkKICAgICAgICByYWRpby5zZXRHYWluTW9k
        ZShTT0FQWV9TRFJfUlgsIDAsIG5vdCBwYXJhbSk7CiAgICBlbGlmIGNvbW1h
        bmQgPT0gMHgwNDoKICAgICAgICBwYXJhbSA9IHBhcmFtIC8gMTAKICAgICAg
        ICBpbmZvKCdzZXRfZ2FpbjogezouMWZ9Jy5mb3JtYXQocGFyYW0pKQogICAg
        ICAgIHJhZGlvLnNldEdhaW4oU09BUFlfU0RSX1JYLCAwLCBwYXJhbSk7CiAg
        ICBlbHNlOgogICAgICAgIGluZm8oJ3VtaW1wbGVtZW50ZWQ6IHs6LjFmfScu
        Zm9ybWF0KGNvbW1hbmQpKQoKCmRlZiB0Y3Bfc2VydmVyKGRhdGEpOgogICAg
        aWYgYXJncy5ydGx0Y3A6CiAgICAgICAgZGF0YSA9IChkYXRhICogMTI4ICsg
        MTI4KS5hc3R5cGUoJ0InKQogICAgcmVhZGFibGUsIHdyaXRhYmxlLCBleGNl
        cHRpb25hbCA9IHNlbGVjdC5zZWxlY3Qoc29ja19saXN0LCBzb2NrX2xpc3Qs
        IHNvY2tfbGlzdCwgMCkKICAgIGZvciBzb2NrIGluIHNvY2tfbGlzdDoKICAg
        ICAgICBpZiBzb2NrIGluIGV4Y2VwdGlvbmFsOgogICAgICAgICAgICBjbG9z
        ZV9jb25uKHNvY2spCiAgICBmb3Igc29jayBpbiBzb2NrX2xpc3Q6CiAgICAg
        ICAgaWYgc29jayBpbiB3cml0YWJsZToKICAgICAgICAgICAgdHJ5OgogICAg
        ICAgICAgICAgICAgc29jay5zZW5kYWxsKGRhdGEpCiAgICAgICAgICAgIGV4
        Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgY2xvc2VfY29ubihzb2Nr
        KQogICAgZm9yIHNvY2sgaW4gc29ja19saXN0OgogICAgICAgIGlmIHNvY2sg
        aW4gcmVhZGFibGU6CiAgICAgICAgICAgIGlmIHNvY2sgPT0gc29ja19zZXJ2
        ZXI6CiAgICAgICAgICAgICAgICBjb25uLCBjbGllbnRfYWRkcmVzcyA9IHNv
        Y2suYWNjZXB0KCkKICAgICAgICAgICAgICAgIG9wZW5fY29ubihjb25uLCBj
        bGllbnRfYWRkcmVzcykKICAgICAgICAgICAgICAgIGlmIGFyZ3MucnRsdGNw
        OgogICAgICAgICAgICAgICAgICAgIHR1bmVyX251bWJlciA9IDUgIyBSODIw
        VAogICAgICAgICAgICAgICAgICAgIHR1bmVyX2dhaW5zID0gMjkgIyBSODIw
        VAogICAgICAgICAgICAgICAgICAgIGRvbmdsZV9pbmZvID0gc3RydWN0LnBh
        Y2soJz40c0lJJywgYidSVEwwJywgdHVuZXJfbnVtYmVyLCB0dW5lcl9nYWlu
        cykKICAgICAgICAgICAgICAgICAgICBjb25uLnNlbmRhbGwoZG9uZ2xlX2lu
        Zm8pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBidWYgPSBz
        b2NrLnJlY3YoY29tbWFuZF9zaXplKQogICAgICAgICAgICAgICAgdGNwX2Nv
        bW1hbmQoYnVmKQoKCmRlZiBpbml0X3NlcnZlcigpOgogICAgZ2xvYmFsIHNv
        Y2tfc2VydmVyLCBzb2NrX2xpc3QKICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0
        KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICBzb2Nr
        LnNldHNvY2tvcHQoc29ja2V0LlNPTF9TT0NLRVQsIHNvY2tldC5TT19SRVVT
        RUFERFIsIDEpCiAgICBzb2NrLmJpbmQoKGFyZ3MuaG9zdCwgYXJncy5wb3J0
        KSkKICAgIHNvY2subGlzdGVuKCkKICAgIHNvY2tfbGlzdCA9IFsgc29jayBd
        CiAgICBzb2NrX3NlcnZlciA9IHNvY2sKCgpkZWYgcmFkaW9fc3RhcnQoKToK
        ICAgIGdsb2JhbCByYXRlLCB0aW1lZmlsZSwgc2FtcGxlc190b3RhbAogICAg
        aWYgbm90IGFyZ3Mubm9zZXJ2ZXI6IAogICAgICAgIGluaXRfc2VydmVyKCkK
        ICAgIHJhdGUgPSByYWRpby5nZXRTYW1wbGVSYXRlKFNPQVBZX1NEUl9SWCwg
        MCkKICAgIGRhdGEgPSBucC5hcnJheShbMF0gKiBhcmdzLnBhY2tldF9zaXpl
        ICogMiwgbnAuZmxvYXQzMikKICAgIHN0cmVhbSA9IHJhZGlvLnNldHVwU3Ry
        ZWFtKFNPQVBZX1NEUl9SWCwgU09BUFlfU0RSX0NGMzIpCiAgICByYWRpby5h
        Y3RpdmF0ZVN0cmVhbShzdHJlYW0pIAogICAgc2FtcGxlc190b3RhbCA9IDAK
        ICAgIHBlYWtfbGV2ZWwgPSAwCiAgICBzYW1wbGVfbnVtID0gMAogICAgb3V0
        ZmlsZSA9IE5vbmUKICAgIHRyeToKICAgICAgICB3aGlsZSBub3Qga2lsbGVk
        IGFuZCBub3QgZmF0YWw6CiAgICAgICAgICAgIHJhZGlvLnJlYWRTdHJlYW0o
        c3RyZWFtLCBbZGF0YV0sIGFyZ3MucGFja2V0X3NpemUpCiAgICAgICAgICAg
        IGlmIG5vdCBwYXVzZWQ6CiAgICAgICAgICAgICAgICBpZiBub3Qgb3V0Zmls
        ZToKICAgICAgICAgICAgICAgICAgICBvdXRmaWxlLCB0aW1lZmlsZSA9IG9w
        ZW5fZmlsZXMoKQogICAgICAgICAgICAgICAgc2FtcGxlc190b3RhbCArPSBh
        cmdzLnBhY2tldF9zaXplCiAgICAgICAgICAgICAgICBvdXRmaWxlLndyaXRl
        KGRhdGEpCiAgICAgICAgICAgIGlmIG5vdCBhcmdzLm5vc2VydmVyOgogICAg
        ICAgICAgICAgICAgdGNwX3NlcnZlcihkYXRhKQoKICAgICAgICAgICAgIyBw
        ZWFrIG1ldGVyCiAgICAgICAgICAgIHBlYWtfbGV2ZWwgPSBtYXgocGVha19s
        ZXZlbCwgYWJzKGRhdGEubWluKCkpLCBhYnMoZGF0YS5tYXgoKSkpCiAgICAg
        ICAgICAgIHNhbXBsZV9udW0gKz0gYXJncy5wYWNrZXRfc2l6ZQogICAgICAg
        ICAgICBpZiBzYW1wbGVfbnVtID4gcmF0ZSAqIGFyZ3MucmVmcmVzaDoKICAg
        ICAgICAgICAgICAgIHJhZGlvX3BlYWsocGVha19sZXZlbCkKICAgICAgICAg
        ICAgICAgIHBlYWtfbGV2ZWwgPSAwCiAgICAgICAgICAgICAgICBzYW1wbGVf
        bnVtID0gMAogICAgZXhjZXB0IChLZXlib2FyZEludGVycnVwdCwgU3lzdGVt
        RXJyb3IpIGFzIGU6CiAgICAgICAgaW5mbyhmIkV4Y2VwdGlvbiByYWRpb19z
        dGFydCgpOiB7ZX0iKQogICAgICAgIHRpbWUuc2xlZXAoYXJncy5yZXN0YXJ0
        X3NlY29uZHMpCiAgICBpZiBub3QgYXJncy5ub3NlcnZlcjogCiAgICAgICAg
        Y2xvc2Vfc2VydmVyKCkKICAgIGNsb3NlX2ZpbGUob3V0ZmlsZSwgImF1ZGlv
        IikKICAgIHRpbWVmaWxlID0gY2xvc2VfZmlsZSh0aW1lZmlsZSwgInRpbWUi
        KQogICAgY2xvc2Vfc3RyZWFtKHN0cmVhbSkKICAgIGlmIGZhdGFsOgogICAg
        ICAgIGluZm8oIkZhdGFsIGNvbW1hbmQgZ2l2ZW4sIGtpbGxpbmcgcHJvY2Vz
        cyIpCiAgICAgICAgc3lzLmV4aXQoMSkKCgppZiBfX25hbWVfXyA9PSAnX19t
        YWluX18nOgogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1h
        aW4oKQoK


  - become: yes
    copy:
      mode: 0755
      dest: /usr/local/bin/mqclient
      content: !!binary |
        IyEvdXNyL2Jpbi9weXRob24zCgppbXBvcnQgc3lzCmltcG9ydCBhcmdwYXJz
        ZQppbXBvcnQgcGFoby5tcXR0LmNsaWVudCBhcyBtcXR0CgpwYXJzZXIgPSBh
        cmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgIGZvcm1hdHRlcl9jbGFzcz1h
        cmdwYXJzZS5Bcmd1bWVudERlZmF1bHRzSGVscEZvcm1hdHRlcikKcGFyc2Vy
        LmFkZF9hcmd1bWVudCgiLS1icm9rZXIiLCBkZWZhdWx0PSIxMjcuMC4wLjEi
        LCBoZWxwPSdicm9rZXIgaG9zdCcpCnBhcnNlci5hZGRfYXJndW1lbnQoIi0t
        cG9ydCIsIGRlZmF1bHQ9MTg4MywgaGVscD0nYnJva2VyIHBvcnQnKQpwYXJz
        ZXIuYWRkX2FyZ3VtZW50KCItLWtlZXBhbGl2ZSIsIGRlZmF1bHQ9NjAsIGhl
        bHA9J2Jyb2tlciBrZWVwIGFsaXZlJykKcGFyc2VyLmFkZF9hcmd1bWVudCgi
        LS10b3BpYyIsIGRlZmF1bHQ9ImYvdHgiLCBoZWxwPSdjb21tYW5kIHRvcGlj
        JykKCmRlZiBvbl9jb25uZWN0KGNsaWVudCwgdXNlcmRhdGEsIGZsYWdzLCBy
        Yyk6CiAgICBjbGllbnQuc3Vic2NyaWJlKCIjIikKCmRlZiBvbl9tZXNzYWdl
        KGNsaWVudCwgdXNlcmRhdGEsIG1zZyk6CiAgICBwcmludChtc2cudG9waWMg
        KyAiICIgKyBtc2cucGF5bG9hZC5kZWNvZGUoJ2xhdGluJykpCgpkZWYgbWFp
        bigpOgogICAgY2xpZW50ID0gbXF0dC5DbGllbnQoKQogICAgY2xpZW50Lm9u
        X2Nvbm5lY3QgPSBvbl9jb25uZWN0CiAgICBjbGllbnQub25fbWVzc2FnZSA9
        IG9uX21lc3NhZ2UKICAgIGNsaWVudC5jb25uZWN0KGFyZ3MuYnJva2VyLCBh
        cmdzLnBvcnQsIGFyZ3Mua2VlcGFsaXZlKQogICAgY2xpZW50Lmxvb3Bfc3Rh
        cnQoKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICBsaW5lID0gbmV4dChzeXMu
        c3RkaW4pLnJzdHJpcCgpCiAgICAgICAgY2xpZW50LnB1Ymxpc2goYXJncy50
        b3BpYywgbGluZSkgCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAg
        YXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIG1haW4oKQoKCg==



  # output directory

  - become: yes
    file: path={{ fs_path }} state=directory owner={{ user }} group={{ user }}

  - become: yes
    copy:
      dest: /lib/systemd/system/mqsoapy.service
      content: |
        [Service]
        ExecStart=/usr/bin/python3 -u /usr/local/bin/mqsoapy --rtltcp --pause --output {{ fs_path }}/out
        # WorkingDirectory={{ fs_path }}
        User=george
        Restart=on-failure
        RestartSec=10s
        [Install]
        WantedBy=multi-user.target

  - become: yes
    shell: |
      sudo systemctl enable mqsoapy
      sudo systemctl restart mqsoapy


